{"patch": "diff --git a/.gitignore b/.gitignore\nindex d6b8b714dc..20a5dca7fa 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -45,3 +45,14 @@ src/H5version.h\n /.classpath\n /CMakeUserPresets.json\n HDF5Examples/CMakeUserPresets.json\n+build/\n+Build/\n+bin/\n+lib/\n+*.o\n+*.out\n+*.obj\n+*.exe\n+*.dll\n+*.so\n+*.dylib\ndiff --git a/src/H5F.c b/src/H5F.c\nindex 5dcda18924..4b7af47edf 100644\n--- a/src/H5F.c\n+++ b/src/H5F.c\n@@ -118,6 +118,8 @@ H5Fget_create_plist(hid_t file_id)\n     FUNC_ENTER_API(H5I_INVALID_HID)\n \n     /* check args */\n+    if (H5I_FILE != H5I_get_type(file_id))\n+        HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, H5I_INVALID_HID, \"not a file ID\");\n     if (NULL == (vol_obj = (H5VL_object_t *)H5I_object(file_id)))\n         HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, H5I_INVALID_HID, \"invalid file identifier\");\n \n@@ -164,6 +166,8 @@ H5Fget_access_plist(hid_t file_id)\n     FUNC_ENTER_API(H5I_INVALID_HID)\n \n     /* Check args */\n+    if (H5I_FILE != H5I_get_type(file_id))\n+        HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, H5I_INVALID_HID, \"not a file ID\");\n     if (NULL == (vol_obj = (H5VL_object_t *)H5I_object(file_id)))\n         HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, H5I_INVALID_HID, \"invalid file identifier\");\n \n@@ -438,6 +442,10 @@ H5Fget_vfd_handle(hid_t file_id, hid_t fapl_id, void **file_handle /*out*/)\n     if (!file_handle)\n         HGOTO_ERROR(H5E_ARGS, H5E_BADVALUE, FAIL, \"invalid file handle pointer\");\n \n+    /* Check that file_id is a file ID */\n+    if (H5I_FILE != H5I_get_type(file_id))\n+        HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, FAIL, \"not a file ID\");\n+\n     /* Get the file object */\n     if (NULL == (vol_obj = (H5VL_object_t *)H5I_object(file_id)))\n         HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, FAIL, \"invalid file identifier\");\n@@ -1554,6 +1562,10 @@ H5Fget_intent(hid_t file_id, unsigned *intent_flags /*out*/)\n         H5VL_object_t       *vol_obj;     /* File for file_id */\n         H5VL_file_get_args_t vol_cb_args; /* Arguments to VOL callback */\n \n+        /* Check that file_id is a file ID */\n+        if (H5I_FILE != H5I_get_type(file_id))\n+            HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, FAIL, \"not a file ID\");\n+\n         /* Get the internal file structure */\n         if (NULL == (vol_obj = (H5VL_object_t *)H5I_object(file_id)))\n             HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, FAIL, \"invalid file identifier\");\n@@ -1592,6 +1604,9 @@ H5Fget_fileno(hid_t file_id, unsigned long *fnumber /*out*/)\n     if (fnumber) {\n         H5VL_object_t       *vol_obj;     /* File for file_id */\n         H5VL_file_get_args_t vol_cb_args; /* Arguments to VOL callback */\n+        /* Check that file_id is a file ID */\n+        if (H5I_FILE != H5I_get_type(file_id))\n+            HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, FAIL, \"not a file ID\");\n \n         /* Get the internal file structure */\n         if (NULL == (vol_obj = (H5VL_object_t *)H5I_object(file_id)))\n@@ -1630,6 +1645,10 @@ H5Fget_freespace(hid_t file_id)\n \n     FUNC_ENTER_API((-1))\n \n+    /* Check that file_id is a file ID */\n+    if (H5I_FILE != H5I_get_type(file_id))\n+        HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, (-1), \"not a file ID\");\n+\n     /* Get the file object */\n     if (NULL == (vol_obj = (H5VL_object_t *)H5I_object(file_id)))\n         HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, (-1), \"invalid file identifier\");\ndiff --git a/src/H5VLnative_file.c b/src/H5VLnative_file.c\nindex 33a19bfd91..171fbf60b5 100644\n--- a/src/H5VLnative_file.c\n+++ b/src/H5VLnative_file.c\n@@ -158,7 +158,10 @@ H5VL__native_file_get(void *obj, H5VL_file_get_args_t *args, hid_t H5_ATTR_UNUSE\n     switch (args->op_type) {\n         /* \"get container info\" */\n         case H5VL_FILE_GET_CONT_INFO: {\n-            if (H5F__get_cont_info((H5F_t *)obj, args->args.get_cont_info.info) < 0)\n+            if (H5VL_native_get_file_struct(obj, H5I_FILE, &f) < 0)\n+                HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, FAIL, \"not a file or file object\");\n+\n+            if (H5F__get_cont_info(f, args->args.get_cont_info.info) < 0)\n                 HGOTO_ERROR(H5E_FILE, H5E_CANTGET, FAIL, \"can't get file container info\");\n \n             break;\n@@ -166,7 +169,10 @@ H5VL__native_file_get(void *obj, H5VL_file_get_args_t *args, hid_t H5_ATTR_UNUSE\n \n         /* H5Fget_access_plist */\n         case H5VL_FILE_GET_FAPL: {\n-            if ((args->args.get_fapl.fapl_id = H5F_get_access_plist((H5F_t *)obj, true)) < 0)\n+            if (H5VL_native_get_file_struct(obj, H5I_FILE, &f) < 0)\n+                HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, FAIL, \"not a file or file object\");\n+\n+            if ((args->args.get_fapl.fapl_id = H5F_get_access_plist(f, true)) < 0)\n                 HGOTO_ERROR(H5E_FILE, H5E_CANTGET, FAIL, \"can't get file access property list\");\n \n             break;\n@@ -176,7 +182,9 @@ H5VL__native_file_get(void *obj, H5VL_file_get_args_t *args, hid_t H5_ATTR_UNUSE\n         case H5VL_FILE_GET_FCPL: {\n             H5P_genplist_t *plist; /* Property list */\n \n-            f = (H5F_t *)obj;\n+            if (H5VL_native_get_file_struct(obj, H5I_FILE, &f) < 0)\n+                HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, FAIL, \"not a file or file object\");\n+\n             if (NULL == (plist = (H5P_genplist_t *)H5I_object(f->shared->fcpl_id)))\n                 HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, FAIL, \"not a property list\");\n \n@@ -189,7 +197,8 @@ H5VL__native_file_get(void *obj, H5VL_file_get_args_t *args, hid_t H5_ATTR_UNUSE\n \n         /* H5Fget_intent */\n         case H5VL_FILE_GET_INTENT: {\n-            f = (H5F_t *)obj;\n+            if (H5VL_native_get_file_struct(obj, H5I_FILE, &f) < 0)\n+                HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, FAIL, \"not a file or file object\");\n \n             /* HDF5 uses some flags internally that users don't know about.\n              * Simplify things for them so that they only get either H5F_ACC_RDWR\n@@ -217,7 +226,10 @@ H5VL__native_file_get(void *obj, H5VL_file_get_args_t *args, hid_t H5_ATTR_UNUSE\n         case H5VL_FILE_GET_FILENO: {\n             unsigned long fileno = 0;\n \n-            H5F_GET_FILENO((H5F_t *)obj, fileno);\n+            if (H5VL_native_get_file_struct(obj, H5I_FILE, &f) < 0)\n+                HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, FAIL, \"not a file or file object\");\n+\n+            H5F_GET_FILENO(f, fileno);\n             *args->args.get_fileno.fileno = fileno;\n \n             break;\n@@ -246,7 +258,10 @@ H5VL__native_file_get(void *obj, H5VL_file_get_args_t *args, hid_t H5_ATTR_UNUSE\n \n         /* H5Fget_obj_count */\n         case H5VL_FILE_GET_OBJ_COUNT: {\n-            if (H5F_get_obj_count((H5F_t *)obj, args->args.get_obj_count.types, true,\n+            if (H5VL_native_get_file_struct(obj, H5I_FILE, &f) < 0)\n+                HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, FAIL, \"not a file or file object\");\n+\n+            if (H5F_get_obj_count(f, args->args.get_obj_count.types, true,\n                                   args->args.get_obj_count.count) < 0)\n                 HGOTO_ERROR(H5E_FILE, H5E_CANTGET, FAIL, \"can't retrieve object count\");\n \n@@ -257,7 +272,10 @@ H5VL__native_file_get(void *obj, H5VL_file_get_args_t *args, hid_t H5_ATTR_UNUSE\n         case H5VL_FILE_GET_OBJ_IDS: {\n             H5VL_file_get_obj_ids_args_t *file_args = &args->args.get_obj_ids;\n \n-            if (H5F_get_obj_ids((H5F_t *)obj, file_args->types, file_args->max_objs, file_args->oid_list,\n+            if (H5VL_native_get_file_struct(obj, H5I_FILE, &f) < 0)\n+                HGOTO_ERROR(H5E_ARGS, H5E_BADTYPE, FAIL, \"not a file or file object\");\n+\n+            if (H5F_get_obj_ids(f, file_args->types, file_args->max_objs, file_args->oid_list,\n                                 true, file_args->count) < 0)\n                 HGOTO_ERROR(H5E_FILE, H5E_CANTGET, FAIL, \"can't retrieve object IDs\");\n \n", "result": true}