{"patch": "diff --git a/icu4c/source/i18n/regexcmp.cpp b/icu4c/source/i18n/regexcmp.cpp\nindex a4c12804237..23258212688 100644\n--- a/icu4c/source/i18n/regexcmp.cpp\n+++ b/icu4c/source/i18n/regexcmp.cpp\n@@ -70,6 +70,7 @@ RegexCompile::RegexCompile(RegexPattern *rxp, UErrorCode &status) :\n     fInBackslashQuote = FALSE;\n     fModeFlags        = fRXPat->fFlags | 0x80000000;\n     fEOLComments      = TRUE;\n+    fNextCharRecursionDepth = 0;\n \n     fMatchOpenParen   = -1;\n     fMatchCloseParen  = -1;\n@@ -4009,8 +4010,17 @@ UChar32  RegexCompile::peekCharLL() {\n //                The rest of the pattern grammar is handled at the next level up.\n //\n //------------------------------------------------------------------------------\n+static const int32_t MAX_NEXTCHAR_RECURSION_DEPTH = 100;\n+\n void RegexCompile::nextChar(RegexPatternChar &c) {\n \n+    // Check for excessive recursion to prevent stack overflow\n+    if (fNextCharRecursionDepth >= MAX_NEXTCHAR_RECURSION_DEPTH) {\n+        error(U_REGEX_INTERNAL_ERROR);\n+        return;\n+    }\n+    fNextCharRecursionDepth++;\n+\n     fScanIndex = UTEXT_GETNATIVEINDEX(fRXPat->fPattern);\n     c.fChar    = nextCharLL();\n     c.fQuoted  = FALSE;\n@@ -4020,7 +4030,8 @@ void RegexCompile::nextChar(RegexPatternChar &c) {\n         if ((c.fChar==chBackSlash && peekCharLL()==chE && ((fModeFlags & UREGEX_LITERAL) == 0)) ||\n             c.fChar == (UChar32)-1) {\n             fQuoteMode = FALSE;  //  Exit quote mode,\n-            nextCharLL();        // discard the E\n+            if (c.fChar != (UChar32)-1)\n+                nextCharLL();        // discard the E\n             nextChar(c);         // recurse to get the real next char\n         }\n     }\n@@ -4156,6 +4167,7 @@ void RegexCompile::nextChar(RegexPatternChar &c) {\n     // They are disabled by the parser upon seeing '(?', but this lasts for\n     //  the fetching of the next character only.\n     fEOLComments = TRUE;\n+    fNextCharRecursionDepth--;\n \n     // putc(c.fChar, stdout);\n }\ndiff --git a/icu4c/source/i18n/regexcmp.h b/icu4c/source/i18n/regexcmp.h\nindex f2aeea909e7..8e787d71dcb 100644\n--- a/icu4c/source/i18n/regexcmp.h\n+++ b/icu4c/source/i18n/regexcmp.h\n@@ -149,6 +149,7 @@ class U_I18N_API RegexCompile : public UMemory {\n     UChar32                       fLastChar;         // Previous char, needed to count CR-LF\n                                                      //   as a single line, not two.\n     UChar32                       fPeekChar;         // Saved char, if we've scanned ahead.\n+    int32_t                       fNextCharRecursionDepth; // Recursion depth counter for nextChar()\n \n \n     RegexPatternChar              fC;                // Current char for parse state machine\n", "result": true}