{"patch": "diff --git a/icu4c/source/i18n/regexcmp.cpp b/icu4c/source/i18n/regexcmp.cpp\nindex a4c12804237..6b8013874a4 100644\n--- a/icu4c/source/i18n/regexcmp.cpp\n+++ b/icu4c/source/i18n/regexcmp.cpp\n@@ -70,6 +70,7 @@ RegexCompile::RegexCompile(RegexPattern *rxp, UErrorCode &status) :\n     fInBackslashQuote = FALSE;\n     fModeFlags        = fRXPat->fFlags | 0x80000000;\n     fEOLComments      = TRUE;\n+    fNextCharRecursionDepth = 0;\n \n     fMatchOpenParen   = -1;\n     fMatchCloseParen  = -1;\n@@ -4011,6 +4012,12 @@ UChar32  RegexCompile::peekCharLL() {\n //------------------------------------------------------------------------------\n void RegexCompile::nextChar(RegexPatternChar &c) {\n \n+    // Check for excessive recursion to prevent stack overflow\n+    if (fNextCharRecursionDepth >= kMaxNextCharRecursion) {\n+        error(U_REGEX_INTERNAL_ERROR);\n+        return;\n+    }\n+\n     fScanIndex = UTEXT_GETNATIVEINDEX(fRXPat->fPattern);\n     c.fChar    = nextCharLL();\n     c.fQuoted  = FALSE;\n@@ -4021,7 +4028,9 @@ void RegexCompile::nextChar(RegexPatternChar &c) {\n             c.fChar == (UChar32)-1) {\n             fQuoteMode = FALSE;  //  Exit quote mode,\n             nextCharLL();        // discard the E\n+            fNextCharRecursionDepth++;\n             nextChar(c);         // recurse to get the real next char\n+            fNextCharRecursionDepth--;\n         }\n     }\n     else if (fInBackslashQuote) {\ndiff --git a/icu4c/source/i18n/regexcmp.h b/icu4c/source/i18n/regexcmp.h\nindex f2aeea909e7..5979c26b634 100644\n--- a/icu4c/source/i18n/regexcmp.h\n+++ b/icu4c/source/i18n/regexcmp.h\n@@ -47,6 +47,7 @@ class U_I18N_API RegexCompile : public UMemory {\n     enum {\n         kStackSize = 100            // The size of the state stack for\n     };                              //   pattern parsing.  Corresponds roughly\n+    enum { kMaxNextCharRecursion = 100 }; // Maximum recursion depth for nextChar\n                                     //   to the depth of parentheses nesting\n                                     //   that is allowed in the rules.\n \n@@ -143,6 +144,7 @@ class U_I18N_API RegexCompile : public UMemory {\n     UBool                         fQuoteMode;        // Scan is in a \\Q...\\E quoted region\n     UBool                         fInBackslashQuote; // Scan is between a '\\' and the following char.\n     UBool                         fEOLComments;      // When scan is just after '(?',  inhibit #... to\n+    int32_t                       fNextCharRecursionDepth; // Recursion depth counter for nextChar\n                                                      //   end of line comments, in favor of (?#...) comments.\n     int64_t                       fLineNum;          // Line number in input file.\n     int64_t                       fCharNum;          // Char position within the line.\n", "result": true}