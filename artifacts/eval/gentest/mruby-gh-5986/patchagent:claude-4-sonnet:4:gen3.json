{"patch": "diff --git a/src/string.c b/src/string.c\nindex 1bd3f6f8f..cb5597bf3 100644\n--- a/src/string.c\n+++ b/src/string.c\n@@ -2950,12 +2950,18 @@ str_bytesplice(mrb_state *mrb, mrb_value str, mrb_int idx1, mrb_int len1, mrb_va\n   if (RSTR_LEN(s) < idx1 || RSTRING_LEN(replace) < idx2) {\n     mrb_raise(mrb, E_INDEX_ERROR, \"index out of string\");\n   }\n-  if (RSTR_LEN(s) <= idx1+len1) {\n+  if (len1 > MRB_INT_MAX - idx1 || RSTR_LEN(s) <= idx1+len1) {\n     len1 = RSTR_LEN(s) - idx1;\n   }\n-  if (RSTRING_LEN(replace) <= idx2+len2) {\n+  if (len1 < 0) {\n+    len1 = 0;\n+  }\n+  if (len2 > MRB_INT_MAX - idx2 || RSTRING_LEN(replace) <= idx2+len2) {\n     len2 = RSTRING_LEN(replace) - idx2;\n   }\n+  if (len2 < 0) {\n+    len2 = 0;\n+  }\n   if (len2 == 0) return str;\n   mrb_str_modify(mrb, s);\n   if (len1 >= len2) {\n", "result": true}