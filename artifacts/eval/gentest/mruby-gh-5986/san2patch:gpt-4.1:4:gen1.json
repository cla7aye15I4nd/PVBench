{"patch": "diff --git a/src/string.c b/src/string.c\nindex 1bd3f6f8f..28b56f637 100644\n--- a/src/string.c\n+++ b/src/string.c\n@@ -2948,7 +2948,15 @@ str_bytesplice(mrb_state *mrb, mrb_value str, mrb_int idx1, mrb_int len1, mrb_va\n {\n   struct RString *s = RSTRING(str);\n   if (RSTR_LEN(s) < idx1 || RSTRING_LEN(replace) < idx2) {\n-    mrb_raise(mrb, E_INDEX_ERROR, \"index out of string\");\n+// FIXME: Crash CWE-190: Integer Overflow or Wraparound\n+     mrb_raise(mrb, E_INDEX_ERROR, \"index out of string\");\n+  }\n+  // Check for integer overflow in idx1+len1 and idx2+len2\n+  if (len1 > 0 && idx1 > MRB_INT_MAX - len1) {\n+    mrb_raise(mrb, E_INDEX_ERROR, \"integer overflow on idx1+len1\");\n+  }\n+  if (len2 > 0 && idx2 > MRB_INT_MAX - len2) {\n+    mrb_raise(mrb, E_INDEX_ERROR, \"integer overflow on idx2+len2\");\n   }\n   if (RSTR_LEN(s) <= idx1+len1) {\n     len1 = RSTR_LEN(s) - idx1;\n@@ -2961,13 +2969,35 @@ str_bytesplice(mrb_state *mrb, mrb_value str, mrb_int idx1, mrb_int len1, mrb_va\n   if (len1 >= len2) {\n     memmove(RSTR_PTR(s)+idx1, RSTRING_PTR(replace)+idx2, len2);\n     if (len1 > len2) {\n+      if (idx1 > MRB_INT_MAX - len2) {\n+        mrb_raise(mrb, E_INDEX_ERROR, \"integer overflow on idx1+len2\");\n+      }\n+      if (idx1 > MRB_INT_MAX - len1) {\n+        mrb_raise(mrb, E_INDEX_ERROR, \"integer overflow on idx1+len1\");\n+      }\n+      if ((RSTR_LEN(s) < (idx1+len1))) {\n+        mrb_raise(mrb, E_INDEX_ERROR, \"overflow in memmove src/dst\");\n+      }\n       memmove(RSTR_PTR(s)+idx1+len2, RSTR_PTR(s)+idx1+len1, RSTR_LEN(s)-(idx1+len1));\n       RSTR_SET_LEN(s, RSTR_LEN(s)-(len1-len2));\n     }\n   }\n   else { /* len1 < len2 */\n     mrb_int slen = RSTR_LEN(s);\n+    // Check for overflow in slen+len2-len1\n+    if (len2 > len1 && slen > MRB_INT_MAX - (len2-len1)) {\n+      mrb_raise(mrb, E_INDEX_ERROR, \"integer overflow on resize\");\n+    }\n     mrb_str_resize(mrb, str, slen+len2-len1);\n+    if (idx1 > MRB_INT_MAX - len2) {\n+      mrb_raise(mrb, E_INDEX_ERROR, \"integer overflow on idx1+len2\");\n+    }\n+    if (idx1 > MRB_INT_MAX - len1) {\n+      mrb_raise(mrb, E_INDEX_ERROR, \"integer overflow on idx1+len1\");\n+    }\n+    if ((slen < (idx1+len1))) {\n+      mrb_raise(mrb, E_INDEX_ERROR, \"overflow in memmove src/dst\");\n+    }\n     memmove(RSTR_PTR(s)+idx1+len2, RSTR_PTR(s)+idx1+len1, slen-(idx1+len1));\n     memmove(RSTR_PTR(s)+idx1, RSTRING_PTR(replace)+idx2, len2);\n   }\n", "result": false, "error": "/tmp/mruby-gh-5986/build/src/string.c:2995:28: runtime error: signed integer overflow: 9223372036854775807 - -10 cannot be represented in type 'long'\n    #0 0x5651061bc7e6 in str_bytesplice /tmp/mruby-gh-5986/build/src/string.c:2995:28\n    #1 0x5651061b2698 in mrb_str_bytesplice /tmp/mruby-gh-5986/build/src/string.c:3037:14\n    #2 0x565106203d5f in mrb_vm_exec /tmp/mruby-gh-5986/build/src/vm.c:1809:18\n    #3 0x5651061e11d1 in mrb_vm_run /tmp/mruby-gh-5986/build/src/vm.c:1300:12\n    #4 0x5651061db771 in mrb_top_run /tmp/mruby-gh-5986/build/src/vm.c:3125:10\n    #5 0x565106311e30 in mrb_load_exec /tmp/mruby-gh-5986/build/mrbgems/mruby-compiler/core/parse.y:6917:7\n    #6 0x5651063125f7 in mrb_load_detect_file_cxt /tmp/mruby-gh-5986/build/mrbgems/mruby-compiler/core/parse.y:6960:12\n    #7 0x56510610bdf7 in main /tmp/mruby-gh-5986/build/mrbgems/mruby-bin-mruby/tools/mruby/mruby.c:356:11\n    #8 0x7fe2365ea1c9  (/lib/x86_64-linux-gnu/libc.so.6+0x2a1c9) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\n    #9 0x7fe2365ea28a in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2a28a) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\n    #10 0x5651060dfcf4 in _start (/tmp/mruby-gh-5986/build/build/host/bin/mruby+0x22fcf4) (BuildId: cb8f067ffd38f6d0f07e975202ff40ff7d8ca19f)\n\nSUMMARY: UndefinedBehaviorSanitizer: undefined-behavior /tmp/mruby-gh-5986/build/src/string.c:2995:28 \n"}