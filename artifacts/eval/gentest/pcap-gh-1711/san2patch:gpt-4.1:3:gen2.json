{"patch": "diff --git a/Packet++/src/GtpLayer.cpp b/Packet++/src/GtpLayer.cpp\nindex 2e935cf5..bd21ed9e 100644\n--- a/Packet++/src/GtpLayer.cpp\n+++ b/Packet++/src/GtpLayer.cpp\n@@ -398,7 +398,8 @@ namespace pcpp\n \t\t\t// add ext total length to offset\n \t\t\toffsetForNewExtension += lastExt.getTotalLength();\n \t\t}\n-\n+// FIXME: Crash CWE-416: Use After Free\n+ \n \t\t// allocate extension space in layer (assuming extension length can only be 4 bytes)\n \t\tif (!extendLayer(offsetForNewExtension, 4 * sizeof(uint8_t)))\n \t\t{\n@@ -406,7 +407,8 @@ namespace pcpp\n \t\t\treturn {};\n \t\t}\n \n-\t\t// lastExt != null means layer contains 1 or more extensions\n+\t\t// After memory is extended, lastExt may point into freed memory. Recapture lastExt.\n+\t\tlastExt = getNextExtension();\n \t\tif (!lastExt.isNull())\n \t\t{\n \t\t\t// set the next header type in the last extension\n@@ -415,6 +417,8 @@ namespace pcpp\n \t\telse\n \t\t{\n \t\t\t// mark extension flags in the layer\n+\t\t\theader = getHeader();\n+\t\t\theaderExtra = getHeaderExtra();\n \t\t\theader->extensionHeaderFlag = 1;\n \t\t\theaderExtra->nextExtensionHeader = extensionType;\n \t\t}\n", "result": true}