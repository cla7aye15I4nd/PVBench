{"patch": "diff --git a/Modules/_asynciomodule.c b/Modules/_asynciomodule.c\nindex 4b84c1de66b..b3b0f954eb9 100644\n--- a/Modules/_asynciomodule.c\n+++ b/Modules/_asynciomodule.c\n@@ -2049,7 +2049,10 @@ swap_current_task(asyncio_state *state, PyObject *loop, PyObject *task)\n     }\n \n     if (task == Py_None) {\n+        /* Increment prev_task before deleting from dict to avoid use-after-free */\n+        Py_INCREF(prev_task);\n         if (_PyDict_DelItem_KnownHash(state->current_tasks, loop, hash) == -1) {\n+            Py_DECREF(prev_task);\n             return NULL;\n         }\n     } else {\n@@ -2057,9 +2060,10 @@ swap_current_task(asyncio_state *state, PyObject *loop, PyObject *task)\n             return NULL;\n         }\n     }\n-\n-    Py_INCREF(prev_task);\n-\n+    /* If task == Py_None, prev_task was already incref'ed above */\n+    if (task != Py_None) {\n+        Py_INCREF(prev_task);\n+    }\n     return prev_task;\n }\n \n", "result": false, "error": "Traceback (most recent call last):\n  File \"/gentest-cpython/py-pr-105987/generated_2.py\", line 52, in <module>\n    rc, out, err = assert_python_ok('-c', code)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/tmp/py-pr-105987/build/Lib/test/support/script_helper.py\", line 166, in assert_python_ok\n    return _assert_python(True, *args, **env_vars)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/tmp/py-pr-105987/build/Lib/test/support/script_helper.py\", line 151, in _assert_python\n    res.fail(cmd_line)\n  File \"/tmp/py-pr-105987/build/Lib/test/support/script_helper.py\", line 76, in fail\n    raise AssertionError(\"Process return code is %d\\n\"\nAssertionError: Process return code is 1\ncommand line: ['/tmp/py-pr-105987/build/python', '-X', 'faulthandler', '-I', '-c', 'if 1:\\n    import _asyncio\\n\\n    # Define simple dummy classes to use as loop and task identifiers\\n    class DummyLoop:\\n        pass\\n\\n    class DummyTask:\\n        pass\\n\\n    # 1) Deleting an ephemeral current task: should not crash and should return the previous task\\n    l1 = DummyLoop()\\n    # Set current task to an ephemeral instance (only referenced by the mapping)\\n    _asyncio._swap_current_task(l1, DummyTask())\\n    # Now clear it; previously this could crash due to INCREF after deletion\\n    prev = _asyncio._swap_current_task(l1, None)\\n    assert isinstance(prev, DummyTask), f\"Expected previous task to be DummyTask instance, got: {type(prev)}\"\\n\\n    # 2) Replacing an ephemeral current task with a new task: should not crash and should return the old task\\n    l2 = DummyLoop()\\n    _asyncio._swap_current_task(l2, DummyTask())  # Old task only referenced by the mapping\\n    new_task = DummyTask()\\n    prev2 = _asyncio._swap_current_task(l2, new_task)\\n    assert isinstance(prev2, DummyTask), f\"Expected previous task to be DummyTask instance, got: {type(prev2)}\"\\n    assert prev2 is not new_task, \"Previous task should not be the newly set task\"\\n\\n    # Verify that the mapping now holds new_task by clearing it and inspecting the returned previous task\\n    last = _asyncio._swap_current_task(l2, None)\\n    assert last is new_task, \"Expected returned previous task to be the task that was just set\"\\n\\n    # 3) Initial set on a fresh loop should return None as previous task\\n    l3 = DummyLoop()\\n    first_prev = _asyncio._swap_current_task(l3, DummyTask())\\n    assert first_prev is None, f\"Expected previous task to be None on first set, got: {first_prev!r}\"\\n']\n\nstdout:\n---\n\n---\n\nstderr:\n---\n(... truncated stderr ...):21\n    #17 0x56304729a808 in Py_RunMain /tmp/py-pr-105987/build/Modules/main.c:688:5\n    #18 0x56304729b4d8 in pymain_main /tmp/py-pr-105987/build/Modules/main.c:718:12\n    #19 0x56304729b5e7 in Py_BytesMain /tmp/py-pr-105987/build/Modules/main.c:742:12\n    #20 0x563046ba0481 in main /tmp/py-pr-105987/build/./Programs/python.c:15:12\n    #21 0x7f1f094881c9  (/lib/x86_64-linux-gnu/libc.so.6+0x2a1c9) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\n    #22 0x7f1f0948828a in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2a28a) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\n    #23 0x563046ac7074 in _start (/tmp/py-pr-105987/build/python+0x270074) (BuildId: b5f2a9ed6c22c358256c428e257a446d4340fdbf)\n\n0x5040001fa730 is located 32 bytes inside of 48-byte region [0x5040001fa710,0x5040001fa740)\nfreed by thread T0 here:\n    #0 0x563046b61c2a in free (/tmp/py-pr-105987/build/python+0x30ac2a) (BuildId: b5f2a9ed6c22c358256c428e257a446d4340fdbf)\n    #1 0x563046e72dc8 in _PyMem_RawFree /tmp/py-pr-105987/build/Objects/obmalloc.c:73:5\n    #2 0x563046e74f8f in PyObject_Free /tmp/py-pr-105987/build/Objects/obmalloc.c:830:5\n    #3 0x5630472a2996 in PyObject_GC_Del /tmp/py-pr-105987/build/Modules/gcmodule.c:2396:5\n    #4 0x563046ea80a5 in object_dealloc /tmp/py-pr-105987/build/Objects/typeobject.c:5531:5\n    #5 0x563046ead955 in subtype_dealloc /tmp/py-pr-105987/build/Objects/typeobject.c:2073:5\n    #6 0x563046e72473 in _Py_Dealloc /t"}