{"patch": "diff --git a/Modules/_asynciomodule.c b/Modules/_asynciomodule.c\nindex 4b84c1de66b..b3b0f954eb9 100644\n--- a/Modules/_asynciomodule.c\n+++ b/Modules/_asynciomodule.c\n@@ -2049,7 +2049,10 @@ swap_current_task(asyncio_state *state, PyObject *loop, PyObject *task)\n     }\n \n     if (task == Py_None) {\n+        /* Increment prev_task before deleting from dict to avoid use-after-free */\n+        Py_INCREF(prev_task);\n         if (_PyDict_DelItem_KnownHash(state->current_tasks, loop, hash) == -1) {\n+            Py_DECREF(prev_task);\n             return NULL;\n         }\n     } else {\n@@ -2057,9 +2060,10 @@ swap_current_task(asyncio_state *state, PyObject *loop, PyObject *task)\n             return NULL;\n         }\n     }\n-\n-    Py_INCREF(prev_task);\n-\n+    /* If task == Py_None, prev_task was already incref'ed above */\n+    if (task != Py_None) {\n+        Py_INCREF(prev_task);\n+    }\n     return prev_task;\n }\n \n", "result": false, "error": "Traceback (most recent call last):\n  File \"/gentest-cpython/py-pr-105987/generated_3.py\", line 53, in <module>\n    rc, out, err = assert_python_ok(\"-c\", code)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/tmp/py-pr-105987/build/Lib/test/support/script_helper.py\", line 166, in assert_python_ok\n    return _assert_python(True, *args, **env_vars)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/tmp/py-pr-105987/build/Lib/test/support/script_helper.py\", line 151, in _assert_python\n    res.fail(cmd_line)\n  File \"/tmp/py-pr-105987/build/Lib/test/support/script_helper.py\", line 76, in fail\n    raise AssertionError(\"Process return code is %d\\n\"\nAssertionError: Process return code is 1\ncommand line: ['/tmp/py-pr-105987/build/python', '-X', 'faulthandler', '-I', '-c', 'if 1:\\n    import _asyncio, gc\\n\\n    class DummyLoop:\\n        pass\\n\\n    class DummyTask:\\n        pass\\n\\n    l = DummyLoop()\\n    # Ensure the asyncio module knows about this loop (mirrors reference check)\\n    if hasattr(_asyncio, \\'_set_running_loop\\'):\\n        _asyncio._set_running_loop(l)\\n\\n    # 1) Set a task so that it is held only by the internal mapping\\n    t = DummyTask()\\n    _asyncio._swap_current_task(l, t)  # store t; returns previous (likely None)\\n    del t  # Drop external reference; only the internal dict should hold it now\\n    gc.collect()\\n\\n    # 2) Replace with a new task. Previously, this could decref the old task to 0\\n    # before returning it, causing a crash. Verify we get a live object back.\\n    prev1 = _asyncio._swap_current_task(l, DummyTask())\\n    assert isinstance(prev1, DummyTask), f\"Expected previous to be DummyTask on replace, got: {type(prev1)}\"\\n    # Interact with the object to ensure it\\'s alive and usable\\n    prev1.marker = \\'alive\\'\\n    assert getattr(prev1, \\'marker\\', None) == \\'alive\\', \"Previous task object not usable after replace\"\\n\\n    # 3) Now the current task is the newly set DummyTask() from step 2, and there\\n    # are no external references to it. Deleting the mapping should return that\\n    # task and it must still be alive.\\n    gc.collect()\\n    prev2 = _asyncio._swap_current_task(l, None)\\n    assert isinstance(prev2, DummyTask), f\"Expected previous to be DummyTask on delete, got: {type(prev2)}\"\\n    prev2.alive2 = True\\n    assert getattr(prev2, \\'alive2\\', False) is True, \"Previous task after delete not usable\"\\n\\n    # 4) With mapping empty, setting a new task should return None as previous\\n    prev3 = _asyncio._swap_current_task(l, DummyTask())\\n    assert prev3 is None, f\"Expected None when setting new task on empty mapping, got: {prev3!r}\"\\n']\n\nstdout:\n---\n\n---\n\nstderr:\n---\n(... truncated stderr ...):21\n    #17 0x56285b0a2808 in Py_RunMain /tmp/py-pr-105987/build/Modules/main.c:688:5\n    #18 0x56285b0a34d8 in pymain_main /tmp/py-pr-105987/build/Modules/main.c:718:12\n    #19 0x56285b0a35e7 in Py_BytesMain /tmp/py-pr-105987/build/Modules/main.c:742:12\n    #20 0x56285a9a8481 in main /tmp/py-pr-105987/build/./Programs/python.c:15:12\n    #21 0x7f5cd89421c9  (/lib/x86_64-linux-gnu/libc.so.6+0x2a1c9) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\n    #22 0x7f5cd894228a in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2a28a) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\n    #23 0x56285a8cf074 in _start (/tmp/py-pr-105987/build/python+0x270074) (BuildId: b5f2a9ed6c22c358256c428e257a446d4340fdbf)\n\n0x5040001faf70 is located 32 bytes inside of 48-byte region [0x5040001faf50,0x5040001faf80)\nfreed by thread T0 here:\n    #0 0x56285a969c2a in free (/tmp/py-pr-105987/build/python+0x30ac2a) (BuildId: b5f2a9ed6c22c358256c428e257a446d4340fdbf)\n    #1 0x56285ac7adc8 in _PyMem_RawFree /tmp/py-pr-105987/build/Objects/obmalloc.c:73:5\n    #2 0x56285ac7cf8f in PyObject_Free /tmp/py-pr-105987/build/Objects/obmalloc.c:830:5\n    #3 0x56285b0aa996 in PyObject_GC_Del /tmp/py-pr-105987/build/Modules/gcmodule.c:2396:5\n    #4 0x56285acb00a5 in object_dealloc /tmp/py-pr-105987/build/Objects/t"}