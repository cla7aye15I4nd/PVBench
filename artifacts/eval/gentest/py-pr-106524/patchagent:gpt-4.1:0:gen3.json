{"patch": "diff --git a/Modules/_sre/sre.c b/Modules/_sre/sre.c\nindex 3f11916f9e1..37809fbfb8d 100644\n--- a/Modules/_sre/sre.c\n+++ b/Modules/_sre/sre.c\n@@ -1566,7 +1566,10 @@ _sre_template_impl(PyObject *module, PyObject *pattern, PyObject *template)\n \n bad_template:\n     PyErr_SetString(PyExc_TypeError, \"invalid template\");\n-    Py_XDECREF(self);\n+    if (self) {\n+        // self may be partially initialized, so do not call Py_XDECREF (which would call tp_dealloc)\n+        PyObject_GC_Del(self);\n+    }\n     return NULL;\n }\n \n", "result": false, "error": "Traceback (most recent call last):\n  File \"/gentest-cpython/py-pr-106524/generated_3.py\", line 112, in <module>\n    main()\n  File \"/gentest-cpython/py-pr-106524/generated_3.py\", line 104, in main\n    test_no_crash_and_typeerror_on_non_integer_index_subprocess()\n  File \"/gentest-cpython/py-pr-106524/generated_3.py\", line 40, in test_no_crash_and_typeerror_on_non_integer_index_subprocess\n    rc, out, err = assert_python_ok('-c', code)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/tmp/py-pr-106524/build/Lib/test/support/script_helper.py\", line 166, in assert_python_ok\n    return _assert_python(True, *args, **env_vars)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/tmp/py-pr-106524/build/Lib/test/support/script_helper.py\", line 151, in _assert_python\n    res.fail(cmd_line)\n  File \"/tmp/py-pr-106524/build/Lib/test/support/script_helper.py\", line 76, in fail\n    raise AssertionError(\"Process return code is %d\\n\"\nAssertionError: Process return code is 1\ncommand line: ['/tmp/py-pr-106524/build/python', '-X', 'faulthandler', '-I', '-c', 'if 1:\\n        import _sre\\n        try:\\n            _sre.template(\"\", [\"\", (), \"\"])  # non-integer index\\n        except TypeError as e:\\n            print(\"OK:TypeError\", str(e))\\n        else:\\n            print(\"FAIL: no exception\")\\n    ']\n\nstdout:\n---\n\n---\n\nstderr:\n---\nFatal Python error: Segmentation fault\n\nCurrent thread 0x00007fd4718db300 (most recent call first):\n  File \"<string>\", line 4 in <module>\nAddressSanitizer:DEADLYSIGNAL\n=================================================================\n==1715387==ERROR: AddressSanitizer: SEGV on unknown address 0x0000001a2cbb (pc 0x7fd47197ab2c bp 0x529000008730 sp 0x5290000086f0 T0)\n==1715387==The signal is caused by a READ memory access.\n    #0 0x7fd47197ab2c in pthread_kill (/lib/x86_64-linux-gnu/libc.so.6+0x9eb2c) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\n    #1 0x7fd47192127d in raise (/lib/x86_64-linux-gnu/libc.so.6+0x4527d) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\n    #2 0x564488f91d41 in faulthandler_fatal_error /tmp/py-pr-106524/build/./Modules/faulthandler.c:330:5\n    #3 0x7fd47192132f  (/lib/x86_64-linux-gnu/libc.so.6+0x4532f) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\n    #4 0x5644890dd15e in _Py_IsImmortal /tmp/py-pr-106524/build/./Include/object.h:227:12\n    #5 0x5644890dd15e in Py_DECREF /tmp/py-pr-106524/build/./Include/object.h:689:9\n    #6 0x5644890dd15e in template_clear /tmp/py-pr-106524/build/./Modules/_sre/sre.c:2794:9\n    #7 0x5644890dcc0a in template_dealloc /tmp/py-pr-106524/build/./Modules/_sre/sre.c:2805:11\n    #8 0x564488b378f3 in _Py_Dealloc /tmp/py-pr-106524/build/Objects/object.c:2578:5\n    #9 0x564489085904 in Py_DECREF /tmp/py-pr-106524/build/./Include/object.h:694:9\n    #10 0x564489085904 in _sre_template_impl /tmp/py-pr-106524/build/./Modules/_sre/sre.c:1547:13\n    #11 0x564489080f0e in _sre_template /tmp/py-pr-106524/build/./Modules/_sre/clinic/sre.c.h:1104:20\n    #12 0x564488b23aad in cfunction_vectorcall_FASTCALL /tmp/py-pr-106524/build/Objects/methodobject.c:423:24\n    #13 0x564488a2a68f in _PyObject_VectorcallTstate /tmp/py-pr-106524/build/./Include/internal/pycore_call.h:186:11\n    #14 0x564488a2c139 in PyObject_Vectorcall /tmp/py-pr-106524/build/Objects/call.c:326:12\n    #15 0x564488d76e9d in _PyEval_EvalFrameDefault /tmp/py-pr-106524/build/Python/bytecodes.c:2813:19\n    #16 0x564488d4a581 in _PyEval_EvalFrame /tmp/py-pr-106524/build/./Include/internal/pycore_ceval.h:88:16\n    #17 0x564488d4a43e in _PyEval_Vector /tmp/py-pr-106524/build/Python/ceval.c:1609:12\n    #18 0x564488d49dcf in PyEval_EvalCode /tmp/py-pr-106524/build/Python/ceval.c:572:21\n    #19 0x564488efef04 in run_eval_code_obj /tmp/py-pr-106524/build/Python/pythonrun.c:1724:9\n    #20 0x564488ef7d05 in run_mod /tmp/py-pr-106524/build/Python/pythonrun.c:1745:19\n    #21 0x564488ef637e in PyRun_StringFlags /tmp/py-pr-106524/build/Python/pythonrun.c:1620:15\n    #22 0x564488ef6147 in PyRun_SimpleStr"}