{"patch": "diff --git a/Modules/_sre/sre.c b/Modules/_sre/sre.c\nindex 3f11916f9e1..defb8e752c8 100644\n--- a/Modules/_sre/sre.c\n+++ b/Modules/_sre/sre.c\n@@ -1544,10 +1544,18 @@ _sre_template_impl(PyObject *module, PyObject *pattern, PyObject *template)\n     for (Py_ssize_t i = 0; i < n; i++) {\n         Py_ssize_t index = PyLong_AsSsize_t(PyList_GET_ITEM(template, 2*i+1));\n         if (index == -1 && PyErr_Occurred()) {\n+            /* Ensure all uninitialized slots are NULL for safe deallocation */\n+            for (Py_ssize_t j = i; j < n; j++) {\n+                self->items[j].literal = NULL;\n+            }\n             Py_DECREF(self);\n             return NULL;\n         }\n         if (index < 0) {\n+            /* Ensure all uninitialized slots are NULL for safe deallocation */\n+            for (Py_ssize_t j = i; j < n; j++) {\n+                self->items[j].literal = NULL;\n+            }\n             goto bad_template;\n         }\n         self->items[i].index = index;\n@@ -1565,6 +1573,12 @@ _sre_template_impl(PyObject *module, PyObject *pattern, PyObject *template)\n     return (PyObject*) self;\n \n bad_template:\n+    /* Ensure all slots are NULL for safe deallocation */\n+    if (self) {\n+        for (Py_ssize_t j = 0; j < n; j++) {\n+            self->items[j].literal = NULL;\n+        }\n+    }\n     PyErr_SetString(PyExc_TypeError, \"invalid template\");\n     Py_XDECREF(self);\n     return NULL;\n", "result": true}