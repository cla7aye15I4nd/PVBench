{"patch": "diff --git a/Modules/_lsprof.c b/Modules/_lsprof.c\nindex 5cf9eba243b..a3485f7e473 100644\n--- a/Modules/_lsprof.c\n+++ b/Modules/_lsprof.c\n@@ -296,7 +296,6 @@ initContext(ProfilerObject *pObj, ProfilerContext *self, ProfilerEntry *entry)\n     self->ctxEntry = entry;\n     self->subt = 0;\n     self->previous = pObj->currentProfilerContext;\n-    pObj->currentProfilerContext = self;\n     ++entry->recursionLevel;\n     if ((pObj->flags & POF_SUBCALLS) && self->previous) {\n         /* find or create an entry for me in my caller's entry */\n@@ -308,12 +307,16 @@ initContext(ProfilerObject *pObj, ProfilerContext *self, ProfilerEntry *entry)\n             ++subentry->recursionLevel;\n     }\n     self->t0 = call_timer(pObj);\n+    pObj->currentProfilerContext = self;\n }\n \n static void\n Stop(ProfilerObject *pObj, ProfilerContext *self, ProfilerEntry *entry)\n {\n+    ProfilerContext *saved_context = pObj->currentProfilerContext;\n+    pObj->currentProfilerContext = self->previous;\n     PyTime_t tt = call_timer(pObj) - self->t0;\n+    pObj->currentProfilerContext = saved_context;\n     PyTime_t it = tt - self->subt;\n     if (self->previous)\n         self->previous->subt += tt;\n", "result": true}