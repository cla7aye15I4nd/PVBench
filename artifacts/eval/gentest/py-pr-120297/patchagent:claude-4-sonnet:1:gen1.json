{"patch": "diff --git a/Modules/_lsprof.c b/Modules/_lsprof.c\nindex 5cf9eba243b..367dfbbef6b 100644\n--- a/Modules/_lsprof.c\n+++ b/Modules/_lsprof.c\n@@ -755,15 +755,25 @@ profiler_enable(ProfilerObject *self, PyObject *args, PyObject *kwds)\n static void\n flush_unmatched(ProfilerObject *pObj)\n {\n+    /* Collect all contexts first to avoid recursive issues */\n+    ProfilerContext *contexts_to_free = NULL;\n     while (pObj->currentProfilerContext) {\n         ProfilerContext *pContext = pObj->currentProfilerContext;\n-        ProfilerEntry *profEntry= pContext->ctxEntry;\n-        if (profEntry)\n-            Stop(pObj, pContext, profEntry);\n-        else\n-            pObj->currentProfilerContext = pContext->previous;\n-        if (pContext)\n-            PyMem_Free(pContext);\n+        pObj->currentProfilerContext = pContext->previous;\n+        /* Add to list of contexts to free */\n+        pContext->previous = contexts_to_free;\n+        contexts_to_free = pContext;\n+    }\n+    \n+    /* Now process and free all contexts */\n+    while (contexts_to_free) {\n+        ProfilerContext *pContext = contexts_to_free;\n+        contexts_to_free = pContext->previous;\n+        ProfilerEntry *profEntry = pContext->ctxEntry;\n+        if (profEntry) {\n+            /* Process the entry without calling Stop to avoid recursion */\n+            ++profEntry->callcount;\n+        }\n     }\n \n }\n", "result": true}