{"patch": "diff --git a/Modules/_lsprof.c b/Modules/_lsprof.c\nindex 5cf9eba243b..301361b4d7e 100644\n--- a/Modules/_lsprof.c\n+++ b/Modules/_lsprof.c\n@@ -757,14 +757,21 @@ flush_unmatched(ProfilerObject *pObj)\n {\n     while (pObj->currentProfilerContext) {\n         ProfilerContext *pContext = pObj->currentProfilerContext;\n-        ProfilerEntry *profEntry= pContext->ctxEntry;\n-        if (profEntry)\n+        ProfilerEntry *profEntry = pContext->ctxEntry;\n+        if (profEntry) {\n+            // Stop() will update pObj->currentProfilerContext,\n+            // and the context will be handled there. So do NOT\n+            // free pContext manually here.\n             Stop(pObj, pContext, profEntry);\n-        else\n+            // continue; next loop iteration will use updated currentProfilerContext\n+        } else {\n+            // In this case, we need to update currentProfilerContext and free manually.\n             pObj->currentProfilerContext = pContext->previous;\n-        if (pContext)\n             PyMem_Free(pContext);\n+        }\n     }\n+    // Defensive: set to NULL after all have been processed\n+    pObj->currentProfilerContext = NULL;\n \n }\n \n", "result": true}