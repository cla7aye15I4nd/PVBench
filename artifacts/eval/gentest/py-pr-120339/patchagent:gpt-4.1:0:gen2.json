{"patch": "diff --git a/Objects/listobject.c b/Objects/listobject.c\nindex f59abe2e644..81210eda81b 100644\n--- a/Objects/listobject.c\n+++ b/Objects/listobject.c\n@@ -2758,8 +2758,17 @@ list_richcompare(PyObject *v, PyObject *w, int op)\n         Py_RETURN_TRUE;\n     }\n \n-    /* Compare the final item again using the proper operator */\n-    return PyObject_RichCompare(vl->ob_item[i], wl->ob_item[i], op);\n+    /* Compare the final item again using the proper operator.\n+       Hold references to the items to avoid use-after-free if\n+       the comparison causes side effects. */\n+    PyObject *vitem = vl->ob_item[i];\n+    PyObject *witem = wl->ob_item[i];\n+    Py_INCREF(vitem);\n+    Py_INCREF(witem);\n+    PyObject *res = PyObject_RichCompare(vitem, witem, op);\n+    Py_DECREF(vitem);\n+    Py_DECREF(witem);\n+    return res;\n }\n \n /*[clinic input]\n", "result": true}