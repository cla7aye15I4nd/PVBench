{"patch": "diff --git a/Modules/_lsprof.c b/Modules/_lsprof.c\nindex 5cf9eba243b..778a61c7ea2 100644\n--- a/Modules/_lsprof.c\n+++ b/Modules/_lsprof.c\n@@ -294,6 +294,7 @@ static void\n initContext(ProfilerObject *pObj, ProfilerContext *self, ProfilerEntry *entry)\n {\n     self->ctxEntry = entry;\n+    PyTime_t t0 = call_timer(pObj);\n     self->subt = 0;\n     self->previous = pObj->currentProfilerContext;\n     pObj->currentProfilerContext = self;\n@@ -307,26 +308,30 @@ initContext(ProfilerObject *pObj, ProfilerContext *self, ProfilerEntry *entry)\n         if (subentry)\n             ++subentry->recursionLevel;\n     }\n-    self->t0 = call_timer(pObj);\n+    self->t0 = t0;\n }\n \n static void\n Stop(ProfilerObject *pObj, ProfilerContext *self, ProfilerEntry *entry)\n {\n-    PyTime_t tt = call_timer(pObj) - self->t0;\n-    PyTime_t it = tt - self->subt;\n-    if (self->previous)\n-        self->previous->subt += tt;\n-    pObj->currentProfilerContext = self->previous;\n+    PyTime_t t0 = self->t0;\n+    PyTime_t subt = self->subt;\n+    ProfilerContext *previous = self->previous;\n+    PyTime_t timer_result = call_timer(pObj);\n+    PyTime_t tt = timer_result - t0;\n+    PyTime_t it = tt - subt;\n+    if (previous)\n+        previous->subt += tt;\n+    pObj->currentProfilerContext = previous;\n     if (--entry->recursionLevel == 0)\n         entry->tt += tt;\n     else\n         ++entry->recursivecallcount;\n     entry->it += it;\n     entry->callcount++;\n-    if ((pObj->flags & POF_SUBCALLS) && self->previous) {\n+    if ((pObj->flags & POF_SUBCALLS) && previous) {\n         /* find or create an entry for me in my caller's entry */\n-        ProfilerEntry *caller = self->previous->ctxEntry;\n+        ProfilerEntry *caller = previous->ctxEntry;\n         ProfilerSubEntry *subentry = getSubEntry(pObj, caller, entry);\n         if (subentry) {\n             if (--subentry->recursionLevel == 0)\n@@ -393,16 +398,20 @@ ptrace_leave_call(PyObject *self, void *key)\n     pContext = pObj->currentProfilerContext;\n     if (pContext == NULL)\n         return;\n+    ProfilerContext *previous = pContext->previous;\n+    ProfilerContext *freelist = pObj->freelistProfilerContext;\n     profEntry = getEntry(pObj, key);\n     if (profEntry) {\n         Stop(pObj, pContext, profEntry);\n     }\n     else {\n-        pObj->currentProfilerContext = pContext->previous;\n+        pObj->currentProfilerContext = previous;\n     }\n     /* put pContext into the free list */\n-    pContext->previous = pObj->freelistProfilerContext;\n+    if (pObj->flags & POF_ENABLED) {\n+        pContext->previous = freelist;\n     pObj->freelistProfilerContext = pContext;\n+    }\n }\n \n static int\n", "result": true}