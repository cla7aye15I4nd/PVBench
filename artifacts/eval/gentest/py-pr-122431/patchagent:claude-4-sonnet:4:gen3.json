{"patch": "diff --git a/Modules/readline.c b/Modules/readline.c\nindex 35655c70a46..c5e5765259e 100644\n--- a/Modules/readline.c\n+++ b/Modules/readline.c\n@@ -362,8 +362,13 @@ readline_append_history_file_impl(PyObject *module, int nelements,\n         filename_bytes = NULL;\n         filename = NULL;\n     }\n-    errno = err = append_history(\n-        nelements - libedit_append_replace_history_offset, filename);\n+    int adjusted_nelements = nelements - libedit_append_replace_history_offset;\n+    if (adjusted_nelements <= 0) {\n+        PyErr_SetString(PyExc_ValueError, \"nelements must be positive\");\n+        Py_XDECREF(filename_bytes);\n+        return NULL;\n+    }\n+    errno = err = append_history(adjusted_nelements, filename);\n     if (!err && _history_length >= 0)\n         history_truncate_file(filename, _history_length);\n     Py_XDECREF(filename_bytes);\n", "result": false, "error": "Traceback (most recent call last):\n  File \"/gentest-cpython/py-pr-122431/generated_3.py\", line 114, in <module>\n    main()\n    ~~~~^^\n  File \"/gentest-cpython/py-pr-122431/generated_3.py\", line 110, in main\n    test_non_negative_values_do_not_raise()\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/gentest-cpython/py-pr-122431/generated_3.py\", line 79, in test_non_negative_values_do_not_raise\n    result0 = readline.append_history_file(0, path0)\nValueError: nelements must be positive\n"}