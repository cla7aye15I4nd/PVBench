{"patch": "diff --git a/Modules/_elementtree.c b/Modules/_elementtree.c\nindex b73bd844626..5dbf0a2c583 100644\n--- a/Modules/_elementtree.c\n+++ b/Modules/_elementtree.c\n@@ -1630,43 +1630,67 @@ _elementtree_Element_remove_impl(ElementObject *self, PyObject *subelement)\n {\n     Py_ssize_t i;\n     int rc;\n-    PyObject *found;\n+    PyObject *found = NULL;\n+    ElementObjectExtra *extra = self ? self->extra : NULL;\n+    Py_ssize_t length;\n+    PyObject **children = NULL;\n \n-    if (!self->extra) {\n-        /* element has no children, so raise exception */\n+    if (!extra) {\n         PyErr_SetString(\n             PyExc_ValueError,\n             \"list.remove(x): x not in list\"\n-            );\n+        );\n         return NULL;\n     }\n \n-    for (i = 0; i < self->extra->length; i++) {\n-        if (self->extra->children[i] == subelement)\n+    length = extra->length;\n+    if (length > 0) {\n+        children = (PyObject **)PyMem_Malloc(sizeof(PyObject *) * length);\n+        if (!children) {\n+            PyErr_NoMemory();\n+            return NULL;\n+        }\n+        for (i = 0; i < length; i++) {\n+            children[i] = extra->children[i];\n+            Py_XINCREF(children[i]);\n+        }\n+    }\n+\n+    for (i = 0; i < length; i++) {\n+        if (children[i] == subelement)\n             break;\n-        rc = PyObject_RichCompareBool(self->extra->children[i], subelement, Py_EQ);\n+        rc = PyObject_RichCompareBool(children[i], subelement, Py_EQ);\n         if (rc > 0)\n             break;\n         if (rc < 0)\n-            return NULL;\n+            goto cleanup;\n     }\n \n-    if (i >= self->extra->length) {\n-        /* subelement is not in children, so raise exception */\n+    if (i >= length) {\n         PyErr_SetString(\n             PyExc_ValueError,\n             \"list.remove(x): x not in list\"\n-            );\n-        return NULL;\n+        );\n+        goto cleanup;\n     }\n \n-    found = self->extra->children[i];\n-\n-    self->extra->length--;\n-    for (; i < self->extra->length; i++)\n-        self->extra->children[i] = self->extra->children[i+1];\n-\n+    found = children[i];\n+    extra = self->extra;\n+    if (extra && i < extra->length && extra->children[i] == found) {\n+        extra->length--;\n+        for (; i < extra->length; i++)\n+            extra->children[i] = extra->children[i+1];\n+    }\n     Py_DECREF(found);\n+cleanup:\n+    if (children) {\n+        for (i = 0; i < length; i++) {\n+            Py_XDECREF(children[i]);\n+        }\n+        PyMem_Free(children);\n+    }\n+    if (PyErr_Occurred())\n+        return NULL;\n     Py_RETURN_NONE;\n }\n \n", "result": true}