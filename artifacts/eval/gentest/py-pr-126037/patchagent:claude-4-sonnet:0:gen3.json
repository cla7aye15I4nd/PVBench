{"patch": "diff --git a/Modules/_elementtree.c b/Modules/_elementtree.c\nindex d20bbcd21fd..35c2d93d9b0 100644\n--- a/Modules/_elementtree.c\n+++ b/Modules/_elementtree.c\n@@ -1254,6 +1254,8 @@ _elementtree_Element_find_impl(ElementObject *self, PyTypeObject *cls,\n {\n     Py_ssize_t i;\n     elementtreestate *st = get_elementtree_state_by_cls(cls);\n+    Py_ssize_t length;\n+    PyObject **children;\n \n     if (checkpath(path) || namespaces != Py_None) {\n         return PyObject_CallMethodObjArgs(\n@@ -1264,8 +1266,12 @@ _elementtree_Element_find_impl(ElementObject *self, PyTypeObject *cls,\n     if (!self->extra)\n         Py_RETURN_NONE;\n \n-    for (i = 0; i < self->extra->length; i++) {\n-        PyObject* item = self->extra->children[i];\n+    /* Make local copies to avoid use-after-free if extra gets deallocated */\n+    length = self->extra->length;\n+    children = self->extra->children;\n+\n+    for (i = 0; i < length; i++) {\n+        PyObject* item = children[i];\n         int rc;\n         assert(Element_Check(st, item));\n         Py_INCREF(item);\n", "result": false, "error": "Traceback (most recent call last):\n  File \"/gentest-cpython/py-pr-126037/generated_3.py\", line 165, in <module>\n    r1 = run_subprocess_resilient(code1, 'OK1')\n  File \"/gentest-cpython/py-pr-126037/generated_3.py\", line 34, in run_subprocess_resilient\n    assert segv, f\"Unexpected failure (rc={rc}). stderr: {err!r}, stdout: {out!r}\"\n           ^^^^\nAssertionError: Unexpected failure (rc=1). stderr: '=================================================================\\n==582640==ERROR: AddressSanitizer: heap-use-after-free on address 0x50600016de68 at pc 0x7f47b10391b2 bp 0x7ffc90ab0940 sp 0x7ffc90ab0938\\nREAD of size 8 at 0x50600016de68 thread T0\\n    #0 0x7f47b10391b1 in _elementtree_Element_find_impl /tmp/py-pr-126037/build/./Modules/_elementtree.c:1274:26\\n    #1 0x7f47b1036a49 in _elementtree_Element_find /tmp/py-pr-126037/build/./Modules/clinic/_elementtree.c.h:317:20\\n    #2 0x55bf65bd75ef in method_vectorcall_FASTCALL_KEYWORDS_METHOD /tmp/py-pr-126037/build/Objects/descrobject.c:381:24\\n    #3 0x55bf65bae71f in _PyObject_VectorcallTstate /tmp/py-pr-126037/build/./Include/internal/pycore_call.h:169:11\\n    #4 0x55bf65bb0339 in PyObject_Vectorcall /tmp/py-pr-126037/build/Objects/call.c:327:12\\n    #5 0x55bf65fb9439 in _PyEval_EvalFrameDefault /tmp/py-pr-126037/build/Python/generated_cases.c.h:1366:35\\n    #6 0x55bf65fb2471 in _PyEval_EvalFrame /tmp/py-pr-126037/build/./Include/internal/pycore_ceval.h:119:16\\n    #7 0x55bf65fb22fc in _PyEval_Vector /tmp/py-pr-126037/build/Python/ceval.c:1908:12\\n    #8 0x55bf65fb1bda in PyEval_EvalCode /tmp/py-pr-126037/build/Python/ceval.c:836:21\\n    #9 0x55bf6618f116 in run_eval_code_obj /tmp/py-pr-126037/build/Python/pythonrun.c:1365:12\\n    #10 0x55bf6618ee57 in run_mod /tmp/py-pr-126037/build/Python/pythonrun.c:1436:19\\n    #11 0x55bf6618a876 in _PyRun_StringFlagsWithName /tmp/py-pr-126037/build/Python/pythonrun.c:1259:15\\n    #12 0x55bf6618a41e in _PyRun_SimpleStringFlagsWithName /tmp/py-pr-126037/build/Python/pythonrun.c:578:15\\n    #13 0x55bf66226ccc in pymain_run_command /tmp/py-pr-126037/build/Modules/main.c:255:11\\n    #14 0x55bf66225772 in pymain_run_python /tmp/py-pr-126037/build/Modules/main.c:671:21\\n    #15 0x55bf66224c72 in Py_RunMain /tmp/py-pr-126037/build/Modules/main.c:761:5\\n    #16 0x55bf66225da8 in pymain_main /tmp/py-pr-126037/build/Modules/main.c:791:12\\n    #17 0x55bf66225eb7 in Py_BytesMain /tmp/py-pr-126037/build/Modules/main.c:815:12\\n    #18 0x55bf65a0c511 in main /tmp/py-pr-126037/build/./Programs/python.c:15:12\\n    #19 0x7f47b321d1c9  (/lib/x86_64-linux-gnu/libc.so.6+0x2a1c9) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\\n    #20 0x7f47b321d28a in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2a28a) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\\n    #21 0x55bf65933104 in _start (/tmp/py-pr-126037/build/python+0x1a2104) (BuildId: 9b951e4c9846de47f77e7f9be4020f3612a7e8ee)\\n\\n0x50600016de68 is located 40 bytes inside of 64-byte region [0x50600016de40,0x50600016de80)\\nfreed by thread T0 here:\\n    #0 0x55bf659cdcba in free (/tmp/py-pr-126037/build/python+0x23ccba) (BuildId: 9b951e4c9846de47f77e7f9be4020f3612a7e8ee)\\n    #1 0x55bf65d01198 in _PyMem_RawFree /tmp/py-pr-126037/build/Objects/obmalloc.c:91:5\\n    #2 0x55bf65d032f7 in PyMem_Free /tmp/py-pr-126037/build/Objects/obmalloc.c:1036:5\\n    #3 0x7f47b1036386 in dealloc_extra /tmp/py-pr-126037/build/./Modules/_elementtree.c:302:5\\n    #4 0x7f47b1035fe6 in clear_extra /tmp/py-pr-126037/build/./Modules/_elementtree.c:318:5\\n    #5 0x7f47b1038ac4 in _elementtree_Element_clear_impl /tmp/py-pr-126037/build/./Modules/_elementtree.c:738:5\\n    #6 0x7f47b10363b8 in _elementtree_Element_clear /tmp/py-pr-126037/build/./Modules/clinic/_elementtree.c.h:74:12\\n    #7 0x55bf65bd7210 in method_vectorcall_NOARGS /tmp/py-pr-126037/build/Objects/descrobject.c:448:24\\n    #8 0x55bf65bae71f in _PyObject_VectorcallTstate /tmp/py-pr-126037/build/./Include/internal/pycore_call.h:169:11\\n    #9 0x55bf65bb0339 in PyO"}