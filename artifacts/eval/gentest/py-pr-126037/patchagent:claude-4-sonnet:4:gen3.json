{"patch": "diff --git a/Modules/_elementtree.c b/Modules/_elementtree.c\nindex d20bbcd21fd..a777f7c8eaa 100644\n--- a/Modules/_elementtree.c\n+++ b/Modules/_elementtree.c\n@@ -1253,6 +1253,8 @@ _elementtree_Element_find_impl(ElementObject *self, PyTypeObject *cls,\n /*[clinic end generated code: output=18f77d393c9fef1b input=94df8a83f956acc6]*/\n {\n     Py_ssize_t i;\n+    Py_ssize_t length;\n+    ElementObjectExtra *extra;\n     elementtreestate *st = get_elementtree_state_by_cls(cls);\n \n     if (checkpath(path) || namespaces != Py_None) {\n@@ -1264,8 +1266,13 @@ _elementtree_Element_find_impl(ElementObject *self, PyTypeObject *cls,\n     if (!self->extra)\n         Py_RETURN_NONE;\n \n-    for (i = 0; i < self->extra->length; i++) {\n-        PyObject* item = self->extra->children[i];\n+    /* Store extra and length in local variables to prevent use-after-free\n+       if self->extra gets freed during PyObject_RichCompareBool */\n+    extra = self->extra;\n+    length = extra->length;\n+\n+    for (i = 0; i < length; i++) {\n+        PyObject* item = extra->children[i];\n         int rc;\n         assert(Element_Check(st, item));\n         Py_INCREF(item);\n", "result": false, "error": "Traceback (most recent call last):\n  File \"/gentest-cpython/py-pr-126037/generated_3.py\", line 165, in <module>\n    r1 = run_subprocess_resilient(code1, 'OK1')\n  File \"/gentest-cpython/py-pr-126037/generated_3.py\", line 34, in run_subprocess_resilient\n    assert segv, f\"Unexpected failure (rc={rc}). stderr: {err!r}, stdout: {out!r}\"\n           ^^^^\nAssertionError: Unexpected failure (rc=1). stderr: '=================================================================\\n==1505644==ERROR: AddressSanitizer: heap-use-after-free on address 0x50600016de58 at pc 0x7f70ddfdd147 bp 0x7ffc67ed5a90 sp 0x7ffc67ed5a88\\nREAD of size 8 at 0x50600016de58 thread T0\\n    #0 0x7f70ddfdd146 in _elementtree_Element_find_impl /tmp/py-pr-126037/build/./Modules/_elementtree.c:1275:33\\n    #1 0x7f70ddfdaa49 in _elementtree_Element_find /tmp/py-pr-126037/build/./Modules/clinic/_elementtree.c.h:317:20\\n    #2 0x55ab4c0fe5ef in method_vectorcall_FASTCALL_KEYWORDS_METHOD /tmp/py-pr-126037/build/Objects/descrobject.c:381:24\\n    #3 0x55ab4c0d571f in _PyObject_VectorcallTstate /tmp/py-pr-126037/build/./Include/internal/pycore_call.h:169:11\\n    #4 0x55ab4c0d7339 in PyObject_Vectorcall /tmp/py-pr-126037/build/Objects/call.c:327:12\\n    #5 0x55ab4c4e0439 in _PyEval_EvalFrameDefault /tmp/py-pr-126037/build/Python/generated_cases.c.h:1366:35\\n    #6 0x55ab4c4d9471 in _PyEval_EvalFrame /tmp/py-pr-126037/build/./Include/internal/pycore_ceval.h:119:16\\n    #7 0x55ab4c4d92fc in _PyEval_Vector /tmp/py-pr-126037/build/Python/ceval.c:1908:12\\n    #8 0x55ab4c4d8bda in PyEval_EvalCode /tmp/py-pr-126037/build/Python/ceval.c:836:21\\n    #9 0x55ab4c6b6116 in run_eval_code_obj /tmp/py-pr-126037/build/Python/pythonrun.c:1365:12\\n    #10 0x55ab4c6b5e57 in run_mod /tmp/py-pr-126037/build/Python/pythonrun.c:1436:19\\n    #11 0x55ab4c6b1876 in _PyRun_StringFlagsWithName /tmp/py-pr-126037/build/Python/pythonrun.c:1259:15\\n    #12 0x55ab4c6b141e in _PyRun_SimpleStringFlagsWithName /tmp/py-pr-126037/build/Python/pythonrun.c:578:15\\n    #13 0x55ab4c74dccc in pymain_run_command /tmp/py-pr-126037/build/Modules/main.c:255:11\\n    #14 0x55ab4c74c772 in pymain_run_python /tmp/py-pr-126037/build/Modules/main.c:671:21\\n    #15 0x55ab4c74bc72 in Py_RunMain /tmp/py-pr-126037/build/Modules/main.c:761:5\\n    #16 0x55ab4c74cda8 in pymain_main /tmp/py-pr-126037/build/Modules/main.c:791:12\\n    #17 0x55ab4c74ceb7 in Py_BytesMain /tmp/py-pr-126037/build/Modules/main.c:815:12\\n    #18 0x55ab4bf33511 in main /tmp/py-pr-126037/build/./Programs/python.c:15:12\\n    #19 0x7f70e09f21c9  (/lib/x86_64-linux-gnu/libc.so.6+0x2a1c9) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\\n    #20 0x7f70e09f228a in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2a28a) (BuildId: 274eec488d230825a136fa9c4d85370fed7a0a5e)\\n    #21 0x55ab4be5a104 in _start (/tmp/py-pr-126037/build/python+0x1a2104) (BuildId: 01e5ab6386997a2b99020f9db62df778ea9b3e98)\\n\\n0x50600016de58 is located 24 bytes inside of 64-byte region [0x50600016de40,0x50600016de80)\\nfreed by thread T0 here:\\n    #0 0x55ab4bef4cba in free (/tmp/py-pr-126037/build/python+0x23ccba) (BuildId: 01e5ab6386997a2b99020f9db62df778ea9b3e98)\\n    #1 0x55ab4c228198 in _PyMem_RawFree /tmp/py-pr-126037/build/Objects/obmalloc.c:91:5\\n    #2 0x55ab4c22a2f7 in PyMem_Free /tmp/py-pr-126037/build/Objects/obmalloc.c:1036:5\\n    #3 0x7f70ddfda386 in dealloc_extra /tmp/py-pr-126037/build/./Modules/_elementtree.c:302:5\\n    #4 0x7f70ddfd9fe6 in clear_extra /tmp/py-pr-126037/build/./Modules/_elementtree.c:318:5\\n    #5 0x7f70ddfdcac4 in _elementtree_Element_clear_impl /tmp/py-pr-126037/build/./Modules/_elementtree.c:738:5\\n    #6 0x7f70ddfda3b8 in _elementtree_Element_clear /tmp/py-pr-126037/build/./Modules/clinic/_elementtree.c.h:74:12\\n    #7 0x55ab4c0fe210 in method_vectorcall_NOARGS /tmp/py-pr-126037/build/Objects/descrobject.c:448:24\\n    #8 0x55ab4c0d571f in _PyObject_VectorcallTstate /tmp/py-pr-126037/build/./Include/internal/pycore_call.h:169:11\\n    #9 0x55ab4c0d7339 in Py"}