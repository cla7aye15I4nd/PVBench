{"patch": "diff --git a/Modules/_asynciomodule.c b/Modules/_asynciomodule.c\nindex 7483e9c0f43..81e0d6cc6a0 100644\n--- a/Modules/_asynciomodule.c\n+++ b/Modules/_asynciomodule.c\n@@ -2967,8 +2967,17 @@ task_step_handle_result_impl(asyncio_state *state, TaskObj *task, PyObject *resu\n         if (task->task_must_cancel) {\n             PyObject *r;\n             int is_true;\n-            r = PyObject_CallMethodOneArg(result, &_Py_ID(cancel),\n-                                             task->task_cancel_msg);\n+            /* Get cancel method first to avoid use-after-free during method lookup */\n+            PyObject *cancel_method = PyObject_GetAttr(result, &_Py_ID(cancel));\n+            if (cancel_method == NULL) {\n+                return NULL;\n+            }\n+            PyObject *cancel_msg = task->task_cancel_msg;\n+            if (cancel_msg == NULL) {\n+                cancel_msg = Py_None;\n+            }\n+            r = PyObject_CallOneArg(cancel_method, cancel_msg);\n+            Py_DECREF(cancel_method);\n             if (r == NULL) {\n                 return NULL;\n             }\n@@ -3060,8 +3069,17 @@ task_step_handle_result_impl(asyncio_state *state, TaskObj *task, PyObject *resu\n         if (task->task_must_cancel) {\n             PyObject *r;\n             int is_true;\n-            r = PyObject_CallMethodOneArg(result, &_Py_ID(cancel),\n-                                             task->task_cancel_msg);\n+            /* Get cancel method first to avoid use-after-free during method lookup */\n+            PyObject *cancel_method = PyObject_GetAttr(result, &_Py_ID(cancel));\n+            if (cancel_method == NULL) {\n+                return NULL;\n+            }\n+            PyObject *cancel_msg = task->task_cancel_msg;\n+            if (cancel_msg == NULL) {\n+                cancel_msg = Py_None;\n+            }\n+            r = PyObject_CallOneArg(cancel_method, cancel_msg);\n+            Py_DECREF(cancel_method);\n             if (r == NULL) {\n                 return NULL;\n             }\n", "result": false, "error": "Traceback (most recent call last):\n  File \"/gentest-cpython/py-pr-126138/generated_3.py\", line 171, in <module>\n    test_uaf_no_crash_and_identity()\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/gentest-cpython/py-pr-126138/generated_3.py\", line 114, in test_uaf_no_crash_and_identity\n    assert m_cancel.group(1) == m_delete.group(1), (\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAssertionError: Expected same id for cancel message and deleted object; got 0x55879ada6fa0 vs 0x51300007c7e0.\nOutput:\ndeleting 0x51300007c7e0\nin cancel 0x55879ada6fa0\ndone\n\n"}