{"patch": "diff --git a/src/search.c b/src/search.c\nindex 01c143f69..2df8cecdc 100644\n--- a/src/search.c\n+++ b/src/search.c\n@@ -1547,17 +1547,22 @@ do_search(\n \t\t\tif (r != NULL)\n \t\t\t{\n \t\t\t    vim_free(msgbuf);\n-\t\t\t    msgbuf = r;\n-\t\t\t    // move reversed text to beginning of buffer\n-\t\t\t    while (*r != NUL && *r == ' ')\n-\t\t\t\tr++;\n-\t\t\t    pat_len = msgbuf + msgbuflen - r;\n-\t\t\t    mch_memmove(msgbuf, r, pat_len);\n-\t\t\t    // overwrite old text\n-\t\t\t    if ((size_t)(r - msgbuf) >= pat_len)\n-\t\t\t\tvim_memset(r, ' ', pat_len);\n-\t\t\t    else\n-\t\t\t\tvim_memset(msgbuf + pat_len, ' ', r - msgbuf);\n+                msgbuf = r;\n+                msgbuflen = STRLEN(msgbuf); // update to new buffer length\n+                char_u *start = msgbuf;\n+                // skip leading spaces\n+                while (*start != NUL && *start == ' ')\n+                    start++;\n+                pat_len = STRLEN(start);\n+                // move non-space part to beginning\n+                if (start != msgbuf && pat_len > 0)\n+                    mch_memmove(msgbuf, start, pat_len);\n+                // fill the rest with spaces, but do not overflow\n+                if (pat_len < msgbuflen)\n+                    vim_memset(msgbuf + pat_len, ' ', msgbuflen - pat_len);\n+                // NUL-terminate\n+                if (msgbuflen > 0)\n+                    msgbuf[msgbuflen] = NUL;\n \t\t\t}\n \t\t    }\n #endif\n", "result": true}