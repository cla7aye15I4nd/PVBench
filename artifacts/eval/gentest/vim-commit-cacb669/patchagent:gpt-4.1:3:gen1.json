{"patch": "diff --git a/src/search.c b/src/search.c\nindex 01c143f69..e20d339ad 100644\n--- a/src/search.c\n+++ b/src/search.c\n@@ -1547,17 +1547,34 @@ do_search(\n \t\t\tif (r != NULL)\n \t\t\t{\n \t\t\t    vim_free(msgbuf);\n-\t\t\t    msgbuf = r;\n-\t\t\t    // move reversed text to beginning of buffer\n-\t\t\t    while (*r != NUL && *r == ' ')\n-\t\t\t\tr++;\n-\t\t\t    pat_len = msgbuf + msgbuflen - r;\n-\t\t\t    mch_memmove(msgbuf, r, pat_len);\n-\t\t\t    // overwrite old text\n-\t\t\t    if ((size_t)(r - msgbuf) >= pat_len)\n-\t\t\t\tvim_memset(r, ' ', pat_len);\n-\t\t\t    else\n-\t\t\t\tvim_memset(msgbuf + pat_len, ' ', r - msgbuf);\n+                    size_t revlen = STRLEN(r);\n+                    if (msgbuflen > revlen) {\n+                        char_u *newbuf = alloc(msgbuflen + 1);\n+                        if (newbuf != NULL) {\n+                            mch_memmove(newbuf, r, revlen);\n+                            vim_memset(newbuf + revlen, ' ', msgbuflen - revlen);\n+                            newbuf[msgbuflen] = NUL;\n+                            vim_free(r);\n+                            msgbuf = newbuf;\n+                        } else {\n+                            // fallback: use the reversed buffer as is\n+                            msgbuf = r;\n+                        }\n+                    } else {\n+                        msgbuf = r;\n+                    }\n+                    // move reversed text to beginning of buffer\n+                    r = msgbuf;\n+                    while (*r != NUL && *r == ' ')\n+                        r++;\n+                    pat_len = msgbuf + msgbuflen - r;\n+                    if (pat_len > 0 && pat_len <= msgbuflen)\n+                        mch_memmove(msgbuf, r, pat_len);\n+                    // overwrite old text\n+                    if ((size_t)(r - msgbuf) >= pat_len)\n+                        vim_memset(r, ' ', pat_len);\n+                    else if (pat_len > 0 && pat_len <= msgbuflen)\n+                        vim_memset(msgbuf + pat_len, ' ', r - msgbuf);\n \t\t\t}\n \t\t    }\n #endif\n", "result": true}