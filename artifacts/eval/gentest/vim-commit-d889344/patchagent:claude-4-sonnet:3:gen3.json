{"patch": "diff --git a/src/ex_docmd.c b/src/ex_docmd.c\nindex 26acc07e0..6ac7c3c75 100644\n--- a/src/ex_docmd.c\n+++ b/src/ex_docmd.c\n@@ -3446,6 +3446,9 @@ append_command(char_u *cmd)\n \telse\n \t    MB_COPY_CHAR(s, d);\n     }\n+    // Ensure we don't write past the buffer boundary\n+    if (d >= IObuff + IOSIZE)\n+\td = IObuff + IOSIZE - 1;\n     *d = NUL;\n }\n \n", "result": true}