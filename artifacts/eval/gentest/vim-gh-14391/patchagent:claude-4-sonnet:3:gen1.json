{"patch": "diff --git a/src/change.c b/src/change.c\nindex daf4faed5..76bf283a1 100644\n--- a/src/change.c\n+++ b/src/change.c\n@@ -1118,7 +1118,13 @@ ins_char_bytes(char_u *buf, int charlen)\n \t}\n     }\n \n-    newp = alloc(linelen + newlen - oldlen);\n+    // Calculate allocation size with protection against underflow\n+    int alloc_size = linelen + newlen - oldlen;\n+    // Ensure minimum allocation size to prevent buffer overflows\n+    if (alloc_size < col + charlen + 10)  // 10 bytes safety margin\n+\talloc_size = col + charlen + 10;\n+    \n+    newp = alloc(alloc_size);\n     if (newp == NULL)\n \treturn;\n \n", "result": true}