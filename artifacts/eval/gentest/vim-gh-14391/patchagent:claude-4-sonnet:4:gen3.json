{"patch": "diff --git a/src/change.c b/src/change.c\nindex daf4faed5..f9bc2a7ed 100644\n--- a/src/change.c\n+++ b/src/change.c\n@@ -1118,7 +1118,15 @@ ins_char_bytes(char_u *buf, int charlen)\n \t}\n     }\n \n-    newp = alloc(linelen + newlen - oldlen);\n+    // Calculate the new line length\n+    int new_line_len = linelen + newlen - oldlen;\n+    \n+    // Ensure we allocate enough space to prevent buffer overflows\n+    // Use the maximum of the calculated size and a safe minimum\n+    int safe_size = linelen + newlen + col + 16; // Extra padding for safety\n+    new_line_len = (new_line_len > safe_size) ? new_line_len : safe_size;\n+    \n+    newp = alloc(new_line_len);\n     if (newp == NULL)\n \treturn;\n \n", "result": true}