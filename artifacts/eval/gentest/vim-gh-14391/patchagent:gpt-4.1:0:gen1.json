{"patch": "diff --git a/src/change.c b/src/change.c\nindex daf4faed5..0f377dfd9 100644\n--- a/src/change.c\n+++ b/src/change.c\n@@ -1118,13 +1118,22 @@ ins_char_bytes(char_u *buf, int charlen)\n \t}\n     }\n \n-    newp = alloc(linelen + newlen - oldlen);\n+    int needed = col + newlen;\n+    int base_alloc = linelen + newlen - oldlen;\n+    int allocated = (base_alloc > needed) ? base_alloc : needed;\n+    newp = alloc(allocated + 1); // +1 for NUL terminator\n     if (newp == NULL)\n-\treturn;\n-\n-    // Copy bytes before the cursor.\n-    if (col > 0)\n-\tmch_memmove(newp, oldp, (size_t)col);\n+        return;\n+\n+    // Copy bytes before the cursor (or pad with spaces if col > linelen)\n+    if (col > linelen) {\n+        if (linelen > 0)\n+            mch_memmove(newp, oldp, (size_t)linelen);\n+        for (int j = linelen; j < col; ++j)\n+            newp[j] = ' ';\n+    } else if (col > 0) {\n+        mch_memmove(newp, oldp, (size_t)col);\n+    }\n \n     // Copy bytes after the changed character(s).\n     p = newp + col;\n@@ -1140,6 +1149,9 @@ ins_char_bytes(char_u *buf, int charlen)\n     while (i < newlen)\n \tp[i++] = ' ';\n \n+    // Ensure NUL termination at end of new line\n+    newp[allocated] = NUL;\n+\n     // Replace the line in the buffer.\n     ml_replace(lnum, newp, FALSE);\n \n", "result": true}