{"patch": "diff --git a/src/xxd/xxd.c b/src/xxd/xxd.c\nindex cf8b4ea6a..9922a1de6 100644\n--- a/src/xxd/xxd.c\n+++ b/src/xxd/xxd.c\n@@ -1098,25 +1098,30 @@ main(int argc, char *argv[])\n           if (hextype == HEX_LITTLEENDIAN)\n             c += 1;\n \n-          COLOR_PROLOGUE\n-          begin_coloring_char(l,&c,e,ebcdic);\n+          /* Check for buffer overflow before writing color prologue (5 bytes) */\n+          if (c + 5 < (int)sizeof(l)) {\n+            COLOR_PROLOGUE\n+            begin_coloring_char(l,&c,e,ebcdic);\n #if defined(__MVS__) && __CHARSET_LIB == 0\n-          if (e >= 64)\n-            l[c++] = e;\n-          else\n-            l[c++] = '.';\n+            if (c + 1 < (int)sizeof(l))\n+              l[c++] = (e >= 64) ? e : '.';\n #else\n-          if (ebcdic)\n-            e = (e < 64) ? '.' : etoa64[e-64];\n-          l[c++] = (e > 31 && e < 127) ? e : '.';\n+            if (ebcdic)\n+              e = (e < 64) ? '.' : etoa64[e-64];\n+            if (c + 1 < (int)sizeof(l))\n+              l[c++] = (e > 31 && e < 127) ? e : '.';\n #endif\n-          COLOR_EPILOGUE\n+            if (c + 4 < (int)sizeof(l))\n+              COLOR_EPILOGUE\n+          }\n           n++;\n           if (++p == cols)\n             {\n-              l[c++] = '\\n';\n-              l[c++] = '\\0';\n-              xxdline(fpo, l, autoskip ? nonzero : 1);\n+              if (c + 2 < (int)sizeof(l)) {\n+                l[c++] = '\\n';\n+                l[c++] = '\\0';\n+                xxdline(fpo, l, autoskip ? nonzero : 1);\n+              }\n               nonzero = 0;\n               p = 0;\n             }\n", "result": true}