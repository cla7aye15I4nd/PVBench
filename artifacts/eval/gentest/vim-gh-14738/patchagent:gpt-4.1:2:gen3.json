{"patch": "diff --git a/src/xxd/xxd.c b/src/xxd/xxd.c\nindex cf8b4ea6a..78397a502 100644\n--- a/src/xxd/xxd.c\n+++ b/src/xxd/xxd.c\n@@ -1090,6 +1090,10 @@ main(int argc, char *argv[])\n \n       if (color)\n         {\n+          /* Prevent buffer overflow: ensure we never write past LLEN */\n+          if (c + 5 >= LLEN)  /* COLOR_PROLOGUE writes 5 bytes */\n+            c = LLEN - 6;     /* leave space for at least one char and terminator */\n+\n           if (hextype == HEX_BITS)\n             c += addrlen + 3 + p*12;\n           else\n@@ -1098,7 +1102,15 @@ main(int argc, char *argv[])\n           if (hextype == HEX_LITTLEENDIAN)\n             c += 1;\n \n-          COLOR_PROLOGUE\n+          if (c + 5 < LLEN) {\n+            COLOR_PROLOGUE\n+          }\n+          else {\n+            /* Truncate output to avoid overflow */\n+            c = LLEN - 1;\n+            l[c] = '\\0';\n+            goto finish_line;\n+          }\n           begin_coloring_char(l,&c,e,ebcdic);\n #if defined(__MVS__) && __CHARSET_LIB == 0\n           if (e >= 64)\n@@ -1108,14 +1120,28 @@ main(int argc, char *argv[])\n #else\n           if (ebcdic)\n             e = (e < 64) ? '.' : etoa64[e-64];\n-          l[c++] = (e > 31 && e < 127) ? e : '.';\n+          if (c < LLEN)\n+            l[c++] = (e > 31 && e < 127) ? e : '.';\n #endif\n-          COLOR_EPILOGUE\n+          if (c + 4 < LLEN) {\n+            COLOR_EPILOGUE\n+          }\n+          else {\n+            c = LLEN - 1;\n+            l[c] = '\\0';\n+            goto finish_line;\n+          }\n           n++;\n           if (++p == cols)\n             {\n-              l[c++] = '\\n';\n-              l[c++] = '\\0';\n+              if (c + 2 < LLEN) {\n+                l[c++] = '\\n';\n+                l[c++] = '\\0';\n+              } else {\n+                l[LLEN-2] = '\\n';\n+                l[LLEN-1] = '\\0';\n+              }\n+finish_line:\n               xxdline(fpo, l, autoskip ? nonzero : 1);\n               nonzero = 0;\n               p = 0;\n", "result": true}