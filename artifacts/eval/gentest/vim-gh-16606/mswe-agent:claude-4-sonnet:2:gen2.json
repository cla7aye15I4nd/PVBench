{"patch": "diff --git a/.gitignore b/.gitignore\nindex 0d38d901d..9f2f930da 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -121,3 +121,11 @@ src/cscope.out\n /.cache/clangd/\n /.ccls-cache/\n /compile_commands.json\n+build/\n+Build/\n+bin/\n+lib/\n+*.out\n+*.dll\n+*.so\n+*.dylib\ndiff --git a/src/message.c b/src/message.c\nindex 24984123b..dad9c59d6 100644\n--- a/src/message.c\n+++ b/src/message.c\n@@ -518,7 +518,7 @@ get_emsg_lnum(void)\n \n     // lnum is 0 when executing a command from the command line\n     // argument, we don't want a line number then\n-    if (SOURCING_NAME != NULL\n+    if (HAVE_SOURCING_INFO && SOURCING_NAME != NULL\n \t    && (other_sourcing_name() || SOURCING_LNUM != last_sourcing_lnum)\n \t    && SOURCING_LNUM != 0)\n     {\n@@ -560,14 +560,15 @@ msg_source(int attr)\n     {\n \tmsg_attr((char *)p, HL_ATTR(HLF_N));\n \tvim_free(p);\n-\tlast_sourcing_lnum = SOURCING_LNUM;  // only once for each line\n+\tif (HAVE_SOURCING_INFO)\n+\t    last_sourcing_lnum = SOURCING_LNUM;  // only once for each line\n     }\n \n     // remember the last sourcing name printed, also when it's empty\n-    if (SOURCING_NAME == NULL || other_sourcing_name())\n+    if (!HAVE_SOURCING_INFO || SOURCING_NAME == NULL || other_sourcing_name())\n     {\n \tVIM_CLEAR(last_sourcing_name);\n-\tif (SOURCING_NAME != NULL)\n+\tif (HAVE_SOURCING_INFO && SOURCING_NAME != NULL)\n \t    last_sourcing_name = vim_strsave(SOURCING_NAME);\n     }\n     --no_wait_return;\n@@ -693,10 +694,10 @@ emsg_core(const char *s)\n \tif (in_assert_fails && emsg_assert_fails_msg == NULL)\n \t{\n \t    emsg_assert_fails_msg = vim_strsave((char_u *)s);\n-\t    emsg_assert_fails_lnum = SOURCING_LNUM;\n+\t    emsg_assert_fails_lnum = HAVE_SOURCING_INFO ? SOURCING_LNUM : 0;\n \t    vim_free(emsg_assert_fails_context);\n \t    emsg_assert_fails_context = vim_strsave(\n-\t\t\t SOURCING_NAME == NULL ? (char_u *)\"\" : SOURCING_NAME);\n+\t\t     (HAVE_SOURCING_INFO && SOURCING_NAME != NULL) ? SOURCING_NAME : (char_u *)\"\");\n \t}\n \n \t// set \"v:errmsg\", also when using \":silent! cmd\"\n@@ -824,9 +825,11 @@ semsg(const char *s, ...)\n \treturn TRUE;\n \n     if (IObuff == NULL)\n+    {\n \t// Very early in initialisation and already something wrong, just\n \t// give the raw message so the user at least gets a hint.\n \treturn emsg_core(s);\n+    }\n \n     va_list ap;\n \n@@ -2803,7 +2806,7 @@ inc_msg_scrolled(void)\n #ifdef FEAT_EVAL\n     if (*get_vim_var_str(VV_SCROLLSTART) == NUL)\n     {\n-\tchar_u\t    *p = SOURCING_NAME;\n+\tchar_u\t    *p = (HAVE_SOURCING_INFO && SOURCING_NAME != NULL) ? SOURCING_NAME : NULL;\n \tchar_u\t    *tofree = NULL;\n \tint\t    len;\n \n@@ -2818,7 +2821,7 @@ inc_msg_scrolled(void)\n \t    if (tofree != NULL)\n \t    {\n \t\tvim_snprintf((char *)tofree, len, _(\"%s line %ld\"),\n-\t\t\t\t\t\t      p, (long)SOURCING_LNUM);\n+\t\t\t\t\t      p, (long)(HAVE_SOURCING_INFO ? SOURCING_LNUM : 0));\n \t\tp = tofree;\n \t    }\n \t}\n@@ -2830,6 +2833,7 @@ inc_msg_scrolled(void)\n     set_must_redraw(UPD_VALID);\n }\n \n+\n /*\n  * To be able to scroll back at the \"more\" and \"hit-enter\" prompts we need to\n  * store the displayed text and remember where screen lines start.\n", "result": true}