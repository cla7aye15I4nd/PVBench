{"patch": "diff --git a/src/ex_cmds.c b/src/ex_cmds.c\nindex e1e6c4ee7..4d121904f 100644\n--- a/src/ex_cmds.c\n+++ b/src/ex_cmds.c\n@@ -41,7 +41,13 @@ do_ascii(exarg_T *eap UNUSED)\n     int\t\tlen;\n \n     if (enc_utf8)\n-\tc = utfc_ptr2char(ml_get_cursor(), cc);\n+    {\n+        colnr_T maxlen = ml_get_cursor_len();\n+        if (maxlen > 0)\n+            c = utfc_ptr2char_len(ml_get_cursor(), cc, maxlen);\n+        else\n+            c = NUL;\n+    }\n     else\n \tc = gchar_cursor();\n     if (c == NUL)\ndiff --git a/src/mbyte.c b/src/mbyte.c\nindex a38ab24f3..e0cbedefb 100644\n--- a/src/mbyte.c\n+++ b/src/mbyte.c\n@@ -2023,6 +2023,12 @@ utfc_ptr2char_len(\n     int\t\tcc;\n     int\t\ti = 0;\n \n+    if (maxlen <= 0) {\n+        if (i < MAX_MCO)\n+            pcc[i] = 0;\n+        return NUL;\n+    }\n+\n     c = utf_ptr2char(p);\n     len = utf_ptr2len_len(p, maxlen);\n     // Only accept a composing char when the first char isn't illegal.\n", "result": false, "error": "Exit code 2"}