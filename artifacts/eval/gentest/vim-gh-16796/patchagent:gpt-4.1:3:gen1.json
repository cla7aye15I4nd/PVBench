{"patch": "diff --git a/src/ex_cmds.c b/src/ex_cmds.c\nindex e1e6c4ee7..80980b9ad 100644\n--- a/src/ex_cmds.c\n+++ b/src/ex_cmds.c\n@@ -41,7 +41,16 @@ do_ascii(exarg_T *eap UNUSED)\n     int\t\tlen;\n \n     if (enc_utf8)\n-\tc = utfc_ptr2char(ml_get_cursor(), cc);\n+    {\n+        /* Prevent heap buffer overflow: ensure at least 6 bytes remain from cursor to line end */\n+        if (ml_get_cursor_len() >= 6)\n+            c = utfc_ptr2char(ml_get_cursor(), cc);\n+        else if (ml_get_cursor_len() > 0)\n+            /* Fallback: get only the first byte as character (truncated) */\n+            c = *(ml_get_cursor());\n+        else\n+            c = NUL;\n+    }\n     else\n \tc = gchar_cursor();\n     if (c == NUL)\n", "result": false, "error": "Exit code 2"}