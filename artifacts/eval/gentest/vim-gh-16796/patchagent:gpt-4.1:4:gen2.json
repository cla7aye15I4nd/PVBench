{"patch": "diff --git a/src/ex_cmds.c b/src/ex_cmds.c\nindex e1e6c4ee7..6bd952ed7 100644\n--- a/src/ex_cmds.c\n+++ b/src/ex_cmds.c\n@@ -33,6 +33,7 @@ do_ascii(exarg_T *eap UNUSED)\n     char\tbuf1[20];\n     char\tbuf2[20];\n     char_u\tbuf3[7];\n+    char_u\tsafe_buf[7];\n #ifdef FEAT_DIGRAPHS\n     char_u      *dig;\n #endif\n@@ -41,7 +42,18 @@ do_ascii(exarg_T *eap UNUSED)\n     int\t\tlen;\n \n     if (enc_utf8)\n-\tc = utfc_ptr2char(ml_get_cursor(), cc);\n+    {\n+        // Defensive: avoid heap overflow if cursor is at end of line buffer\n+        char_u *cur = ml_get_cursor();\n+        int rem = (int)ml_get_cursor_len();\n+        int safe_len = rem > 6 ? 6 : (rem > 0 ? rem : 0);\n+        for (int i = 0; i < 7; ++i)\n+            safe_buf[i] = 0;\n+        for (int i = 0; i < safe_len; ++i)\n+            safe_buf[i] = cur[i];\n+        // Always NUL-terminated\n+        c = utfc_ptr2char(safe_buf, cc);\n+    }\n     else\n \tc = gchar_cursor();\n     if (c == NUL)\n", "result": false, "error": "Exit code 2"}