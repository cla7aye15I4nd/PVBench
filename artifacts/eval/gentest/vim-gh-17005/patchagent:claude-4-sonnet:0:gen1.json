{"patch": "diff --git a/src/mbyte.c b/src/mbyte.c\nindex a38ab24f3..cdb435a9b 100644\n--- a/src/mbyte.c\n+++ b/src/mbyte.c\n@@ -4018,6 +4018,10 @@ utf_head_off(char_u *base, char_u *p)\n     char_u\t*j;\n #endif\n \n+    // Check if p is within valid range\n+    if (p < base)\n+\treturn 0;\n+\n     if (*p < 0x80)\t\t// be quick for ASCII\n \treturn 0;\n \ndiff --git a/src/popupmenu.c b/src/popupmenu.c\nindex 71bb49984..e646f5b57 100644\n--- a/src/popupmenu.c\n+++ b/src/popupmenu.c\n@@ -849,7 +849,8 @@ pum_redraw(void)\n \t\t\t\t{\n \t\t\t\t    if (used_cells < ellipsis_width)\n \t\t\t\t    {\n-\t\t\t\t\tMB_PTR_BACK(st, st_end);\n+\t\t\t\t\tif (st_end > st)\n+\t\t\t\t\t    MB_PTR_BACK(st, st_end);\n \t\t\t\t\tlast_char = st_end;\n \t\t\t\t\tover_cell = ellipsis_width - used_cells;\n \t\t\t\t    }\n", "result": true}