{"patch": "diff --git a/src/popupmenu.c b/src/popupmenu.c\nindex 71bb49984..9a9d8dce7 100644\n--- a/src/popupmenu.c\n+++ b/src/popupmenu.c\n@@ -841,16 +841,28 @@ pum_redraw(void)\n \t\t\t\t    if (used_cells + char_cells > ellipsis_width)\n \t\t\t\t\tbreak;\n \t\t\t\t    used_cells += char_cells;\n-\t\t\t\t    MB_PTR_BACK(st, st_end);\n-\t\t\t\t    last_char = st_end;\n+                    if (st_end > st) {\n+                        MB_PTR_BACK(st, st_end);\n+                        if (st_end < st) {\n+                            st_end = st;\n+                            break;\n+                        }\n+                        last_char = st_end;\n+                    } else {\n+                        break;\n+                    }\n \t\t\t\t}\n \n \t\t\t\tif (last_char != NULL)\n \t\t\t\t{\n \t\t\t\t    if (used_cells < ellipsis_width)\n \t\t\t\t    {\n-\t\t\t\t\tMB_PTR_BACK(st, st_end);\n-\t\t\t\t\tlast_char = st_end;\n+                        if (st_end > st) {\n+                            MB_PTR_BACK(st, st_end);\n+                            if (st_end < st)\n+                                st_end = st;\n+                            last_char = st_end;\n+                        }\n \t\t\t\t\tover_cell = ellipsis_width - used_cells;\n \t\t\t\t    }\n \t\t\t\t    kept_len = last_char - st;\n", "result": true}