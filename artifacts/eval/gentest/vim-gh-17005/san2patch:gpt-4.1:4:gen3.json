{"patch": "diff --git a/src/popupmenu.c b/src/popupmenu.c\nindex 71bb49984..33f53d2fc 100644\n--- a/src/popupmenu.c\n+++ b/src/popupmenu.c\n@@ -846,25 +846,30 @@ pum_redraw(void)\n \t\t\t\t}\n \n \t\t\t\tif (last_char != NULL)\n-\t\t\t\t{\n-\t\t\t\t    if (used_cells < ellipsis_width)\n-\t\t\t\t    {\n-\t\t\t\t\tMB_PTR_BACK(st, st_end);\n-\t\t\t\t\tlast_char = st_end;\n-\t\t\t\t\tover_cell = ellipsis_width - used_cells;\n-\t\t\t\t    }\n-\t\t\t\t    kept_len = last_char - st;\n-\t\t\t\t    new_str = alloc(ellipsis_width + over_cell + kept_len + 1);\n-\t\t\t\t    if (!new_str)\n-\t\t\t\t\treturn;\n-\t\t\t\t    memcpy(new_str, st, kept_len);\n-\t\t\t\t    if (over_cell > 0)\n-\t\t\t\t\tvim_memset(new_str + kept_len, ' ', over_cell);\n-\t\t\t\t    vim_memset(new_str + kept_len + over_cell, '.', ellipsis_width);\n-\t\t\t\t    new_str[kept_len + ellipsis_width + over_cell] = NUL;\n-\t\t\t\t    vim_free(st);\n-\t\t\t\t    st = new_str;\n-\t\t\t\t}\n+\t\t\t{\n+// FIXME: Crash CWE-125: Out-of-bounds Read\n+    if (used_cells < ellipsis_width)\n+    {\n+        /* Ensure st_end does not go before st */\n+        if (st < st_end)\n+        {\n+            MB_PTR_BACK(st, st_end);\n+            last_char = st_end;\n+        }\n+        over_cell = ellipsis_width - used_cells;\n+    }\n+    kept_len = last_char - st;\n+    new_str = alloc(ellipsis_width + over_cell + kept_len + 1);\n+    if (!new_str)\n+        return;\n+    memcpy(new_str, st, kept_len);\n+    if (over_cell > 0)\n+        vim_memset(new_str + kept_len, ' ', over_cell);\n+    vim_memset(new_str + kept_len + over_cell, '.', ellipsis_width);\n+    new_str[kept_len + ellipsis_width + over_cell] = NUL;\n+    vim_free(st);\n+    st = new_str;\n+\t\t\t}\n \t\t\t    }\n \n \t\t\t    if (attrs == NULL)\n", "result": true}