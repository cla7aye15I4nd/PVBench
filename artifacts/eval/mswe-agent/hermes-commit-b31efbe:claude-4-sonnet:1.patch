
diff --git a/.gitignore b/.gitignore
index 6da7d9204..71c032a2d 100644
--- a/.gitignore
+++ b/.gitignore
@@ -34,3 +34,14 @@ android/intltest/java/com/facebook/hermes/test/assets/**
 
 # clangd cache
 .cache/
+build/
+Build/
+bin/
+lib/
+*.o
+*.out
+*.obj
+*.exe
+*.dll
+*.so
+*.dylib
diff --git a/lib/AST/ES6Class.cpp b/lib/AST/ES6Class.cpp
index 42155e587..b6017e2cc 100644
--- a/lib/AST/ES6Class.cpp
+++ b/lib/AST/ES6Class.cpp
@@ -222,17 +222,34 @@ class ES6ClassesTransformations {
     visitESTreeChildren(*this, node);
   }
 
+  /// The maximum AST nesting level. Once we reach it, we report an error and
+  /// stop.
+  static constexpr unsigned MAX_RECURSION_DEPTH =
+#if defined(HERMES_LIMIT_STACK_DEPTH) || defined(_MSC_VER)
+      512
+#else
+      1024
+#endif
+      ;
+
   bool incRecursionDepth(ESTree::Node *) {
+    if (recursionDepth_ == 0) {
+      return false;
+    }
+    --recursionDepth_;
     return true;
   }
 
-  void decRecursionDepth() {}
+  void decRecursionDepth() {
+    ++recursionDepth_;
+  }
 
  private:
   Context &context_;
   UniqueString *const identVar_;
   VisitedClass *_currentProcessingClass = nullptr;
   const ResolvedClassMember *_currentClassMember = nullptr;
+  unsigned recursionDepth_ = MAX_RECURSION_DEPTH;
 
   ESTree::VisitResult doVisitChildren(ESTree::Node *node) {
     visitESTreeChildren(*this, node);
diff --git a/test_nested.js b/test_nested.js
new file mode 100644
index 000000000..4ff32836d
--- /dev/null
+++ b/test_nested.js
@@ -0,0 +1 @@
+class MyClass { constructor() { let x = 1 + 2 + 3 + 4 + 5; this.value = x * (10 + 20); } method() { return this.value; } }
diff --git a/test_simple.js b/test_simple.js
new file mode 100644
index 000000000..ae4abbfd1
--- /dev/null
+++ b/test_simple.js
@@ -0,0 +1 @@
+class MyClass { constructor() { this.value = 42; } }
