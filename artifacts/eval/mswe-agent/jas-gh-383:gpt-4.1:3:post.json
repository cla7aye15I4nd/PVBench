{"patch": "diff --git a/.gitignore b/.gitignore\nindex b63f1b8..ea6f7f1 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -25,3 +25,13 @@ Makefile.in\n # src/libjasper/include/jasper directory\n /src/libjasper/include/jasper/jas_config.h\n /src/libjasper/include/jasper/stamp-h1\n+build/\n+Build/\n+bin/\n+lib/\n+*.out\n+*.obj\n+*.exe\n+*.dll\n+*.so\n+*.dylib\ndiff --git a/src/libjasper/heic/heic_dec.c b/src/libjasper/heic/heic_dec.c\nindex cde3843..7d06104 100644\n--- a/src/libjasper/heic/heic_dec.c\n+++ b/src/libjasper/heic/heic_dec.c\n@@ -190,11 +190,17 @@ jas_image_t *jas_heic_decode(jas_stream_t *in, const char *optstr)\n \t}\n #if 0\n #endif\n-\theif_context_read_from_memory_without_copy(ctx, ptr, size, 0);\n-\n-\t/* Get a handle to the primary image. */\n-\theif_context_get_primary_image_handle(ctx, &handle);\n-\n+\tstruct heif_error herr;\n+\therr = heif_context_read_from_memory_without_copy(ctx, ptr, size, 0);\n+\tif (herr.code != 0) {\n+\t\tjas_logerrorf(\"heif_context_read_from_memory_without_copy failed: %d\\n\", herr.code);\n+\t\tgoto error;\n+\t}\n+\therr = heif_context_get_primary_image_handle(ctx, &handle);\n+\tif (herr.code != 0 || !handle) {\n+\t\tjas_logerrorf(\"heif_context_get_primary_image_handle failed: %d\\n\", herr.code);\n+\t\tgoto error;\n+\t}\n \tint width = heif_image_handle_get_width(handle);\n \tint height = heif_image_handle_get_height(handle);\n \tJAS_LOGDEBUGF(1, \"width %d; height %d\\n\", width, height);\n@@ -225,7 +231,10 @@ jas_image_t *jas_heic_decode(jas_stream_t *in, const char *optstr)\n \t\tjas_logerrorf(\"heif_decode_image failed\\n\");\n \t\tgoto error;\n \t}\n-\n+\tif (!img) {\n+\t\tjas_logerrorf(\"heif_decode_image returned success but img is NULL\\n\");\n+\t\tgoto error;\n+\t}\n \tenum heif_colorspace colorspace = heif_image_get_colorspace(img);\n \tenum heif_chroma chroma = heif_image_get_chroma_format(img);\n \tassert(chroma == heif_chroma_interleaved_RGB);\n", "result": true}