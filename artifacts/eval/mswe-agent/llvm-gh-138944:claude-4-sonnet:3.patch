
diff --git a/.gitignore b/.gitignore
index a84268a7f686..ff15b5180e1f 100644
--- a/.gitignore
+++ b/.gitignore
@@ -73,3 +73,14 @@ pythonenv*
 /clang/utils/analyzer/projects/*/RefScanBuildResults
 # automodapi puts generated documentation files here.
 /lldb/docs/python_api/
+build/
+Build/
+bin/
+lib/
+*.o
+*.out
+*.obj
+*.exe
+*.dll
+*.so
+*.dylib
diff --git a/llvm/lib/Target/X86/X86ISelLowering.cpp b/llvm/lib/Target/X86/X86ISelLowering.cpp
index f04603867a58..78e4952b6a20 100644
--- a/llvm/lib/Target/X86/X86ISelLowering.cpp
+++ b/llvm/lib/Target/X86/X86ISelLowering.cpp
@@ -54742,9 +54742,20 @@ SDValue X86TargetLowering::getNegatedExpression(SDValue Op, SelectionDAG &DAG,
                                   : NegatibleCost::Neutral;
 
     // Fill in the non-negated ops with the original values.
-    for (int i = 0, e = Op.getNumOperands(); i != e; ++i)
-      if (!NewOps[i])
-        NewOps[i] = Op.getOperand(i);
+    for (int i = 0, e = Op.getNumOperands(); i != e; ++i) {
+      if (!NewOps[i]) {
+        SDValue OrigOp = Op.getOperand(i);
+        // Check if the original operand is a deleted node
+        if (OrigOp.getOpcode() != ISD::DELETED_NODE)
+          NewOps[i] = OrigOp;
+        else
+          return SDValue(); // Return empty SDValue if we encounter a deleted node
+      } else {
+        // Also check if the negated operand is a deleted node
+        if (NewOps[i].getOpcode() == ISD::DELETED_NODE)
+          return SDValue(); // Return empty SDValue if we encounter a deleted node
+      }
+    }
     return DAG.getNode(NewOpc, SDLoc(Op), VT, NewOps);
   }
   case X86ISD::FRCP:
diff --git a/simple_test.ll b/simple_test.ll
new file mode 100644
index 000000000000..786f643c466f
--- /dev/null
+++ b/simple_test.ll
@@ -0,0 +1,4 @@
+define i32 @test(i32 %a, i32 %b) {
+  %c = add i32 %a, %b
+  ret i32 %c
+}
diff --git a/test_fix.sh b/test_fix.sh
new file mode 100755
index 000000000000..6206c5f90aa0
--- /dev/null
+++ b/test_fix.sh
@@ -0,0 +1,10 @@
+#!/bin/bash -eu
+echo "Testing the fix for LLVM SelectionDAG deleted node assertion..."
+echo "Running llc with the POC file..."
+if ./build/bin/llc -o /dev/null /home/poc/0.bin; then
+    echo "SUCCESS: llc completed without assertion failure!"
+    echo "The fix is working correctly."
+else
+    echo "FAILURE: llc still crashes with assertion failure."
+    exit 1
+fi
diff --git a/test_script.sh b/test_script.sh
new file mode 100755
index 000000000000..59c3d8b6e4c8
--- /dev/null
+++ b/test_script.sh
@@ -0,0 +1,2 @@
+#!/bin/bash -eu
+./build/bin/llc -o - $1
