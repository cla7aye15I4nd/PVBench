
diff --git a/.gitignore b/.gitignore
index c2918f31a..6bf18697a 100644
--- a/.gitignore
+++ b/.gitignore
@@ -32,3 +32,13 @@ compile_flags.txt
 cscope.files
 cscope.out
 tags
+build/
+Build/
+bin/
+lib/
+*.out
+*.obj
+*.exe
+*.dll
+*.so
+*.dylib
diff --git a/src/string.c b/src/string.c
index 1bd3f6f8f..5836610b5 100644
--- a/src/string.c
+++ b/src/string.c
@@ -2950,25 +2950,52 @@ str_bytesplice(mrb_state *mrb, mrb_value str, mrb_int idx1, mrb_int len1, mrb_va
   if (RSTR_LEN(s) < idx1 || RSTRING_LEN(replace) < idx2) {
     mrb_raise(mrb, E_INDEX_ERROR, "index out of string");
   }
-  if (RSTR_LEN(s) <= idx1+len1) {
+  
+  /* Check for overflow in idx1+len1 */
+  mrb_int idx1_plus_len1;
+  if (mrb_int_add_overflow(idx1, len1, &idx1_plus_len1)) {
+    /* If overflow occurs, treat as if idx1+len1 is very large */
     len1 = RSTR_LEN(s) - idx1;
   }
-  if (RSTRING_LEN(replace) <= idx2+len2) {
+  else if (RSTR_LEN(s) <= idx1_plus_len1) {
+    len1 = RSTR_LEN(s) - idx1;
+  }
+  
+  /* Check for overflow in idx2+len2 */
+  mrb_int idx2_plus_len2;
+  if (mrb_int_add_overflow(idx2, len2, &idx2_plus_len2)) {
+    /* If overflow occurs, treat as if idx2+len2 is very large */
+    len2 = RSTRING_LEN(replace) - idx2;
+  }
+  else if (RSTRING_LEN(replace) <= idx2_plus_len2) {
     len2 = RSTRING_LEN(replace) - idx2;
   }
+  
   if (len2 == 0) return str;
   mrb_str_modify(mrb, s);
   if (len1 >= len2) {
     memmove(RSTR_PTR(s)+idx1, RSTRING_PTR(replace)+idx2, len2);
     if (len1 > len2) {
-      memmove(RSTR_PTR(s)+idx1+len2, RSTR_PTR(s)+idx1+len1, RSTR_LEN(s)-(idx1+len1));
+      /* Recompute idx1+len1 and idx1+len2 safely */
+      mrb_int idx1_plus_len1_safe, idx1_plus_len2_safe;
+      if (mrb_int_add_overflow(idx1, len1, &idx1_plus_len1_safe) ||
+          mrb_int_add_overflow(idx1, len2, &idx1_plus_len2_safe)) {
+        mrb_raise(mrb, E_INDEX_ERROR, "index calculation overflow");
+      }
+      memmove(RSTR_PTR(s)+idx1_plus_len2_safe, RSTR_PTR(s)+idx1_plus_len1_safe, RSTR_LEN(s)-idx1_plus_len1_safe);
       RSTR_SET_LEN(s, RSTR_LEN(s)-(len1-len2));
     }
   }
   else { /* len1 < len2 */
     mrb_int slen = RSTR_LEN(s);
     mrb_str_resize(mrb, str, slen+len2-len1);
-    memmove(RSTR_PTR(s)+idx1+len2, RSTR_PTR(s)+idx1+len1, slen-(idx1+len1));
+    /* Recompute idx1+len1 and idx1+len2 safely */
+    mrb_int idx1_plus_len1_safe, idx1_plus_len2_safe;
+    if (mrb_int_add_overflow(idx1, len1, &idx1_plus_len1_safe) ||
+        mrb_int_add_overflow(idx1, len2, &idx1_plus_len2_safe)) {
+      mrb_raise(mrb, E_INDEX_ERROR, "index calculation overflow");
+    }
+    memmove(RSTR_PTR(s)+idx1_plus_len2_safe, RSTR_PTR(s)+idx1_plus_len1_safe, slen-idx1_plus_len1_safe);
     memmove(RSTR_PTR(s)+idx1, RSTRING_PTR(replace)+idx2, len2);
   }
   return str;
