[{"patch": "diff --git a/.gitignore b/.gitignore\nindex c2918f31a..6bf18697a 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -32,3 +32,13 @@ compile_flags.txt\n cscope.files\n cscope.out\n tags\n+build/\n+Build/\n+bin/\n+lib/\n+*.out\n+*.obj\n+*.exe\n+*.dll\n+*.so\n+*.dylib\ndiff --git a/src/string.c b/src/string.c\nindex 1bd3f6f8f..8aabfb76d 100644\n--- a/src/string.c\n+++ b/src/string.c\n@@ -2944,12 +2944,24 @@ sub_replace(mrb_state *mrb, mrb_value self)\n \n \n static mrb_value\n+\n str_bytesplice(mrb_state *mrb, mrb_value str, mrb_int idx1, mrb_int len1, mrb_value replace, mrb_int idx2, mrb_int len2)\n {\n   struct RString *s = RSTRING(str);\n+\n+  /* Check for index out of bounds */\n   if (RSTR_LEN(s) < idx1 || RSTRING_LEN(replace) < idx2) {\n     mrb_raise(mrb, E_INDEX_ERROR, \"index out of string\");\n   }\n+\n+  /* Check for integer overflow in idx1+len1 and idx2+len2 */\n+  if ((len1 > 0 && idx1 > MRB_INT_MAX - len1) || (len1 < 0 && idx1 < MRB_INT_MIN - len1)) {\n+    mrb_raise(mrb, E_INDEX_ERROR, \"idx1+len1 integer overflow\");\n+  }\n+  if ((len2 > 0 && idx2 > MRB_INT_MAX - len2) || (len2 < 0 && idx2 < MRB_INT_MIN - len2)) {\n+    mrb_raise(mrb, E_INDEX_ERROR, \"idx2+len2 integer overflow\");\n+  }\n+\n   if (RSTR_LEN(s) <= idx1+len1) {\n     len1 = RSTR_LEN(s) - idx1;\n   }\n@@ -2957,8 +2969,17 @@ str_bytesplice(mrb_state *mrb, mrb_value str, mrb_int idx1, mrb_int len1, mrb_va\n     len2 = RSTRING_LEN(replace) - idx2;\n   }\n   if (len2 == 0) return str;\n+\n   mrb_str_modify(mrb, s);\n+\n   if (len1 >= len2) {\n+    /* Check for integer overflow in idx1+len2 and idx1+len1 */\n+    if ((len2 > 0 && idx1 > MRB_INT_MAX - len2) || (len2 < 0 && idx1 < MRB_INT_MIN - len2)) {\n+      mrb_raise(mrb, E_INDEX_ERROR, \"idx1+len2 integer overflow\");\n+    }\n+    if ((len1 > 0 && idx1 > MRB_INT_MAX - len1) || (len1 < 0 && idx1 < MRB_INT_MIN - len1)) {\n+      mrb_raise(mrb, E_INDEX_ERROR, \"idx1+len1 integer overflow\");\n+    }\n     memmove(RSTR_PTR(s)+idx1, RSTRING_PTR(replace)+idx2, len2);\n     if (len1 > len2) {\n       memmove(RSTR_PTR(s)+idx1+len2, RSTR_PTR(s)+idx1+len1, RSTR_LEN(s)-(idx1+len1));\n@@ -2967,6 +2988,11 @@ str_bytesplice(mrb_state *mrb, mrb_value str, mrb_int idx1, mrb_int len1, mrb_va\n   }\n   else { /* len1 < len2 */\n     mrb_int slen = RSTR_LEN(s);\n+    /* Check for integer overflow in slen+len2-len1 */\n+    if ((len2-len1 > 0 && slen > MRB_INT_MAX - (len2-len1)) ||\n+        (len2-len1 < 0 && slen < MRB_INT_MIN - (len2-len1))) {\n+      mrb_raise(mrb, E_INDEX_ERROR, \"slen+len2-len1 integer overflow\");\n+    }\n     mrb_str_resize(mrb, str, slen+len2-len1);\n     memmove(RSTR_PTR(s)+idx1+len2, RSTR_PTR(s)+idx1+len1, slen-(idx1+len1));\n     memmove(RSTR_PTR(s)+idx1, RSTRING_PTR(replace)+idx2, len2);\n"}]