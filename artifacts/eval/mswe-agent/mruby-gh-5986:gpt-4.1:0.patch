
diff --git a/.gitignore b/.gitignore
index c2918f31a..6bf18697a 100644
--- a/.gitignore
+++ b/.gitignore
@@ -32,3 +32,13 @@ compile_flags.txt
 cscope.files
 cscope.out
 tags
+build/
+Build/
+bin/
+lib/
+*.out
+*.obj
+*.exe
+*.dll
+*.so
+*.dylib
diff --git a/src/string.c b/src/string.c
index 1bd3f6f8f..8aabfb76d 100644
--- a/src/string.c
+++ b/src/string.c
@@ -2944,12 +2944,24 @@ sub_replace(mrb_state *mrb, mrb_value self)
 
 
 static mrb_value
+
 str_bytesplice(mrb_state *mrb, mrb_value str, mrb_int idx1, mrb_int len1, mrb_value replace, mrb_int idx2, mrb_int len2)
 {
   struct RString *s = RSTRING(str);
+
+  /* Check for index out of bounds */
   if (RSTR_LEN(s) < idx1 || RSTRING_LEN(replace) < idx2) {
     mrb_raise(mrb, E_INDEX_ERROR, "index out of string");
   }
+
+  /* Check for integer overflow in idx1+len1 and idx2+len2 */
+  if ((len1 > 0 && idx1 > MRB_INT_MAX - len1) || (len1 < 0 && idx1 < MRB_INT_MIN - len1)) {
+    mrb_raise(mrb, E_INDEX_ERROR, "idx1+len1 integer overflow");
+  }
+  if ((len2 > 0 && idx2 > MRB_INT_MAX - len2) || (len2 < 0 && idx2 < MRB_INT_MIN - len2)) {
+    mrb_raise(mrb, E_INDEX_ERROR, "idx2+len2 integer overflow");
+  }
+
   if (RSTR_LEN(s) <= idx1+len1) {
     len1 = RSTR_LEN(s) - idx1;
   }
@@ -2957,8 +2969,17 @@ str_bytesplice(mrb_state *mrb, mrb_value str, mrb_int idx1, mrb_int len1, mrb_va
     len2 = RSTRING_LEN(replace) - idx2;
   }
   if (len2 == 0) return str;
+
   mrb_str_modify(mrb, s);
+
   if (len1 >= len2) {
+    /* Check for integer overflow in idx1+len2 and idx1+len1 */
+    if ((len2 > 0 && idx1 > MRB_INT_MAX - len2) || (len2 < 0 && idx1 < MRB_INT_MIN - len2)) {
+      mrb_raise(mrb, E_INDEX_ERROR, "idx1+len2 integer overflow");
+    }
+    if ((len1 > 0 && idx1 > MRB_INT_MAX - len1) || (len1 < 0 && idx1 < MRB_INT_MIN - len1)) {
+      mrb_raise(mrb, E_INDEX_ERROR, "idx1+len1 integer overflow");
+    }
     memmove(RSTR_PTR(s)+idx1, RSTRING_PTR(replace)+idx2, len2);
     if (len1 > len2) {
       memmove(RSTR_PTR(s)+idx1+len2, RSTR_PTR(s)+idx1+len1, RSTR_LEN(s)-(idx1+len1));
@@ -2967,6 +2988,11 @@ str_bytesplice(mrb_state *mrb, mrb_value str, mrb_int idx1, mrb_int len1, mrb_va
   }
   else { /* len1 < len2 */
     mrb_int slen = RSTR_LEN(s);
+    /* Check for integer overflow in slen+len2-len1 */
+    if ((len2-len1 > 0 && slen > MRB_INT_MAX - (len2-len1)) ||
+        (len2-len1 < 0 && slen < MRB_INT_MIN - (len2-len1))) {
+      mrb_raise(mrb, E_INDEX_ERROR, "slen+len2-len1 integer overflow");
+    }
     mrb_str_resize(mrb, str, slen+len2-len1);
     memmove(RSTR_PTR(s)+idx1+len2, RSTR_PTR(s)+idx1+len1, slen-(idx1+len1));
     memmove(RSTR_PTR(s)+idx1, RSTRING_PTR(replace)+idx2, len2);
