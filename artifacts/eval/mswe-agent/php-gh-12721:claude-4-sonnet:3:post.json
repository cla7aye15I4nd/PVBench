{"patch": "diff --git a/.gitignore b/.gitignore\nindex b8eb03412fa..e959803a362 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -296,3 +296,12 @@ tmp-php.ini\n !/ext/fileinfo/magicdata.patch\n !/ext/pcre/pcre2lib/config.h\n !/win32/build/Makefile\n+build/\n+Build/\n+bin/\n+lib/\n+*.out\n+*.exe\n+*.dll\n+*.so\n+*.dylib\ndiff --git a/ext/spl/spl_directory.c b/ext/spl/spl_directory.c\nindex 0dcb34b6a69..ca5b304db99 100644\n--- a/ext/spl/spl_directory.c\n+++ b/ext/spl/spl_directory.c\n@@ -925,8 +925,13 @@ PHP_METHOD(SplFileInfo, getFilename)\n \n \tpath = spl_filesystem_object_get_path(intern);\n \n-\tZEND_ASSERT(path);\n-\tif (path && ZSTR_LEN(path) && ZSTR_LEN(path) < ZSTR_LEN(intern->file_name)) {\n+\tif (path == NULL) {\n+\t\t/* If path is NULL, just return the full file name */\n+\t\tRETVAL_STR_COPY(intern->file_name);\n+\t\treturn;\n+\t}\n+\t\n+\tif (ZSTR_LEN(path) && ZSTR_LEN(path) < ZSTR_LEN(intern->file_name)) {\n \t\t/* +1 to skip the trailing / of the path in the file name */\n \t\tsize_t path_len = ZSTR_LEN(path) + 1;\n \t\tRETVAL_STRINGL(ZSTR_VAL(intern->file_name) + path_len, ZSTR_LEN(intern->file_name) - path_len);\n@@ -973,14 +978,19 @@ PHP_METHOD(SplFileInfo, getExtension)\n \n \tpath = spl_filesystem_object_get_path(intern);\n \n-\tif (ZSTR_LEN(path) && ZSTR_LEN(path) < ZSTR_LEN(intern->file_name)) {\n+\tif (path == NULL) {\n+\t\t/* If path is NULL, use the full file name */\n+\t\tfname = ZSTR_VAL(intern->file_name);\n+\t\tflen = ZSTR_LEN(intern->file_name);\n+\t} else if (ZSTR_LEN(path) && ZSTR_LEN(path) < ZSTR_LEN(intern->file_name)) {\n \t\tfname = ZSTR_VAL(intern->file_name) + ZSTR_LEN(path) + 1;\n \t\tflen = ZSTR_LEN(intern->file_name) - (ZSTR_LEN(path) + 1);\n+\t\tzend_string_release_ex(path, /* persistent */ false);\n \t} else {\n \t\tfname = ZSTR_VAL(intern->file_name);\n \t\tflen = ZSTR_LEN(intern->file_name);\n+\t\tzend_string_release_ex(path, /* persistent */ false);\n \t}\n-\tzend_string_release_ex(path, /* persistent */ false);\n \n \tret = php_basename(fname, flen, NULL, 0);\n \n@@ -1044,15 +1054,20 @@ PHP_METHOD(SplFileInfo, getBasename)\n \n \tpath = spl_filesystem_object_get_path(intern);\n \n-\tif (path && ZSTR_LEN(path) && ZSTR_LEN(path) < ZSTR_LEN(intern->file_name)) {\n+\tif (path == NULL) {\n+\t\t/* If path is NULL, use the full file name */\n+\t\tfname = ZSTR_VAL(intern->file_name);\n+\t\tflen = ZSTR_LEN(intern->file_name);\n+\t} else if (ZSTR_LEN(path) && ZSTR_LEN(path) < ZSTR_LEN(intern->file_name)) {\n \t\t/* +1 to skip the trailing / of the path in the file name */\n \t\tfname = ZSTR_VAL(intern->file_name) + ZSTR_LEN(path) + 1;\n \t\tflen = ZSTR_LEN(intern->file_name) - (ZSTR_LEN(path) + 1);\n+\t\tzend_string_release_ex(path, /* persistent */ false);\n \t} else {\n \t\tfname = ZSTR_VAL(intern->file_name);\n \t\tflen = ZSTR_LEN(intern->file_name);\n+\t\tzend_string_release_ex(path, /* persistent */ false);\n \t}\n-\tzend_string_release_ex(path, /* persistent */ false);\n \n \tRETURN_STR(php_basename(fname, flen, suffix, slen));\n }\n", "result": true}