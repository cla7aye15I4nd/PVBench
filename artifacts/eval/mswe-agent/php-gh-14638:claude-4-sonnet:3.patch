
diff --git a/.gitignore b/.gitignore
index b8eb03412fa..e959803a362 100644
--- a/.gitignore
+++ b/.gitignore
@@ -296,3 +296,12 @@ tmp-php.ini
 !/ext/fileinfo/magicdata.patch
 !/ext/pcre/pcre2lib/config.h
 !/win32/build/Makefile
+build/
+Build/
+bin/
+lib/
+*.out
+*.exe
+*.dll
+*.so
+*.dylib
diff --git a/ext/simplexml/simplexml.c b/ext/simplexml/simplexml.c
index ce7c96a0d46..528b141ea3d 100644
--- a/ext/simplexml/simplexml.c
+++ b/ext/simplexml/simplexml.c
@@ -1291,11 +1291,11 @@ PHP_METHOD(SimpleXMLElement, xpath)
 	}
 
 	if (!sxe->xpath) {
-		sxe->xpath = xmlXPathNewContext((xmlDocPtr) sxe->document->ptr);
+		sxe->xpath = sxe->document->ptr ? xmlXPathNewContext((xmlDocPtr) sxe->document->ptr) : NULL;
 	}
 	sxe->xpath->node = nodeptr;
 
-	ns = xmlGetNsList((xmlDocPtr) sxe->document->ptr, nodeptr);
+	ns = sxe->document->ptr ? xmlGetNsList((xmlDocPtr) sxe->document->ptr, nodeptr) : NULL;
 	if (ns != NULL) {
 		while (ns[nsnbr] != NULL) {
 			nsnbr++;
@@ -1366,7 +1366,7 @@ PHP_METHOD(SimpleXMLElement, registerXPathNamespace)
 	}
 
 	if (!sxe->xpath) {
-		sxe->xpath = xmlXPathNewContext((xmlDocPtr) sxe->document->ptr);
+		sxe->xpath = sxe->document->ptr ? xmlXPathNewContext((xmlDocPtr) sxe->document->ptr) : NULL;
 	}
 
 	if (xmlXPathRegisterNs(sxe->xpath, (xmlChar *)prefix, (xmlChar *)ns_uri) != 0) {
@@ -1568,7 +1568,7 @@ PHP_METHOD(SimpleXMLElement, getDocNamespaces)
 			RETURN_THROWS();
 		}
 
-		node = xmlDocGetRootElement((xmlDocPtr)sxe->document->ptr);
+		node = sxe->document->ptr ? xmlDocGetRootElement((xmlDocPtr)sxe->document->ptr) : NULL;
 	} else {
 		GET_NODE(sxe, node);
 	}
@@ -1857,18 +1857,18 @@ static zend_result sxe_object_cast_ex(zend_object *readobj, zval *writeobj, int
 	if (sxe->iter.type != SXE_ITER_NONE) {
 		node = php_sxe_get_first_node(sxe, NULL);
 		if (node) {
-			contents = xmlNodeListGetString((xmlDocPtr) sxe->document->ptr, node->children, 1);
+			contents = xmlNodeListGetString(sxe->document && sxe->document->ptr ? (xmlDocPtr) sxe->document->ptr : NULL, node->children, 1);
 		}
 	} else {
 		if (!sxe->node) {
 			if (sxe->document) {
-				php_libxml_increment_node_ptr((php_libxml_node_object *)sxe, xmlDocGetRootElement((xmlDocPtr) sxe->document->ptr), NULL);
+				php_libxml_increment_node_ptr((php_libxml_node_object *)sxe, sxe->document->ptr ? xmlDocGetRootElement((xmlDocPtr) sxe->document->ptr) : NULL, NULL);
 			}
 		}
 
 		if (sxe->node && sxe->node->node) {
 			if (sxe->node->node->children) {
-				contents = xmlNodeListGetString((xmlDocPtr) sxe->document->ptr, sxe->node->node->children, 1);
+				contents = xmlNodeListGetString(sxe->document && sxe->document->ptr ? (xmlDocPtr) sxe->document->ptr : NULL, sxe->node->node->children, 1);
 			} else if (sxe->node->node->type == XML_COMMENT_NODE || sxe->node->node->type == XML_PI_NODE) {
 				contents = sxe->node->node->content;
 				free_contents = false;
