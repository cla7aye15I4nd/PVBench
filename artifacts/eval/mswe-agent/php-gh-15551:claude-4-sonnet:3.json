[{"patch": "diff --git a/.gitignore b/.gitignore\nindex b8eb03412fa..e959803a362 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -296,3 +296,12 @@ tmp-php.ini\n !/ext/fileinfo/magicdata.patch\n !/ext/pcre/pcre2lib/config.h\n !/win32/build/Makefile\n+build/\n+Build/\n+bin/\n+lib/\n+*.out\n+*.exe\n+*.dll\n+*.so\n+*.dylib\ndiff --git a/ext/dom/dom_iterators.c b/ext/dom/dom_iterators.c\nindex 866cb5a07e9..77d944e96a4 100644\n--- a/ext/dom/dom_iterators.c\n+++ b/ext/dom/dom_iterators.c\n@@ -159,7 +159,7 @@ static void php_dom_iterator_current_key(zend_object_iterator *iter, zval *key)\n \tif (instanceof_function(Z_OBJCE_P(object), dom_nodelist_class_entry)) {\n \t\tZVAL_LONG(key, iter->index);\n \t} else {\n-\t\tdom_object *intern = Z_DOMOBJ_P(&iterator->curobj);\n+\t\tdom_object *intern = Z_TYPE(iterator->curobj) == IS_OBJECT ? Z_DOMOBJ_P(&iterator->curobj) : NULL;\n \n \t\tif (intern != NULL && intern->ptr != NULL) {\n \t\t\txmlNodePtr curnode = (xmlNodePtr)((php_libxml_node_ptr *)intern->ptr)->node;\n@@ -186,12 +186,16 @@ static void php_dom_iterator_move_forward(zend_object_iterator *iter) /* {{{ */\n \tphp_dom_iterator *iterator = (php_dom_iterator *)iter;\n \n \tobject = &iterator->intern.data;\n-\tnnmap = Z_DOMOBJ_P(object);\n-\tobjmap = (dom_nnodemap_object *)nnmap->ptr;\n+\tnnmap = Z_TYPE_P(object) == IS_OBJECT ? Z_DOMOBJ_P(object) : NULL;\n+\tobjmap = (nnmap != NULL) ? (dom_nnodemap_object *)nnmap->ptr : NULL;\n \n-\tintern = Z_DOMOBJ_P(&iterator->curobj);\n+\tif (Z_TYPE(iterator->curobj) == IS_OBJECT) {\n+\t\tintern = Z_DOMOBJ_P(&iterator->curobj);\n+\t} else {\n+\t\tintern = NULL;\n+\t}\n \n-\tif (intern != NULL && intern->ptr != NULL) {\n+\tif (intern != NULL && intern->ptr != NULL && objmap != NULL) {\n \t\tif (objmap->nodetype != XML_ENTITY_NODE &&\n \t\t\tobjmap->nodetype != XML_NOTATION_NODE) {\n \t\t\tif (objmap->nodetype == DOM_NODESET) {\n@@ -236,7 +240,7 @@ static void php_dom_iterator_move_forward(zend_object_iterator *iter) /* {{{ */\n \t\tzval_ptr_dtor(&iterator->curobj);\n \t\tZVAL_UNDEF(&iterator->curobj);\n \t}\n-\tif (curnode) {\n+\tif (curnode && objmap != NULL) {\n \t\tphp_dom_create_object(curnode, &iterator->curobj, objmap->baseobj);\n \t}\n }\n@@ -275,8 +279,8 @@ zend_object_iterator *php_dom_get_iterator(zend_class_entry *ce, zval *object, i\n \n \tZVAL_UNDEF(&iterator->curobj);\n \n-\tintern = Z_DOMOBJ_P(object);\n-\tobjmap = (dom_nnodemap_object *)intern->ptr;\n+\tintern = Z_TYPE_P(object) == IS_OBJECT ? Z_DOMOBJ_P(object) : NULL;\n+\tobjmap = (intern != NULL) ? (dom_nnodemap_object *)intern->ptr : NULL;\n \tif (objmap != NULL) {\n \t\tif (objmap->nodetype != XML_ENTITY_NODE &&\n \t\t\tobjmap->nodetype != XML_NOTATION_NODE) {\n@@ -316,7 +320,7 @@ zend_object_iterator *php_dom_get_iterator(zend_class_entry *ce, zval *object, i\n \t\t}\n \t}\n err:\n-\tif (curnode) {\n+\tif (curnode && objmap != NULL) {\n \t\tphp_dom_create_object(curnode, &iterator->curobj, objmap->baseobj);\n \t}\n \n"}]