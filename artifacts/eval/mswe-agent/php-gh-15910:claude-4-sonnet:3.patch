
diff --git a/.gitignore b/.gitignore
index d54334f599a..3a5943bfb9b 100644
--- a/.gitignore
+++ b/.gitignore
@@ -297,3 +297,12 @@ tmp-php.ini
 !/ext/dom/lexbor/patches/*.patch
 !/ext/pcre/pcre2lib/config.h
 !/win32/build/Makefile
+build/
+Build/
+bin/
+lib/
+*.out
+*.exe
+*.dll
+*.so
+*.dylib
diff --git a/ext/dom/element.c b/ext/dom/element.c
index b4495559830..d1e6ba94b81 100644
--- a/ext/dom/element.c
+++ b/ext/dom/element.c
@@ -712,7 +712,12 @@ static void dom_element_set_attribute_node_common(INTERNAL_FUNCTION_PARAMETERS,
 
 	nsp = attrp->ns;
 	if (use_ns && nsp != NULL) {
-		existattrp = xmlHasNsProp(nodep, attrp->name, nsp->href);
+		const xmlChar *ns_href = nsp->href;
+		if (ns_href != NULL) {
+			existattrp = xmlHasNsProp(nodep, attrp->name, ns_href);
+		} else {
+			existattrp = xmlHasProp(nodep, attrp->name);
+		}
 	} else {
 		existattrp = xmlHasProp(nodep, attrp->name);
 	}
