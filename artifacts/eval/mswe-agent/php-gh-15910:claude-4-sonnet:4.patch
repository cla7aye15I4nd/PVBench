
diff --git a/.gitignore b/.gitignore
index d54334f599a..3a5943bfb9b 100644
--- a/.gitignore
+++ b/.gitignore
@@ -297,3 +297,12 @@ tmp-php.ini
 !/ext/dom/lexbor/patches/*.patch
 !/ext/pcre/pcre2lib/config.h
 !/win32/build/Makefile
+build/
+Build/
+bin/
+lib/
+*.out
+*.exe
+*.dll
+*.so
+*.dylib
diff --git a/ext/dom/element.c b/ext/dom/element.c
index b4495559830..8a202ad1579 100644
--- a/ext/dom/element.c
+++ b/ext/dom/element.c
@@ -711,7 +711,7 @@ static void dom_element_set_attribute_node_common(INTERNAL_FUNCTION_PARAMETERS,
 	}
 
 	nsp = attrp->ns;
-	if (use_ns && nsp != NULL) {
+	if (use_ns && nsp != NULL && nsp->href != NULL) {
 		existattrp = xmlHasNsProp(nodep, attrp->name, nsp->href);
 	} else {
 		existattrp = xmlHasProp(nodep, attrp->name);
diff --git a/test_edge_case.c b/test_edge_case.c
new file mode 100644
index 00000000000..8b137891791
--- /dev/null
+++ b/test_edge_case.c
@@ -0,0 +1 @@
+
