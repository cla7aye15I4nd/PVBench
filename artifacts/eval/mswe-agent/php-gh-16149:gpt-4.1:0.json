[{"patch": "diff --git a/.gitignore b/.gitignore\nindex 49acc9f2e17..de22b095dfc 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -297,3 +297,12 @@ tmp-php.ini\n !/ext/fileinfo/magicdata.patch\n !/ext/pcre/pcre2lib/config.h\n !/win32/build/Makefile\n+build/\n+Build/\n+bin/\n+lib/\n+*.out\n+*.exe\n+*.dll\n+*.so\n+*.dylib\ndiff --git a/ext/dom/element.c b/ext/dom/element.c\nindex 46f1100a767..3fcae3595f3 100644\n--- a/ext/dom/element.c\n+++ b/ext/dom/element.c\n@@ -339,7 +339,7 @@ PHP_METHOD(DOMElement, getAttributeNames)\n \n \tfor (xmlNsPtr nsptr = nodep->nsDef; nsptr; nsptr = nsptr->next) {\n \t\tconst char *prefix = (const char *) nsptr->prefix;\n-\t\tZVAL_STR(&tmp, dom_node_concatenated_name_helper(strlen(prefix), prefix, strlen(\"xmlns\"), (const char *) \"xmlns\"));\n+        ZVAL_STR(&tmp, dom_node_concatenated_name_helper(strlen(prefix ? prefix : \"\"), prefix ? prefix : \"\", strlen(\"xmlns\"), (const char *) \"xmlns\"));\n \t\tzend_hash_next_index_insert(ht, &tmp);\n \t}\n \ndiff --git a/ext/spl/spl_array.c b/ext/spl/spl_array.c\nindex 3fcce1a7682..55b2886dd0c 100644\n--- a/ext/spl/spl_array.c\n+++ b/ext/spl/spl_array.c\n@@ -139,10 +139,13 @@ static void spl_array_object_free_storage(zend_object *object)\n \n \tzend_object_std_dtor(&intern->std);\n \n-\tzval_ptr_dtor(&intern->array);\n+    if (Z_TYPE(intern->array) == IS_OBJECT && Z_OBJ(intern->array) == &intern->std) {\n+        ZVAL_UNDEF(&intern->array);\n+    } else if (Z_TYPE(intern->array) != IS_UNDEF) {\n+        zval_ptr_dtor(&intern->array);\n+        ZVAL_UNDEF(&intern->array);\n+    }\n }\n-/* }}} */\n-\n /* {{{ spl_array_object_new_ex */\n static zend_object *spl_array_object_new_ex(zend_class_entry *class_type, zend_object *orig, int clone_orig)\n {\n@@ -548,33 +551,45 @@ static void spl_array_unset_dimension_ex(int check_inherited, zend_object *objec\n \tht = spl_array_get_hash_table(intern);\n \tuint32_t refcount = spl_array_set_refcount(intern->is_child, ht, 1);\n \n-\tif (key.key) {\n-\t\tzval *data = zend_hash_find(ht, key.key);\n-\t\tif (data) {\n-\t\t\tif (Z_TYPE_P(data) == IS_INDIRECT) {\n-\t\t\t\tdata = Z_INDIRECT_P(data);\n-\t\t\t\tif (Z_TYPE_P(data) != IS_UNDEF) {\n-\t\t\t\t\tzval_ptr_dtor(data);\n-\t\t\t\t\tZVAL_UNDEF(data);\n-\t\t\t\t\tHT_FLAGS(ht) |= HASH_FLAG_HAS_EMPTY_IND;\n-\t\t\t\t\tzend_hash_move_forward_ex(ht, spl_array_get_pos_ptr(ht, intern));\n-\t\t\t\t\tif (spl_array_is_object(intern)) {\n-\t\t\t\t\t\tspl_array_skip_protected(intern, ht);\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t} else {\n-\t\t\t\tzend_hash_del(ht, key.key);\n-\t\t\t}\n-\t\t}\n-\t\tspl_hash_key_release(&key);\n-\t} else {\n-\t\tzend_hash_index_del(ht, key.h);\n-\t}\n-\n-\tif (refcount) {\n-\t\tspl_array_set_refcount(intern->is_child, ht, refcount);\n-\t}\n-} /* }}} */\n+    if (key.key) {\n+        zval *data = zend_hash_find(ht, key.key);\n+        if (data) {\n+            if (Z_TYPE_P(data) == IS_INDIRECT) {\n+                data = Z_INDIRECT_P(data);\n+                if (Z_TYPE_P(data) != IS_UNDEF) {\n+                    if (Z_TYPE_P(data) == IS_OBJECT && Z_OBJ_P(data) == &intern->std) {\n+                        ZVAL_UNDEF(data);\n+                        ZVAL_UNDEF(&intern->array);\n+                        HT_FLAGS(ht) |= HASH_FLAG_HAS_EMPTY_IND;\n+                        zend_hash_move_forward_ex(ht, spl_array_get_pos_ptr(ht, intern));\n+                        spl_array_skip_protected(intern, ht);\n+                    } else {\n+                        zval_ptr_dtor(data);\n+                        ZVAL_UNDEF(data);\n+                        HT_FLAGS(ht) |= HASH_FLAG_HAS_EMPTY_IND;\n+                        zend_hash_move_forward_ex(ht, spl_array_get_pos_ptr(ht, intern));\n+                        spl_array_skip_protected(intern, ht);\n+                    }\n+\n+                }\n+            } else {\n+                if (Z_TYPE_P(data) == IS_OBJECT && Z_OBJ_P(data) == &intern->std) {\n+                    ZVAL_UNDEF(data);\n+                    ZVAL_UNDEF(&intern->array);\n+                } else {\n+                    zend_hash_del(ht, key.key);\n+                }\n+            }\n+        }\n+        spl_hash_key_release(&key);\n+    } else {\n+        zend_hash_index_del(ht, key.h);\n+    }\n+\n+    if (refcount) {\n+        spl_array_set_refcount(intern->is_child, ht, refcount);\n+    }\n+}\n \n static void spl_array_unset_dimension(zend_object *object, zval *offset) /* {{{ */\n {\n"}]