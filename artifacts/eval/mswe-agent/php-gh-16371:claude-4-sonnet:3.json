[{"patch": "diff --git a/.gitignore b/.gitignore\nindex b8eb03412fa..e959803a362 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -296,3 +296,12 @@ tmp-php.ini\n !/ext/fileinfo/magicdata.patch\n !/ext/pcre/pcre2lib/config.h\n !/win32/build/Makefile\n+build/\n+Build/\n+bin/\n+lib/\n+*.out\n+*.exe\n+*.dll\n+*.so\n+*.dylib\ndiff --git a/Zend/zend_weakrefs.c b/Zend/zend_weakrefs.c\nindex 3f2e517f3fe..77d3fd873a9 100644\n--- a/Zend/zend_weakrefs.c\n+++ b/Zend/zend_weakrefs.c\n@@ -450,15 +450,17 @@ static HashTable *zend_weakmap_get_properties_for(zend_object *object, zend_prop\n \tzval *val;\n \tZEND_HASH_MAP_FOREACH_NUM_KEY_VAL(&wm->ht, obj_key, val) {\n \t\tzend_object *obj = zend_weakref_key_to_object(obj_key);\n-\t\tzval pair;\n-\t\tarray_init(&pair);\n+\t\tif (obj) {\n+\t\t\tzval pair;\n+\t\t\tarray_init(&pair);\n \n-\t\tGC_ADDREF(obj);\n-\t\tadd_assoc_object(&pair, \"key\", obj);\n-\t\tZ_TRY_ADDREF_P(val);\n-\t\tadd_assoc_zval(&pair, \"value\", val);\n+\t\t\tGC_ADDREF(obj);\n+\t\t\tadd_assoc_object(&pair, \"key\", obj);\n+\t\t\tZ_TRY_ADDREF_P(val);\n+\t\t\tadd_assoc_zval(&pair, \"value\", val);\n \n-\t\tzend_hash_next_index_insert_new(ht, &pair);\n+\t\t\tzend_hash_next_index_insert_new(ht, &pair);\n+\t\t}\n \t} ZEND_HASH_FOREACH_END();\n \n \treturn ht;\n@@ -486,9 +488,11 @@ static zend_object *zend_weakmap_clone_obj(zend_object *old_object)\n \tzend_ulong obj_key;\n \tzval *val;\n \tZEND_HASH_MAP_FOREACH_NUM_KEY_VAL(&new_wm->ht, obj_key, val) {\n-\t\tzend_weakref_register(\n-\t\t\tzend_weakref_key_to_object(obj_key), ZEND_WEAKREF_ENCODE(new_wm, ZEND_WEAKREF_TAG_MAP));\n-\t\tzval_add_ref(val);\n+\t\tzend_object *obj = zend_weakref_key_to_object(obj_key);\n+\t\tif (obj) {\n+\t\t\tzend_weakref_register(obj, ZEND_WEAKREF_ENCODE(new_wm, ZEND_WEAKREF_TAG_MAP));\n+\t\t\tzval_add_ref(val);\n+\t\t}\n \t} ZEND_HASH_FOREACH_END();\n \treturn new_object;\n }\n@@ -534,7 +538,12 @@ static void zend_weakmap_iterator_get_current_key(zend_object_iterator *obj_iter\n \t\tZEND_ASSERT(0 && \"Must have integer key\");\n \t}\n \n-\tZVAL_OBJ_COPY(key, zend_weakref_key_to_object(num_key));\n+\tzend_object *obj = zend_weakref_key_to_object(num_key);\n+\tif (obj) {\n+\t\tZVAL_OBJ_COPY(key, obj);\n+\t} else {\n+\t\tZVAL_NULL(key);\n+\t}\n }\n \n static void zend_weakmap_iterator_move_forward(zend_object_iterator *obj_iter)\n"}]