[{"patch": "diff --git a/.gitignore b/.gitignore\nindex b8eb03412fa..e959803a362 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -296,3 +296,12 @@ tmp-php.ini\n !/ext/fileinfo/magicdata.patch\n !/ext/pcre/pcre2lib/config.h\n !/win32/build/Makefile\n+build/\n+Build/\n+bin/\n+lib/\n+*.out\n+*.exe\n+*.dll\n+*.so\n+*.dylib\ndiff --git a/Zend/zend_weakrefs.c b/Zend/zend_weakrefs.c\nindex 3f2e517f3fe..0346d3860e2 100644\n--- a/Zend/zend_weakrefs.c\n+++ b/Zend/zend_weakrefs.c\n@@ -534,9 +534,13 @@ static void zend_weakmap_iterator_get_current_key(zend_object_iterator *obj_iter\n \t\tZEND_ASSERT(0 && \"Must have integer key\");\n \t}\n \n-\tZVAL_OBJ_COPY(key, zend_weakref_key_to_object(num_key));\n+\tzend_object *obj = zend_weakref_key_to_object(num_key);\n+\tif (obj && GC_REFCOUNT(obj) > 0 && GC_TYPE(obj) != IS_NULL) {\n+\t\tZVAL_OBJ_COPY(key, obj);\n+\t} else {\n+\t\tZVAL_NULL(key);\n+\t}\n }\n-\n static void zend_weakmap_iterator_move_forward(zend_object_iterator *obj_iter)\n {\n \tzend_weakmap_iterator *iter = (zend_weakmap_iterator *) obj_iter;\ndiff --git a/ext/spl/spl_array.c b/ext/spl/spl_array.c\nindex dbe110f7c40..2fb21c7b5ff 100644\n--- a/ext/spl/spl_array.c\n+++ b/ext/spl/spl_array.c\n@@ -555,7 +555,7 @@ static void spl_array_unset_dimension_ex(int check_inherited, zend_object *objec\n \t\t\tif (Z_TYPE_P(data) == IS_INDIRECT) {\n \t\t\t\tdata = Z_INDIRECT_P(data);\n \t\t\t\tif (Z_TYPE_P(data) != IS_UNDEF) {\n-\t\t\t\t\tzval_ptr_dtor(data);\n+\t\t\t\t\tZ_TRY_DELREF_P(data);\n \t\t\t\t\tZVAL_UNDEF(data);\n \t\t\t\t\tHT_FLAGS(ht) |= HASH_FLAG_HAS_EMPTY_IND;\n \t\t\t\t\tzend_hash_move_forward_ex(ht, spl_array_get_pos_ptr(ht, intern));\n"}]