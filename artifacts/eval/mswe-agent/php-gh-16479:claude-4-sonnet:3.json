[{"patch": "diff --git a/.gitignore b/.gitignore\nindex b8eb03412fa..e959803a362 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -296,3 +296,12 @@ tmp-php.ini\n !/ext/fileinfo/magicdata.patch\n !/ext/pcre/pcre2lib/config.h\n !/win32/build/Makefile\n+build/\n+Build/\n+bin/\n+lib/\n+*.out\n+*.exe\n+*.dll\n+*.so\n+*.dylib\ndiff --git a/ext/spl/spl_array.c b/ext/spl/spl_array.c\nindex dbe110f7c40..3e9430fa1ac 100644\n--- a/ext/spl/spl_array.c\n+++ b/ext/spl/spl_array.c\n@@ -555,8 +555,21 @@ static void spl_array_unset_dimension_ex(int check_inherited, zend_object *objec\n \t\t\tif (Z_TYPE_P(data) == IS_INDIRECT) {\n \t\t\t\tdata = Z_INDIRECT_P(data);\n \t\t\t\tif (Z_TYPE_P(data) != IS_UNDEF) {\n-\t\t\t\t\tzval_ptr_dtor(data);\n+\t\t\t\t\tzval old_data;\n+\t\t\t\t\tZVAL_COPY_VALUE(&old_data, data);\n \t\t\t\t\tZVAL_UNDEF(data);\n+\t\t\t\t\t\n+\t\t\t\t\t/* Restore refcount before calling destructor to avoid assertion failures */\n+\t\t\t\t\tif (refcount) {\n+\t\t\t\t\t\tspl_array_set_refcount(intern->is_child, ht, refcount);\n+\t\t\t\t\t}\n+\t\t\t\t\t\n+\t\t\t\t\tzval_ptr_dtor(&old_data);\n+\t\t\t\t\t\n+\t\t\t\t\t/* Re-get hash table and set refcount again, as destructor may have changed it */\n+\t\t\t\t\tht = spl_array_get_hash_table(intern);\n+\t\t\t\t\trefcount = spl_array_set_refcount(intern->is_child, ht, 1);\n+\t\t\t\t\t\n \t\t\t\t\tHT_FLAGS(ht) |= HASH_FLAG_HAS_EMPTY_IND;\n \t\t\t\t\tzend_hash_move_forward_ex(ht, spl_array_get_pos_ptr(ht, intern));\n \t\t\t\t\tif (spl_array_is_object(intern)) {\n@@ -575,6 +588,7 @@ static void spl_array_unset_dimension_ex(int check_inherited, zend_object *objec\n \tif (refcount) {\n \t\tspl_array_set_refcount(intern->is_child, ht, refcount);\n \t}\n+\n } /* }}} */\n \n static void spl_array_unset_dimension(zend_object *object, zval *offset) /* {{{ */\ndiff --git a/ext/spl/spl_observer.c b/ext/spl/spl_observer.c\nindex 21b19cffa38..b01baf7fefd 100644\n--- a/ext/spl/spl_observer.c\n+++ b/ext/spl/spl_observer.c\n@@ -746,8 +746,10 @@ PHP_METHOD(SplObjectStorage, setInfo)\n \tif ((element = zend_hash_get_current_data_ptr_ex(&intern->storage, &intern->pos)) == NULL) {\n \t\tRETURN_NULL();\n \t}\n-\tzval_ptr_dtor(&element->inf);\n+\tzval old_inf;\n+\tZVAL_COPY_VALUE(&old_inf, &element->inf);\n \tZVAL_COPY(&element->inf, inf);\n+\tzval_ptr_dtor(&old_inf);\n } /* }}} */\n \n /* {{{ Moves position forward */\n"}]