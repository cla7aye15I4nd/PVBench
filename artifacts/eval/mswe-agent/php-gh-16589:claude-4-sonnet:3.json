[{"patch": "diff --git a/.gitignore b/.gitignore\nindex b8eb03412fa..e959803a362 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -296,3 +296,12 @@ tmp-php.ini\n !/ext/fileinfo/magicdata.patch\n !/ext/pcre/pcre2lib/config.h\n !/win32/build/Makefile\n+build/\n+Build/\n+bin/\n+lib/\n+*.out\n+*.exe\n+*.dll\n+*.so\n+*.dylib\ndiff --git a/ext/spl/spl_dllist.c b/ext/spl/spl_dllist.c\nindex 6592efc4e5e..557a07afaed 100644\n--- a/ext/spl/spl_dllist.c\n+++ b/ext/spl/spl_dllist.c\n@@ -1005,7 +1005,7 @@ PHP_METHOD(SplDoublyLinkedList, serialize)\n {\n \tspl_dllist_object     *intern   = Z_SPLDLLIST_P(ZEND_THIS);\n \tsmart_str              buf      = {0};\n-\tspl_ptr_llist_element *current  = intern->llist->head, *next;\n+\tspl_ptr_llist_element *current  = intern->llist->head;\n \tzval                   flags;\n \tphp_serialize_data_t   var_hash;\n \n@@ -1022,11 +1022,29 @@ PHP_METHOD(SplDoublyLinkedList, serialize)\n \t/* elements */\n \twhile (current) {\n \t\tsmart_str_appendc(&buf, ':');\n-\t\tnext = current->next;\n-\n+\t\t\n+\t\t/* Save reference to current element for validation */\n+\t\tspl_ptr_llist_element *saved_current = current;\n+\t\t\n \t\tphp_var_serialize(&buf, &current->data, &var_hash);\n-\n-\t\tcurrent = next;\n+\t\t\n+\t\t/* Check if the current element is still valid by walking the list */\n+\t\tspl_ptr_llist_element *check = intern->llist->head;\n+\t\tint found = 0;\n+\t\twhile (check) {\n+\t\t\tif (check == saved_current) {\n+\t\t\t\tfound = 1;\n+\t\t\t\tbreak;\n+\t\t\t}\n+\t\t\tcheck = check->next;\n+\t\t}\n+\t\t\n+\t\t/* If current element was removed during serialization, restart from head */\n+\t\tif (!found) {\n+\t\t\tcurrent = intern->llist->head;\n+\t\t} else {\n+\t\t\tcurrent = current->next;\n+\t\t}\n \t}\n \n \t/* done */\n"}]