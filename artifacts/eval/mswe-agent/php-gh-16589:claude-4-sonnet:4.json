[{"patch": "diff --git a/.gitignore b/.gitignore\nindex b8eb03412fa..e959803a362 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -296,3 +296,12 @@ tmp-php.ini\n !/ext/fileinfo/magicdata.patch\n !/ext/pcre/pcre2lib/config.h\n !/win32/build/Makefile\n+build/\n+Build/\n+bin/\n+lib/\n+*.out\n+*.exe\n+*.dll\n+*.so\n+*.dylib\ndiff --git a/ext/spl/spl_dllist.c b/ext/spl/spl_dllist.c\nindex 6592efc4e5e..b930ee9ecbb 100644\n--- a/ext/spl/spl_dllist.c\n+++ b/ext/spl/spl_dllist.c\n@@ -1,27 +1,3 @@\n-/*\n-   +----------------------------------------------------------------------+\n-   | Copyright (c) The PHP Group                                          |\n-   +----------------------------------------------------------------------+\n-   | This source file is subject to version 3.01 of the PHP license,      |\n-   | that is bundled with this package in the file LICENSE, and is        |\n-   | available through the world-wide-web at the following url:           |\n-   | https://www.php.net/license/3_01.txt                                 |\n-   | If you did not receive a copy of the PHP license and are unable to   |\n-   | obtain it through the world-wide-web, please send a note to          |\n-   | license@php.net so we can mail you a copy immediately.               |\n-   +----------------------------------------------------------------------+\n-   | Authors: Etienne Kneuss <colder@php.net>                             |\n-   +----------------------------------------------------------------------+\n- */\n-\n-#ifdef HAVE_CONFIG_H\n-# include \"config.h\"\n-#endif\n-\n-#include \"php.h\"\n-#include \"zend_exceptions.h\"\n-#include \"zend_hash.h\"\n-\n #include \"php_spl.h\"\n #include \"ext/standard/info.h\"\n #include \"ext/standard/php_var.h\"\n@@ -32,6 +8,7 @@\n #include \"spl_dllist.h\"\n #include \"spl_dllist_arginfo.h\"\n #include \"spl_exceptions.h\"\n+#include \"zend_exceptions.h\"\n \n zend_object_handlers spl_handler_SplDoublyLinkedList;\n PHPAPI zend_class_entry  *spl_ce_SplDoublyLinkedList;\n@@ -1008,6 +985,7 @@ PHP_METHOD(SplDoublyLinkedList, serialize)\n \tspl_ptr_llist_element *current  = intern->llist->head, *next;\n \tzval                   flags;\n \tphp_serialize_data_t   var_hash;\n+\tuint32_t               original_count;\n \n \tif (zend_parse_parameters_none() == FAILURE) {\n \t\tRETURN_THROWS();\n@@ -1019,6 +997,9 @@ PHP_METHOD(SplDoublyLinkedList, serialize)\n \tZVAL_LONG(&flags, intern->flags);\n \tphp_var_serialize(&buf, &flags, &var_hash);\n \n+\t/* Store original count to detect modifications */\n+\toriginal_count = intern->llist->count;\n+\n \t/* elements */\n \twhile (current) {\n \t\tsmart_str_appendc(&buf, ':');\n@@ -1026,6 +1007,14 @@ PHP_METHOD(SplDoublyLinkedList, serialize)\n \n \t\tphp_var_serialize(&buf, &current->data, &var_hash);\n \n+\t\t/* Check if the list was modified during serialization */\n+\t\tif (intern->llist->count != original_count) {\n+\t\t\tPHP_VAR_SERIALIZE_DESTROY(var_hash);\n+\t\t\tsmart_str_free(&buf);\n+\t\t\tzend_throw_exception_ex(spl_ce_RuntimeException, 0, \"SplDoublyLinkedList was modified during serialization\");\n+\t\t\tRETURN_THROWS();\n+\t\t}\n+\n \t\tcurrent = next;\n \t}\n \n@@ -1033,7 +1022,7 @@ PHP_METHOD(SplDoublyLinkedList, serialize)\n \tPHP_VAR_SERIALIZE_DESTROY(var_hash);\n \n \tRETURN_STR(smart_str_extract(&buf));\n-} /* }}} */\n+}\n \n /* {{{ Unserializes storage */\n PHP_METHOD(SplDoublyLinkedList, unserialize)\n"}]