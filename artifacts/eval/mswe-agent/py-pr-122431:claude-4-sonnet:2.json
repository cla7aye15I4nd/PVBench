[{"patch": "diff --git a/.gitignore b/.gitignore\nindex 8872e9d5508..959a12bbd57 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -171,3 +171,9 @@ Python/frozen_modules/MANIFEST\n \n # main branch only: ABI files are not checked/maintained.\n Doc/data/python*.abi\n+build/\n+Build/\n+bin/\n+lib/\n+*.out\n+*.obj\ndiff --git a/Modules/readline.c b/Modules/readline.c\nindex 35655c70a46..dc34ada81ab 100644\n--- a/Modules/readline.c\n+++ b/Modules/readline.c\n@@ -362,8 +362,22 @@ readline_append_history_file_impl(PyObject *module, int nelements,\n         filename_bytes = NULL;\n         filename = NULL;\n     }\n-    errno = err = append_history(\n-        nelements - libedit_append_replace_history_offset, filename);\n+    /* Check for integer overflow before subtraction */\n+    int adjusted_nelements;\n+    if (libedit_append_replace_history_offset > 0 && nelements < INT_MIN + libedit_append_replace_history_offset) {\n+        /* Underflow would occur */\n+        adjusted_nelements = INT_MIN;\n+    } else if (libedit_append_replace_history_offset < 0 && nelements > INT_MAX + libedit_append_replace_history_offset) {\n+        /* Overflow would occur */\n+        adjusted_nelements = INT_MAX;\n+    } else {\n+        adjusted_nelements = nelements - libedit_append_replace_history_offset;\n+        /* Ensure we don't pass negative values to append_history */\n+        if (adjusted_nelements < 0) {\n+            adjusted_nelements = 0;\n+        }\n+    }\n+    errno = err = append_history(adjusted_nelements, filename);\n     if (!err && _history_length >= 0)\n         history_truncate_file(filename, _history_length);\n     Py_XDECREF(filename_bytes);\n"}]