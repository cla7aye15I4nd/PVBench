
diff --git a/.gitignore b/.gitignore
index 1ec7961f..87231784 100644
--- a/.gitignore
+++ b/.gitignore
@@ -64,3 +64,12 @@ Makefile.in
 /m4/lt*.m4
 /py-compile
 /stamp-h1
+build/
+Build/
+bin/
+lib/
+*.out
+*.obj
+*.dll
+*.so
+*.dylib
diff --git a/schematron.c b/schematron.c
index 85b46282..0d764f07 100644
--- a/schematron.c
+++ b/schematron.c
@@ -35,6 +35,7 @@
 #include <libxml/pattern.h>
 #include <libxml/schematron.h>
 
+#include <stdint.h>
 #include "private/error.h"
 
 #define SCHEMATRON_PARSE_OPTIONS XML_PARSE_NOENT
@@ -1439,12 +1440,20 @@ xmlSchematronFormatReport(xmlSchematronValidCtxtPtr ctxt,
                 xmlFree(path);
             }
 
-            if ((node->ns == NULL) || (node->ns->prefix == NULL))
-                ret = xmlStrcat(ret, node->name);
-            else {
-                ret = xmlStrcat(ret, node->ns->prefix);
-                ret = xmlStrcat(ret, BAD_CAST ":");
+            if (node->ns == NULL) {
                 ret = xmlStrcat(ret, node->name);
+            } else {
+                /* Additional safety check for corrupted ns pointer */
+                if ((uintptr_t)node->ns < 0x1000 || (uintptr_t)node->ns == (uintptr_t)-1) {
+                    /* Corrupted pointer, treat as if ns is NULL */
+                    ret = xmlStrcat(ret, node->name);
+                } else if (node->ns->prefix == NULL) {
+                    ret = xmlStrcat(ret, node->name);
+                } else {
+                    ret = xmlStrcat(ret, node->ns->prefix);
+                    ret = xmlStrcat(ret, BAD_CAST ":");
+                    ret = xmlStrcat(ret, node->name);
+                }
             }
         } else if (IS_SCHEMATRON(child, "value-of")) {
             xmlChar *select;
