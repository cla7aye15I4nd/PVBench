[{"patch": "diff --git a/.gitignore b/.gitignore\nindex ad751e89..ce29de49 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -125,3 +125,12 @@ xstc/Makefile\n xstc/Makefile.in\n xstc/Tests\n xstc/xsts-*.tar.gz\n+build/\n+Build/\n+bin/\n+lib/\n+*.out\n+*.obj\n+*.dll\n+*.so\n+*.dylib\ndiff --git a/xpath.c b/xpath.c\nindex 5e3bb9ff..e5162a6b 100644\n--- a/xpath.c\n+++ b/xpath.c\n@@ -9187,8 +9187,17 @@ xmlXPathSubstringFunction(xmlXPathParserContextPtr ctxt, int nargs) {\n          * First we go to integer form, rounding up\n \t * and checking for special cases\n          */\n-        i = (int) in;\n-        if (((double)i)+0.5 <= in) i++;\n+        /*\n+         * Safely convert double to int with bounds checking\n+         */\n+        if (in > INT_MAX) {\n+            i = INT_MAX;\n+        } else if (in < INT_MIN) {\n+            i = INT_MIN;\n+        } else {\n+            i = (int) in;\n+            if (((double)i)+0.5 <= in) i++;\n+        }\n \n \tif (xmlXPathIsInf(le) == 1) {\n \t    l = m;\n@@ -9198,20 +9207,47 @@ xmlXPathSubstringFunction(xmlXPathParserContextPtr ctxt, int nargs) {\n \telse if (xmlXPathIsInf(le) == -1 || le < 0.0)\n \t    l = 0;\n \telse {\n-\t    l = (int) le;\n-\t    if (((double)l)+0.5 <= le) l++;\n+\t    if (le > INT_MAX) {\n+\t        l = INT_MAX;\n+\t    } else if (le < INT_MIN) {\n+\t        l = INT_MIN;\n+\t    } else {\n+\t        l = (int) le;\n+\t        if (((double)l)+0.5 <= le) l++;\n+\t    }\n \t}\n \n-\t/* Now we normalize inidices */\n-        i -= 1;\n-        l += i;\n+\t/* Now we normalize indices */\n+        /* Safely handle i -= 1 to avoid underflow */\n+        if (i > INT_MIN) {\n+            i -= 1;\n+        } else {\n+            i = INT_MIN;\n+        }\n+        \n+        /* Safely handle l += i to avoid overflow */\n+        if (i > 0 && l > INT_MAX - i) {\n+            l = INT_MAX;\n+        } else if (i < 0 && l < INT_MIN - i) {\n+            l = INT_MIN;\n+        } else {\n+            l += i;\n+        }\n+        \n         if (i < 0)\n             i = 0;\n         if (l > m)\n             l = m;\n \n         /* number of chars to copy */\n-        l -= i;\n+        /* Safely handle l -= i to avoid underflow */\n+        if (i > 0 && l < INT_MIN + i) {\n+            l = INT_MIN;\n+        } else if (i < 0 && l > INT_MAX + i) {\n+            l = INT_MAX;\n+        } else {\n+            l -= i;\n+        }\n \n         ret = xmlUTF8Strsub(str->stringval, i, l);\n     }\n"}]