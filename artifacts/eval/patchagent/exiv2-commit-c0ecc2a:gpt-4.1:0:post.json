{"patch": "diff --git a/src/crwimage_int.cpp b/src/crwimage_int.cpp\nindex c2fd5f3a5..7a8fd61a8 100644\n--- a/src/crwimage_int.cpp\n+++ b/src/crwimage_int.cpp\n@@ -281,7 +281,10 @@ namespace Exiv2 {\n         if (size < 4)\n             throw Error(kerCorruptedMetadata);\n         uint32_t o = getULong(pData + size - 4, byteOrder);\n-        if ( o+2 > size )\n+        if (o + 2 > size)\n+            throw Error(kerCorruptedMetadata);\n+        // Ensure we have at least 2 bytes to read count\n+        if (o > size || size - o < 2)\n             throw Error(kerCorruptedMetadata);\n         uint16_t count = getUShort(pData + o, byteOrder);\n #ifdef DEBUG\n@@ -289,10 +292,13 @@ namespace Exiv2 {\n                   <<\", \" << count << \" entries \\n\";\n #endif\n         o += 2;\n-        if ( (o + (count * 10)) > size )\n+        if ((o + (count * 10)) > size)\n             throw Error(kerCorruptedMetadata);\n \n         for (uint16_t i = 0; i < count; ++i) {\n+            // Ensure we have at least 2 bytes to read tag\n+            if (o > size || size - o < 2)\n+                throw Error(kerCorruptedMetadata);\n             uint16_t tag = getUShort(pData + o, byteOrder);\n             CiffComponent::AutoPtr m;\n             switch (CiffComponent::typeId(tag)) {\n", "result": true}