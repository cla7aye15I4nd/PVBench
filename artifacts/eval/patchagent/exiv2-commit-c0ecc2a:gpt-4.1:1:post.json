{"patch": "diff --git a/src/crwimage_int.cpp b/src/crwimage_int.cpp\nindex c2fd5f3a5..1edba7a0d 100644\n--- a/src/crwimage_int.cpp\n+++ b/src/crwimage_int.cpp\n@@ -278,11 +278,22 @@ namespace Exiv2 {\n                                       uint32_t    size,\n                                       ByteOrder   byteOrder)\n     {\n-        if (size < 4)\n+        if (!pData || size < 4) {\n             throw Error(kerCorruptedMetadata);\n+        }\n+        // Defensive: getULong reads 4 bytes at pData+size-4\n+        if (size < 4) {\n+            throw Error(kerCorruptedMetadata);\n+        }\n         uint32_t o = getULong(pData + size - 4, byteOrder);\n-        if ( o+2 > size )\n+        // o must not be larger than size-2, and pData+o must be in bounds\n+        if (o > size - 2) {\n             throw Error(kerCorruptedMetadata);\n+        }\n+        // Defensive: pData+o must not overflow\n+        if (o > SIZE_MAX - 2) {\n+            throw Error(kerCorruptedMetadata);\n+        }\n         uint16_t count = getUShort(pData + o, byteOrder);\n #ifdef DEBUG\n         std::cout << \"Directory at offset \" << std::dec << o\n", "result": true}