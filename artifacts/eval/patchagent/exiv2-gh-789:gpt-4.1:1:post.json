{"patch": "diff --git a/src/pngimage.cpp b/src/pngimage.cpp\nindex 4ccec39d8..f5b8c8127 100644\n--- a/src/pngimage.cpp\n+++ b/src/pngimage.cpp\n@@ -462,15 +462,29 @@ namespace Exiv2 {\n                 } else if (chunkType == \"iCCP\") {\n                     // The ICC profile name can vary from 1-79 characters.\n                     uint32_t iccOffset = 0;\n+                    // ICC profile chunk must have at least 3 bytes: name, null, compression flag\n+                    if (chunkLength < 3) {\n+                        throw Exiv2::Error(Exiv2::kerCorruptedMetadata);\n+                    }\n+                    bool foundNull = false;\n                     while (iccOffset < 80 && iccOffset < chunkLength) {\n-                         if (chunkData.pData_[iccOffset++] ==  0x00) {\n+                        if (chunkData.pData_[iccOffset] == 0x00) {\n+                            foundNull = true;\n+                            ++iccOffset; // move past null terminator\n                             break;\n-                         }\n+                        }\n+                        ++iccOffset;\n+                    }\n+                    // After null, must have at least 1 more byte: compression flag, and at least 1 for data\n+                    if (!foundNull || iccOffset + 1 > chunkLength) {\n+                        throw Exiv2::Error(Exiv2::kerCorruptedMetadata);\n                     }\n                     profileName_ = std::string(reinterpret_cast<char *>(chunkData.pData_), iccOffset-1);\n-                    ++iccOffset; // +1 = 'compressed' flag\n-                    enforce(iccOffset <= chunkLength, Exiv2::kerCorruptedMetadata);\n-\n+                    // iccOffset now points to compression flag\n+                    ++iccOffset; // move past compression flag\n+                    if (iccOffset > chunkLength) {\n+                        throw Exiv2::Error(Exiv2::kerCorruptedMetadata);\n+                    }\n                     zlibToDataBuf(chunkData.pData_ + iccOffset, chunkLength - iccOffset, iccProfile_);\n #ifdef DEBUG\n                     std::cout << \"Exiv2::PngImage::readMetadata: profile name: \" << profileName_ << std::endl;\n", "result": true}