{"patch": "diff --git a/lib/AST/ES6Class.cpp b/lib/AST/ES6Class.cpp\nindex 42155e587..85378e20d 100644\n--- a/lib/AST/ES6Class.cpp\n+++ b/lib/AST/ES6Class.cpp\n@@ -219,14 +219,34 @@ class ES6ClassesTransformations {\n   }\n \n   void visit(ESTree::Node *node) {\n+    if (!incRecursionDepth(node)) {\n+      return;\n+    }\n     visitESTreeChildren(*this, node);\n+    decRecursionDepth();\n   }\n \n+  static constexpr int kMaxRecursionDepth = 1024;\n+  int recursionDepth_ = 0;\n+  bool exceededRecursion_ = false;\n+\n   bool incRecursionDepth(ESTree::Node *) {\n+    if (exceededRecursion_) {\n+      return false;\n+    }\n+    if (++recursionDepth_ > kMaxRecursionDepth) {\n+      exceededRecursion_ = true;\n+      --recursionDepth_;\n+      return false;\n+    }\n     return true;\n   }\n \n-  void decRecursionDepth() {}\n+  void decRecursionDepth() {\n+    if (!exceededRecursion_ && recursionDepth_ > 0) {\n+      --recursionDepth_;\n+    }\n+  }\n \n  private:\n   Context &context_;\n@@ -235,7 +255,11 @@ class ES6ClassesTransformations {\n   const ResolvedClassMember *_currentClassMember = nullptr;\n \n   ESTree::VisitResult doVisitChildren(ESTree::Node *node) {\n+    if (!incRecursionDepth(node)) {\n+      return ESTree::Unmodified;\n+    }\n     visitESTreeChildren(*this, node);\n+    decRecursionDepth();\n     return ESTree::Unmodified;\n   }\n \n", "result": true}