{"patch": "diff --git a/lib/AST/ES6Class.cpp b/lib/AST/ES6Class.cpp\nindex 42155e587..2bfa6f573 100644\n--- a/lib/AST/ES6Class.cpp\n+++ b/lib/AST/ES6Class.cpp\n@@ -140,6 +140,23 @@ class ES6ClassesTransformations {\n       : context_(context),\n         identVar_(context.getIdentifier(\"var\").getUnderlyingPointer()) {}\n \n+  static constexpr unsigned kMaxRecursionDepth = 512;\n+  unsigned recursionDepth_ = 0;\n+  bool recursionFailed_ = false;\n+\n+  bool incRecursionDepth(ESTree::Node *) {\n+    if (recursionFailed_) return false;\n+    if (++recursionDepth_ > kMaxRecursionDepth) {\n+      recursionFailed_ = true;\n+      return false;\n+    }\n+    return true;\n+  }\n+\n+  void decRecursionDepth() {\n+    if (!recursionFailed_ && recursionDepth_ > 0) --recursionDepth_;\n+  }\n+\n   ESTree::VisitResult visit(ESTree::ClassDeclarationNode *classDecl) {\n     auto *classBody = llvh::dyn_cast<ESTree::ClassBodyNode>(classDecl->_body);\n     if (classBody == nullptr) {\n@@ -222,11 +239,6 @@ class ES6ClassesTransformations {\n     visitESTreeChildren(*this, node);\n   }\n \n-  bool incRecursionDepth(ESTree::Node *) {\n-    return true;\n-  }\n-\n-  void decRecursionDepth() {}\n \n  private:\n   Context &context_;\n", "result": true}