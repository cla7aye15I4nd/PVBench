{"patch": "diff --git a/src/libjasper/heic/heic_dec.c b/src/libjasper/heic/heic_dec.c\nindex cde3843..bc108ea 100644\n--- a/src/libjasper/heic/heic_dec.c\n+++ b/src/libjasper/heic/heic_dec.c\n@@ -151,6 +151,7 @@ jas_image_t *jas_heic_decode(jas_stream_t *in, const char *optstr)\n \tstruct heif_image *img = 0;\n \tstruct heif_context* ctx = 0;\n \tjas_matrix_t *matrix = 0;\n+\tstruct heif_error err;\n \n \tJAS_LOGDEBUGF(10, \"jas_heic_decode(%p, \\\"%s\\\")\\n\", in, optstr);\n \n@@ -193,7 +194,11 @@ jas_image_t *jas_heic_decode(jas_stream_t *in, const char *optstr)\n \theif_context_read_from_memory_without_copy(ctx, ptr, size, 0);\n \n \t/* Get a handle to the primary image. */\n-\theif_context_get_primary_image_handle(ctx, &handle);\n+\terr = heif_context_get_primary_image_handle(ctx, &handle);\n+\tif (err.code != 0) {\n+\t\tjas_logerrorf(\"heif_context_get_primary_image_handle failed\\n\");\n+\t\tgoto error;\n+\t}\n \n \tint width = heif_image_handle_get_width(handle);\n \tint height = heif_image_handle_get_height(handle);\n@@ -218,7 +223,6 @@ jas_image_t *jas_heic_decode(jas_stream_t *in, const char *optstr)\n \n \t/* Decode the image and convert the colorspace to RGB,\n \t  saved as 24bit interleaved. */\n-\tstruct heif_error err;\n \terr = heif_decode_image(handle, &img, heif_colorspace_RGB,\n \t  heif_chroma_interleaved_RGB, 0);\n \tif (err.code != 0) {\n", "result": true}