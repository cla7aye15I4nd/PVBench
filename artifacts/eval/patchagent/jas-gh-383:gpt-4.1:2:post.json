{"patch": "diff --git a/src/libjasper/heic/heic_dec.c b/src/libjasper/heic/heic_dec.c\nindex cde3843..0fcd631 100644\n--- a/src/libjasper/heic/heic_dec.c\n+++ b/src/libjasper/heic/heic_dec.c\n@@ -193,11 +193,15 @@ jas_image_t *jas_heic_decode(jas_stream_t *in, const char *optstr)\n \theif_context_read_from_memory_without_copy(ctx, ptr, size, 0);\n \n \t/* Get a handle to the primary image. */\n-\theif_context_get_primary_image_handle(ctx, &handle);\n-\n-\tint width = heif_image_handle_get_width(handle);\n-\tint height = heif_image_handle_get_height(handle);\n-\tJAS_LOGDEBUGF(1, \"width %d; height %d\\n\", width, height);\n+    heif_context_get_primary_image_handle(ctx, &handle);\n+    if (!handle) {\n+        jas_logerrorf(\"heif_context_get_primary_image_handle failed or returned NULL handle\\n\");\n+        goto error;\n+    }\n+\n+    int width = heif_image_handle_get_width(handle);\n+    int height = heif_image_handle_get_height(handle);\n+    JAS_LOGDEBUGF(1, \"width %d; height %d\\n\", width, height);\n \n \tsize_t num_samples;\n \tif (!jas_safe_size_mul(width, height, &num_samples)) {\n", "result": true}