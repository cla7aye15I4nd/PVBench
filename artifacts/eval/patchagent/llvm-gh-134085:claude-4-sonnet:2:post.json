{"patch": "diff --git a/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp b/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\nindex 838e952c024c..048767e62006 100644\n--- a/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\n+++ b/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\n@@ -14699,11 +14699,15 @@ BoUpSLP::isGatherShuffledSingleRegisterEntry(\n   for (const std::pair<unsigned, int> &Pair : EntryLanes) {\n     unsigned Idx = Part * VL.size() + Pair.second;\n     Mask[Idx] =\n-        Pair.first * VF +\n+        Pair.first < Entries.size() ?\n+        (Pair.first * VF +\n+         (ForOrder ? std::distance(\n+                         Entries[Pair.first]->Scalars.begin(),\n+                         find(Entries[Pair.first]->Scalars, VL[Pair.second]))\n+                   : Entries[Pair.first]->findLaneForValue(VL[Pair.second]))) :\n         (ForOrder ? std::distance(\n-                        Entries[Pair.first]->Scalars.begin(),\n-                        find(Entries[Pair.first]->Scalars, VL[Pair.second]))\n-                  : Entries[Pair.first]->findLaneForValue(VL[Pair.second]));\n+                        Entries[0]->Scalars.begin(),\n+                        find(Entries[0]->Scalars, VL[Pair.second])) : 0);\n     IsIdentity &= Mask[Idx] == Pair.second;\n   }\n   if (ForOrder || IsIdentity || Entries.empty()) {\n", "result": true}