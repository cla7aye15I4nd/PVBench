{"patch": "diff --git a/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp b/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\nindex 838e952c024c..83a7e538d002 100644\n--- a/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\n+++ b/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\n@@ -14697,6 +14697,10 @@ BoUpSLP::isGatherShuffledSingleRegisterEntry(\n   // Pair.first is the offset to the vector, while Pair.second is the index of\n   // scalar in the list.\n   for (const std::pair<unsigned, int> &Pair : EntryLanes) {\n+    // Ensure Pair.first is within bounds of Entries vector\n+    if (Pair.first >= Entries.size()) {\n+      return std::nullopt;\n+    }\n     unsigned Idx = Part * VL.size() + Pair.second;\n     Mask[Idx] =\n         Pair.first * VF +\n", "result": true}