{"patch": "diff --git a/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp b/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\nindex 838e952c024c..e22aba76ae5e 100644\n--- a/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\n+++ b/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\n@@ -14698,6 +14698,10 @@ BoUpSLP::isGatherShuffledSingleRegisterEntry(\n   // scalar in the list.\n   for (const std::pair<unsigned, int> &Pair : EntryLanes) {\n     unsigned Idx = Part * VL.size() + Pair.second;\n+    if (Pair.first >= Entries.size()) {\n+      // Out-of-bounds, skip this entry to avoid undefined behavior.\n+      continue;\n+    }\n     Mask[Idx] =\n         Pair.first * VF +\n         (ForOrder ? std::distance(\n", "result": true}