{"patch": "diff --git a/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp b/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\nindex 838e952c024c..8363a0255678 100644\n--- a/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\n+++ b/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\n@@ -14698,6 +14698,12 @@ BoUpSLP::isGatherShuffledSingleRegisterEntry(\n   // scalar in the list.\n   for (const std::pair<unsigned, int> &Pair : EntryLanes) {\n     unsigned Idx = Part * VL.size() + Pair.second;\n+    if (Pair.first >= Entries.size()) {\n+      // Out-of-bounds, set to poison and continue.\n+      Mask[Idx] = PoisonMaskElem;\n+      IsIdentity = false;\n+      continue;\n+    }\n     Mask[Idx] =\n         Pair.first * VF +\n         (ForOrder ? std::distance(\n", "result": true}