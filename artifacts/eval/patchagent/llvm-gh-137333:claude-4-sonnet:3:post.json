{"patch": "diff --git a/mlir/lib/Dialect/MemRef/IR/MemRefOps.cpp b/mlir/lib/Dialect/MemRef/IR/MemRefOps.cpp\nindex cab0ab8d15d5..e731f3b2866b 100644\n--- a/mlir/lib/Dialect/MemRef/IR/MemRefOps.cpp\n+++ b/mlir/lib/Dialect/MemRef/IR/MemRefOps.cpp\n@@ -398,6 +398,9 @@ static bool isOpItselfPotentialAutomaticAllocation(Operation *op) {\n /// and is only followed by a terminator. This prevents\n /// extending the lifetime of allocations.\n static bool lastNonTerminatorInRegion(Operation *op) {\n+  Block *block = op->getBlock();\n+  if (!block->mightHaveTerminator())\n+    return false;\n   return op->getNextNode() == op->getBlock()->getTerminator() &&\n          llvm::hasSingleElement(op->getParentRegion()->getBlocks());\n }\n", "result": true}