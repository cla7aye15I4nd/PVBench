{"patch": "diff --git a/mlir/lib/Dialect/MemRef/IR/MemRefOps.cpp b/mlir/lib/Dialect/MemRef/IR/MemRefOps.cpp\nindex cab0ab8d15d5..d863920c66c6 100644\n--- a/mlir/lib/Dialect/MemRef/IR/MemRefOps.cpp\n+++ b/mlir/lib/Dialect/MemRef/IR/MemRefOps.cpp\n@@ -398,7 +398,11 @@ static bool isOpItselfPotentialAutomaticAllocation(Operation *op) {\n /// and is only followed by a terminator. This prevents\n /// extending the lifetime of allocations.\n static bool lastNonTerminatorInRegion(Operation *op) {\n-  return op->getNextNode() == op->getBlock()->getTerminator() &&\n+  Block *block = op->getBlock();\n+  // Ensure the block has a terminator before accessing it.\n+  if (!block || !block->mightHaveTerminator())\n+    return false;\n+  return op->getNextNode() == block->getTerminator() &&\n          llvm::hasSingleElement(op->getParentRegion()->getBlocks());\n }\n \n", "result": true}