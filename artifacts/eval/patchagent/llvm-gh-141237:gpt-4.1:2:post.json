{"patch": "diff --git a/llvm/lib/Transforms/Vectorize/LoopVectorize.cpp b/llvm/lib/Transforms/Vectorize/LoopVectorize.cpp\nindex 275b3d567856..74ca3edc27cf 100644\n--- a/llvm/lib/Transforms/Vectorize/LoopVectorize.cpp\n+++ b/llvm/lib/Transforms/Vectorize/LoopVectorize.cpp\n@@ -7472,15 +7472,18 @@ VectorizationFactor LoopVectorizationPlanner::computeBestVF() {\n   VPCostContext CostCtx(CM.TTI, *CM.TLI, Legal->getWidestInductionType(), CM,\n                         CM.CostKind);\n   precomputeCosts(BestPlan, BestFactor.Width, CostCtx);\n-  // Verify that the VPlan-based and legacy cost models agree, except for VPlans\n-  // with early exits and plans with additional VPlan simplifications. The\n-  // legacy cost model doesn't properly model costs for such loops.\n-  assert((BestFactor.Width == LegacyVF.Width || BestPlan.hasEarlyExit() ||\n+    // Verify that the VPlan-based and legacy cost models agree, except for VPlans\n+    // with early exits and plans with additional VPlan simplifications. The\n+    // legacy cost model doesn't properly model costs for such loops.\n+    if (!(BestFactor.Width == LegacyVF.Width || BestPlan.hasEarlyExit() ||\n           planContainsAdditionalSimplifications(getPlanFor(BestFactor.Width),\n-                                                CostCtx, OrigLoop) ||\n+                                               CostCtx, OrigLoop) ||\n           planContainsAdditionalSimplifications(getPlanFor(LegacyVF.Width),\n-                                                CostCtx, OrigLoop)) &&\n-         \" VPlan cost model and legacy cost model disagreed\");\n+                                               CostCtx, OrigLoop))) {\n+      LLVM_DEBUG(dbgs() << \"WARNING: VPlan cost model and legacy cost model disagreed\\n\");\n+      errs() << \"WARNING: VPlan cost model and legacy cost model disagreed\\n\";\n+      // Continue execution, do not assert or abort.\n+    }\n   assert((BestFactor.Width.isScalar() || BestFactor.ScalarCost > 0) &&\n          \"when vectorizing, the scalar cost must be computed.\");\n #endif\n", "result": true}