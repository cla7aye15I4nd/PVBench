{"patch": "diff --git a/ext/pdo_sqlite/sqlite_driver.c b/ext/pdo_sqlite/sqlite_driver.c\nindex 2f494c2ddb8..074678215d6 100644\n--- a/ext/pdo_sqlite/sqlite_driver.c\n+++ b/ext/pdo_sqlite/sqlite_driver.c\n@@ -442,9 +442,15 @@ static int do_callback(struct pdo_sqlite_fci *fc, zval *cb,\n \t\tif (agg_context) {\n \t\t\tif (Z_ISUNDEF(retval)) {\n \t\t\t\tzval_ptr_dtor(&agg_context->val);\n+\t\t\t\tZVAL_UNDEF(&agg_context->val);\n \t\t\t\treturn FAILURE;\n \t\t\t}\n \t\t\tzval_ptr_dtor(Z_REFVAL(agg_context->val));\n+\t\t\tZVAL_UNDEF(Z_REFVAL(agg_context->val));\n+\t\t\t/* If the reference was destroyed, reinitialize it */\n+\t\t\tif (Z_ISUNDEF(agg_context->val)) {\n+\t\t\t\tZVAL_NEW_REF(&agg_context->val, &EG(uninitialized_zval));\n+\t\t\t}\n \t\t\tZVAL_COPY_VALUE(Z_REFVAL(agg_context->val), &retval);\n \t\t\tZVAL_UNDEF(&retval);\n \t\t}\n", "result": true}