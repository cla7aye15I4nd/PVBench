{"patch": "diff --git a/ext/standard/url_scanner_ex.re b/ext/standard/url_scanner_ex.re\nindex 77b4d79793b..23bb2cf2f5b 100644\n--- a/ext/standard/url_scanner_ex.re\n+++ b/ext/standard/url_scanner_ex.re\n@@ -691,30 +691,30 @@ static inline void php_url_scanner_session_handler_impl(char *output, size_t out\n \t\turl_state = &BG(url_adapt_output_ex);\n \t}\n \n-\tif (ZSTR_LEN(url_state->url_app.s) != 0) {\n-\t\t*handled_output = url_adapt_ext(output, output_len, &len, (bool) (mode & (PHP_OUTPUT_HANDLER_END | PHP_OUTPUT_HANDLER_CONT | PHP_OUTPUT_HANDLER_FLUSH | PHP_OUTPUT_HANDLER_FINAL) ? 1 : 0), url_state);\n-\t\tif (sizeof(unsigned int) < sizeof(size_t)) {\n-\t\t\tif (len > UINT_MAX)\n-\t\t\t\tlen = UINT_MAX;\n-\t\t}\n-\t\t*handled_output_len = len;\n-\t} else if (ZSTR_LEN(url_state->url_app.s) == 0) {\n-\t\turl_adapt_state_ex_t *ctx = url_state;\n-\t\tif (ctx->buf.s && ZSTR_LEN(ctx->buf.s)) {\n-\t\t\tsmart_str_append(&ctx->result, ctx->buf.s);\n-\t\t\tsmart_str_appendl(&ctx->result, output, output_len);\n-\n-\t\t\t*handled_output = estrndup(ZSTR_VAL(ctx->result.s), ZSTR_LEN(ctx->result.s));\n-\t\t\t*handled_output_len = ZSTR_LEN(ctx->buf.s) + output_len;\n-\n-\t\t\tsmart_str_free(&ctx->buf);\n-\t\t\tsmart_str_free(&ctx->result);\n-\t\t} else {\n-\t\t\t*handled_output = estrndup(output, *handled_output_len = output_len);\n-\t\t}\n-\t} else {\n-\t\t*handled_output = NULL;\n-\t}\n+       if (url_state->url_app.s && ZSTR_LEN(url_state->url_app.s) != 0) {\n+               *handled_output = url_adapt_ext(output, output_len, &len, (bool) (mode & (PHP_OUTPUT_HANDLER_END | PHP_OUTPUT_HANDLER_CONT | PHP_OUTPUT_HANDLER_FLUSH | PHP_OUTPUT_HANDLER_FINAL) ? 1 : 0), url_state);\n+               if (sizeof(unsigned int) < sizeof(size_t)) {\n+                       if (len > UINT_MAX)\n+                               len = UINT_MAX;\n+               }\n+               *handled_output_len = len;\n+       } else if (url_state->url_app.s && ZSTR_LEN(url_state->url_app.s) == 0) {\n+               url_adapt_state_ex_t *ctx = url_state;\n+               if (ctx->buf.s && ZSTR_LEN(ctx->buf.s)) {\n+                       smart_str_append(&ctx->result, ctx->buf.s);\n+                       smart_str_appendl(&ctx->result, output, output_len);\n+\n+                       *handled_output = estrndup(ZSTR_VAL(ctx->result.s), ZSTR_LEN(ctx->result.s));\n+                       *handled_output_len = ZSTR_LEN(ctx->buf.s) + output_len;\n+\n+                       smart_str_free(&ctx->buf);\n+                       smart_str_free(&ctx->result);\n+               } else {\n+                       *handled_output = estrndup(output, *handled_output_len = output_len);\n+               }\n+       } else {\n+               *handled_output = NULL;\n+       }\n }\n \n static void php_url_scanner_session_handler(char *output, size_t output_len, char **handled_output, size_t *handled_output_len, int mode)\n", "result": true}