{"patch": "diff --git a/ext/dom/dom_iterators.c b/ext/dom/dom_iterators.c\nindex 866cb5a07e9..75d3a507a8f 100644\n--- a/ext/dom/dom_iterators.c\n+++ b/ext/dom/dom_iterators.c\n@@ -186,10 +186,25 @@ static void php_dom_iterator_move_forward(zend_object_iterator *iter) /* {{{ */\n \tphp_dom_iterator *iterator = (php_dom_iterator *)iter;\n \n \tobject = &iterator->intern.data;\n+\tif (object == NULL || Z_TYPE_P(object) != IS_OBJECT) {\n+\t\tgoto err;\n+\t}\n \tnnmap = Z_DOMOBJ_P(object);\n+\tif (nnmap == NULL || nnmap->ptr == NULL) {\n+\t\tgoto err;\n+\t}\n \tobjmap = (dom_nnodemap_object *)nnmap->ptr;\n \n-\tintern = Z_DOMOBJ_P(&iterator->curobj);\n+\tif (Z_TYPE_P(&iterator->curobj) == IS_OBJECT) {\n+\t\tintern = Z_DOMOBJ_P(&iterator->curobj);\n+\t} else {\n+\t\tintern = NULL;\n+\t}\n+\n+\t/* Validate objmap before using it */\n+\tif (objmap == NULL) {\n+\t\tgoto err;\n+\t}\n \n \tif (intern != NULL && intern->ptr != NULL) {\n \t\tif (objmap->nodetype != XML_ENTITY_NODE &&\n@@ -237,7 +252,7 @@ static void php_dom_iterator_move_forward(zend_object_iterator *iter) /* {{{ */\n \t\tZVAL_UNDEF(&iterator->curobj);\n \t}\n \tif (curnode) {\n-\t\tphp_dom_create_object(curnode, &iterator->curobj, objmap->baseobj);\n+\t\tphp_dom_create_object(curnode, &iterator->curobj, objmap ? objmap->baseobj : NULL);\n \t}\n }\n /* }}} */\n", "result": true}