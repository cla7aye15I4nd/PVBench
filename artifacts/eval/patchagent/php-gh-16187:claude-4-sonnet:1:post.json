{"patch": "diff --git a/ext/reflection/php_reflection.c b/ext/reflection/php_reflection.c\nindex f24b00a2857..eac507eea18 100644\n--- a/ext/reflection/php_reflection.c\n+++ b/ext/reflection/php_reflection.c\n@@ -477,14 +477,26 @@ static void _class_string(smart_str *str, zend_class_entry *ce, zval *obj, char\n \n \t\tcount = 0;\n \t\tif (properties && zend_hash_num_elements(properties)) {\n-\t\t\tZEND_HASH_MAP_FOREACH_STR_KEY(properties, prop_name) {\n-\t\t\t\tif (prop_name && ZSTR_LEN(prop_name) && ZSTR_VAL(prop_name)[0]) { /* skip all private and protected properties */\n-\t\t\t\t\tif (!zend_hash_exists(&ce->properties_info, prop_name)) {\n-\t\t\t\t\t\tcount++;\n-\t\t\t\t\t\t_property_string(&prop_str, NULL, ZSTR_VAL(prop_name), ZSTR_VAL(sub_indent));\n+\t\t\t/* Use safer iteration method to avoid corrupted pointer access */\n+\t\t\tHashPosition pos;\n+\t\t\tzend_ulong num_index;\n+\t\t\tzend_hash_internal_pointer_reset_ex(properties, &pos);\n+\t\t\twhile (zend_hash_has_more_elements_ex(properties, &pos) == SUCCESS) {\n+\t\t\t\tint key_type = zend_hash_get_current_key_ex(properties, &prop_name, &num_index, &pos);\n+\t\t\t\tif (key_type == HASH_KEY_IS_STRING && prop_name) {\n+\t\t\t\t\t/* Additional validation of string before use */\n+\t\t\t\t\tif (ZSTR_LEN(prop_name) > 0 && ZSTR_LEN(prop_name) < 65535 && \n+\t\t\t\t\t    ZSTR_VAL(prop_name) && ZSTR_VAL(prop_name)[0]) { /* skip all private and protected properties */\n+\t\t\t\t\t\tif (!zend_hash_exists(&ce->properties_info, prop_name)) {\n+\t\t\t\t\t\t\tcount++;\n+\t\t\t\t\t\t\t_property_string(&prop_str, NULL, ZSTR_VAL(prop_name), ZSTR_VAL(sub_indent));\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\tif (zend_hash_move_forward_ex(properties, &pos) == FAILURE) {\n+\t\t\t\t\tbreak;\n \t\t\t\t\t}\n \t\t\t\t}\n-\t\t\t} ZEND_HASH_FOREACH_END();\n \t\t}\n \n \t\tsmart_str_append_printf(str, \"\\n%s  - Dynamic properties [%d] {\\n\", indent, count);\n", "result": true}