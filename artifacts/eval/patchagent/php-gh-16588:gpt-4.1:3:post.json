{"patch": "diff --git a/ext/spl/spl_observer.c b/ext/spl/spl_observer.c\nindex cc2956ccc27..acafeec76a8 100644\n--- a/ext/spl/spl_observer.c\n+++ b/ext/spl/spl_observer.c\n@@ -791,17 +791,20 @@ PHP_METHOD(SplObjectStorage, serialize)\n \n \twhile (zend_hash_has_more_elements_ex(&intern->storage, &pos) == SUCCESS) {\n \t\tzval obj;\n-\t\tif ((element = zend_hash_get_current_data_ptr_ex(&intern->storage, &pos)) == NULL) {\n-\t\t\tsmart_str_free(&buf);\n-\t\t\tPHP_VAR_SERIALIZE_DESTROY(var_hash);\n-\t\t\tRETURN_NULL();\n-\t\t}\n-\t\tZVAL_OBJ(&obj, element->obj);\n-\t\tphp_var_serialize(&buf, &obj, &var_hash);\n-\t\tsmart_str_appendc(&buf, ',');\n-\t\tphp_var_serialize(&buf, &element->inf, &var_hash);\n-\t\tsmart_str_appendc(&buf, ';');\n-\t\tzend_hash_move_forward_ex(&intern->storage, &pos);\n+        if ((element = zend_hash_get_current_data_ptr_ex(&intern->storage, &pos)) == NULL) {\n+            smart_str_free(&buf);\n+            PHP_VAR_SERIALIZE_DESTROY(var_hash);\n+            RETURN_NULL();\n+        }\n+        ZVAL_OBJ(&obj, element->obj);\n+        zval inf_copy;\n+        ZVAL_COPY(&inf_copy, &element->inf);\n+        php_var_serialize(&buf, &obj, &var_hash);\n+        smart_str_appendc(&buf, ',');\n+        php_var_serialize(&buf, &inf_copy, &var_hash);\n+        zval_ptr_dtor(&inf_copy);\n+        smart_str_appendc(&buf, ';');\n+        zend_hash_move_forward_ex(&intern->storage, &pos);\n \t}\n \n \t/* members */\n", "result": true}