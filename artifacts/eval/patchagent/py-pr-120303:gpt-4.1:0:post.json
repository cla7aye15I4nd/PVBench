{"patch": "diff --git a/Objects/listobject.c b/Objects/listobject.c\nindex d09bb639103..589d428206b 100644\n--- a/Objects/listobject.c\n+++ b/Objects/listobject.c\n@@ -3332,11 +3332,18 @@ list_traverse(PyObject *self, visitproc visit, void *arg)\n static PyObject *\n list_richcompare_impl(PyObject *v, PyObject *w, int op)\n {\n+    PyObject *result = NULL;\n     PyListObject *vl, *wl;\n     Py_ssize_t i;\n \n-    if (!PyList_Check(v) || !PyList_Check(w))\n-        Py_RETURN_NOTIMPLEMENTED;\n+    Py_INCREF(v);\n+    Py_INCREF(w);\n+\n+    if (!PyList_Check(v) || !PyList_Check(w)) {\n+        result = Py_NotImplemented;\n+        Py_INCREF(result);\n+        goto done;\n+    }\n \n     vl = (PyListObject *)v;\n     wl = (PyListObject *)w;\n@@ -3344,9 +3351,11 @@ list_richcompare_impl(PyObject *v, PyObject *w, int op)\n     if (Py_SIZE(vl) != Py_SIZE(wl) && (op == Py_EQ || op == Py_NE)) {\n         /* Shortcut: if the lengths differ, the lists differ */\n         if (op == Py_EQ)\n-            Py_RETURN_FALSE;\n+            result = Py_False;\n         else\n-            Py_RETURN_TRUE;\n+            result = Py_True;\n+        Py_INCREF(result);\n+        goto done;\n     }\n \n     /* Search for the first index where items are different */\n@@ -3362,27 +3371,56 @@ list_richcompare_impl(PyObject *v, PyObject *w, int op)\n         int k = PyObject_RichCompareBool(vitem, witem, Py_EQ);\n         Py_DECREF(vitem);\n         Py_DECREF(witem);\n-        if (k < 0)\n-            return NULL;\n+        if (k < 0) {\n+            result = NULL;\n+            goto done;\n+        }\n         if (!k)\n             break;\n     }\n \n     if (i >= Py_SIZE(vl) || i >= Py_SIZE(wl)) {\n         /* No more items to compare -- compare sizes */\n-        Py_RETURN_RICHCOMPARE(Py_SIZE(vl), Py_SIZE(wl), op);\n+        switch (op) {\n+            case Py_EQ: result = (Py_SIZE(vl) == Py_SIZE(wl)) ? Py_True : Py_False; break;\n+            case Py_NE: result = (Py_SIZE(vl) != Py_SIZE(wl)) ? Py_True : Py_False; break;\n+            case Py_LT: result = (Py_SIZE(vl) <  Py_SIZE(wl)) ? Py_True : Py_False; break;\n+            case Py_GT: result = (Py_SIZE(vl) >  Py_SIZE(wl)) ? Py_True : Py_False; break;\n+            case Py_LE: result = (Py_SIZE(vl) <= Py_SIZE(wl)) ? Py_True : Py_False; break;\n+            case Py_GE: result = (Py_SIZE(vl) >= Py_SIZE(wl)) ? Py_True : Py_False; break;\n+            default: Py_UNREACHABLE();\n+        }\n+        Py_INCREF(result);\n+        goto done;\n     }\n \n     /* We have an item that differs -- shortcuts for EQ/NE */\n     if (op == Py_EQ) {\n-        Py_RETURN_FALSE;\n+        result = Py_False;\n+        Py_INCREF(result);\n+        goto done;\n     }\n     if (op == Py_NE) {\n-        Py_RETURN_TRUE;\n+        result = Py_True;\n+        Py_INCREF(result);\n+        goto done;\n     }\n \n     /* Compare the final item again using the proper operator */\n-    return PyObject_RichCompare(vl->ob_item[i], wl->ob_item[i], op);\n+    {\n+        PyObject *vitem = vl->ob_item[i];\n+        PyObject *witem = wl->ob_item[i];\n+        Py_INCREF(vitem);\n+        Py_INCREF(witem);\n+        result = PyObject_RichCompare(vitem, witem, op);\n+        Py_DECREF(vitem);\n+        Py_DECREF(witem);\n+    }\n+\n+done:\n+    Py_DECREF(v);\n+    Py_DECREF(w);\n+    return result;\n }\n \n static PyObject *\n", "result": true}