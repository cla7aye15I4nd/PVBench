{"patch": "diff --git a/src/ex_docmd.c b/src/ex_docmd.c\nindex 26acc07e0..9ac9b7bde 100644\n--- a/src/ex_docmd.c\n+++ b/src/ex_docmd.c\n@@ -3446,7 +3446,11 @@ append_command(char_u *cmd)\n \telse\n \t    MB_COPY_CHAR(s, d);\n     }\n-    *d = NUL;\n+    // Ensure we don't write beyond the buffer boundary\n+    if (d - IObuff < IOSIZE - 1)\n+\t*d = NUL;\n+    else\n+\tIObuff[IOSIZE - 1] = NUL;\n }\n \n #if defined(FEAT_EVAL) || defined(PROTO)\n", "result": true}