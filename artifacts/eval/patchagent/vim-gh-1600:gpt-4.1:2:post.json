{"patch": "diff --git a/src/edit.c b/src/edit.c\nindex cdde11e40..13a371d76 100644\n--- a/src/edit.c\n+++ b/src/edit.c\n@@ -4948,15 +4948,27 @@ ins_compl_next(\n      */\n     if (compl_shown_match->cp_fname != NULL)\n     {\n-\tSTRCPY(IObuff, \"match in file \");\n-\ti = (vim_strsize(compl_shown_match->cp_fname) + 16) - sc_col;\n-\tif (i <= 0)\n-\t    i = 0;\n-\telse\n-\t    STRCAT(IObuff, \"<\");\n-\tSTRCAT(IObuff, compl_shown_match->cp_fname + i);\n-\tmsg(IObuff);\n-\tredraw_cmdline = FALSE;\t    /* don't overwrite! */\n+        int off = 0;\n+        int maxlen = IOSIZE - 1;\n+        off = vim_snprintf((char *)IObuff, IOSIZE, \"match in file \");\n+        i = (vim_strsize(compl_shown_match->cp_fname) + 16) - sc_col;\n+        if (i <= 0)\n+            i = 0;\n+        else if (off < maxlen) {\n+            IObuff[off] = '<';\n+            off++;\n+            IObuff[off] = '\\0';\n+        }\n+        /* Copy as much of the file name as fits */\n+        if (off < maxlen) {\n+            int fnamelen = (int)STRLEN(compl_shown_match->cp_fname + i);\n+            if (fnamelen > maxlen - off)\n+                fnamelen = maxlen - off;\n+            STRNCPY(IObuff + off, compl_shown_match->cp_fname + i, fnamelen);\n+            IObuff[off + fnamelen] = '\\0';\n+        }\n+        msg(IObuff);\n+        redraw_cmdline = FALSE;        /* don't overwrite! */\n     }\n \n     return num_matches;\n", "result": true}