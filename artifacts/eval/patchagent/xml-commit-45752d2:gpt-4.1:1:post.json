{"patch": "diff --git a/parser.c b/parser.c\nindex 4464e2e8..58e60049 100644\n--- a/parser.c\n+++ b/parser.c\n@@ -3472,7 +3472,9 @@ xmlParseNCNameComplex(xmlParserCtxtPtr ctxt) {\n     int len = 0, l;\n     int c;\n     int count = 0;\n-    const xmlChar *end; /* needed because CUR_CHAR() can move cur on \\r\\n */\n+    const xmlChar *base;\n+    int startOffset;\n+    const xmlChar *end;\n \n #ifdef DEBUG\n     nbParseNCNameComplex++;\n@@ -3482,6 +3484,8 @@ xmlParseNCNameComplex(xmlParserCtxtPtr ctxt) {\n      * Handler for more complex cases\n      */\n     GROW;\n+    base = ctxt->input->base;\n+    startOffset = ctxt->input->cur - base;\n     end = ctxt->input->cur;\n     c = CUR_CHAR(l);\n     if ((c == ' ') || (c == '>') || (c == '/') || /* accelerators */\n@@ -3527,7 +3531,11 @@ xmlParseNCNameComplex(xmlParserCtxtPtr ctxt) {\n         xmlFatalErr(ctxt, XML_ERR_NAME_TOO_LONG, \"NCName\");\n         return(NULL);\n     }\n-    return(xmlDictLookup(ctxt->dict, end - len, len));\n+    /* Always recalculate the start pointer after growth/shrink */\n+    base = ctxt->input->base;\n+    /* Clamp startOffset to buffer if necessary */\n+    if (startOffset < 0) startOffset = 0;\n+    return(xmlDictLookup(ctxt->dict, base + startOffset, len));\n }\n \n /**\n", "result": true}