{"patch": "diff --git a/parser.c b/parser.c\nindex 4464e2e8..4cac05d0 100644\n--- a/parser.c\n+++ b/parser.c\n@@ -3472,7 +3472,6 @@ xmlParseNCNameComplex(xmlParserCtxtPtr ctxt) {\n     int len = 0, l;\n     int c;\n     int count = 0;\n-    const xmlChar *end; /* needed because CUR_CHAR() can move cur on \\r\\n */\n \n #ifdef DEBUG\n     nbParseNCNameComplex++;\n@@ -3482,7 +3481,6 @@ xmlParseNCNameComplex(xmlParserCtxtPtr ctxt) {\n      * Handler for more complex cases\n      */\n     GROW;\n-    end = ctxt->input->cur;\n     c = CUR_CHAR(l);\n     if ((c == ' ') || (c == '>') || (c == '/') || /* accelerators */\n \t(!xmlIsNameStartChar(ctxt, c) || (c == ':'))) {\n@@ -3504,7 +3502,6 @@ xmlParseNCNameComplex(xmlParserCtxtPtr ctxt) {\n \t}\n \tlen += l;\n \tNEXTL(l);\n-\tend = ctxt->input->cur;\n \tc = CUR_CHAR(l);\n \tif (c == 0) {\n \t    count = 0;\n@@ -3518,7 +3515,6 @@ xmlParseNCNameComplex(xmlParserCtxtPtr ctxt) {\n \t    ctxt->input->cur += l;\n             if (ctxt->instate == XML_PARSER_EOF)\n                 return(NULL);\n-\t    end = ctxt->input->cur;\n \t    c = CUR_CHAR(l);\n \t}\n     }\n@@ -3527,7 +3523,9 @@ xmlParseNCNameComplex(xmlParserCtxtPtr ctxt) {\n         xmlFatalErr(ctxt, XML_ERR_NAME_TOO_LONG, \"NCName\");\n         return(NULL);\n     }\n-    return(xmlDictLookup(ctxt->dict, end - len, len));\n+    if ((*ctxt->input->cur == '\\n') && (ctxt->input->cur[-1] == '\\r'))\n+        return(xmlDictLookup(ctxt->dict, ctxt->input->cur - (len + 1), len));\n+    return(xmlDictLookup(ctxt->dict, ctxt->input->cur - len, len));\n }\n \n /**\n", "result": true}