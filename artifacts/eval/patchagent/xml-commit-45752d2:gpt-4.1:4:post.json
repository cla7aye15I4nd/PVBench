{"patch": "diff --git a/parser.c b/parser.c\nindex 4464e2e8..9b4be099 100644\n--- a/parser.c\n+++ b/parser.c\n@@ -3473,6 +3473,7 @@ xmlParseNCNameComplex(xmlParserCtxtPtr ctxt) {\n     int c;\n     int count = 0;\n     const xmlChar *end; /* needed because CUR_CHAR() can move cur on \\r\\n */\n+    int start_offset = ctxt->input->cur - ctxt->input->base;\n \n #ifdef DEBUG\n     nbParseNCNameComplex++;\n@@ -3527,7 +3528,8 @@ xmlParseNCNameComplex(xmlParserCtxtPtr ctxt) {\n         xmlFatalErr(ctxt, XML_ERR_NAME_TOO_LONG, \"NCName\");\n         return(NULL);\n     }\n-    return(xmlDictLookup(ctxt->dict, end - len, len));\n+    /* Use offset to avoid UAF if buffer is reallocated */\n+    return(xmlDictLookup(ctxt->dict, ctxt->input->base + start_offset, len));\n }\n \n /**\n", "result": true}