{"patch": "diff --git a/xpath.c b/xpath.c\nindex a60a6237..67dc77a8 100644\n--- a/xpath.c\n+++ b/xpath.c\n@@ -3106,27 +3106,27 @@ xmlXPathFormatNumber(double number, char buffer[], int buffersize)\n \t\tsnprintf(buffer, buffersize, \"NaN\");\n \t} else if (number == 0 && xmlXPathGetSign(number) != 0) {\n \t    snprintf(buffer, buffersize, \"0\");\n-\t} else if (number == ((int) number)) {\n-\t    char work[30];\n-\t    char *ptr, *cur;\n-\t    int value = (int) number;\n-\n-            ptr = &buffer[0];\n-\t    if (value == 0) {\n-\t\t*ptr++ = '0';\n-\t    } else {\n-\t\tsnprintf(work, 29, \"%d\", value);\n-\t\tcur = &work[0];\n-\t\twhile ((*cur) && (ptr - buffer < buffersize)) {\n-\t\t    *ptr++ = *cur++;\n-\t\t}\n-\t    }\n-\t    if (ptr - buffer < buffersize) {\n-\t\t*ptr = 0;\n-\t    } else if (buffersize > 0) {\n-\t\tptr--;\n-\t\t*ptr = 0;\n-\t    }\n+    } else if (number >= (double)INT_MIN && number <= (double)INT_MAX && number == (int)number) {\n+        char work[30];\n+        char *ptr, *cur;\n+        int value = (int) number;\n+\n+        ptr = &buffer[0];\n+        if (value == 0) {\n+            *ptr++ = '0';\n+        } else {\n+            snprintf(work, 29, \"%d\", value);\n+            cur = &work[0];\n+            while ((*cur) && (ptr - buffer < buffersize)) {\n+                *ptr++ = *cur++;\n+            }\n+        }\n+        if (ptr - buffer < buffersize) {\n+            *ptr = 0;\n+        } else if (buffersize > 0) {\n+            ptr--;\n+            *ptr = 0;\n+        }\n \t} else {\n \t    /*\n \t      For the dimension of work,\n", "result": true}