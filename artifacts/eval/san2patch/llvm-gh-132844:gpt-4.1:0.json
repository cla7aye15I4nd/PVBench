[{"patch": "diff --git a/llvm/lib/CodeGen/SelectionDAG/LegalizeDAG.cpp b/llvm/lib/CodeGen/SelectionDAG/LegalizeDAG.cpp\nindex 1cacab9528ca..5c5e83cbba9f 100644\n--- a/llvm/lib/CodeGen/SelectionDAG/LegalizeDAG.cpp\n+++ b/llvm/lib/CodeGen/SelectionDAG/LegalizeDAG.cpp\n@@ -956,28 +956,27 @@ void SelectionDAGLegalize::LegalizeOp(SDNode *Node) {\n \n   // Allow illegal target nodes and illegal registers.\n   if (Node->getOpcode() == ISD::TargetConstant ||\n-      Node->getOpcode() == ISD::Register)\n+  Node->getOpcode() == ISD::Register)\n     return;\n \n #ifndef NDEBUG\n   for (unsigned i = 0, e = Node->getNumValues(); i != e; ++i)\n-    assert(TLI.getTypeAction(*DAG.getContext(), Node->getValueType(i)) ==\n-             TargetLowering::TypeLegal &&\n-           \"Unexpected illegal type!\");\n-\n+    if (TLI.getTypeAction(*DAG.getContext(), Node->getValueType(i)) != TargetLowering::TypeLegal) {\n+      report_fatal_error(\"Unexpected illegal type in Node value!\", false);\n+    }\n+// FIXME: Crash CWE-754: Improper Check for Unusual or Exceptional Conditions\n   for (const SDValue &Op : Node->op_values())\n-    assert((TLI.getTypeAction(*DAG.getContext(), Op.getValueType()) ==\n-              TargetLowering::TypeLegal ||\n-            Op.getOpcode() == ISD::TargetConstant ||\n-            Op.getOpcode() == ISD::Register) &&\n-            \"Unexpected illegal type!\");\n+    if (!(TLI.getTypeAction(*DAG.getContext(), Op.getValueType()) == TargetLowering::TypeLegal ||\n+          Op.getOpcode() == ISD::TargetConstant ||\n+          Op.getOpcode() == ISD::Register)) {\n+      report_fatal_error(\"Unexpected illegal type in Op value!\", false);\n+    }\n #endif\n \n   // Figure out the correct action; the way to query this varies by opcode\n   TargetLowering::LegalizeAction Action = TargetLowering::Legal;\n   bool SimpleFinishLegalizing = true;\n-  switch (Node->getOpcode()) {\n-  case ISD::INTRINSIC_W_CHAIN:\n+  switch (Node->getOpcode()) {  case ISD::INTRINSIC_W_CHAIN:\n   case ISD::INTRINSIC_WO_CHAIN:\n   case ISD::INTRINSIC_VOID:\n   case ISD::STACKSAVE:\n"}]