{"patch": "diff --git a/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp b/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\nindex 838e952c024c..58d66883c10a 100644\n--- a/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\n+++ b/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\n@@ -14698,11 +14698,14 @@ BoUpSLP::isGatherShuffledSingleRegisterEntry(\n   // scalar in the list.\n   for (const std::pair<unsigned, int> &Pair : EntryLanes) {\n     unsigned Idx = Part * VL.size() + Pair.second;\n+    if (Pair.first >= Entries.size())\n+      continue;\n+    auto It = find(Entries[Pair.first]->Scalars, VL[Pair.second]);\n+    if (It == Entries[Pair.first]->Scalars.end())\n+      continue;\n     Mask[Idx] =\n         Pair.first * VF +\n-        (ForOrder ? std::distance(\n-                        Entries[Pair.first]->Scalars.begin(),\n-                        find(Entries[Pair.first]->Scalars, VL[Pair.second]))\n+        (ForOrder ? std::distance(Entries[Pair.first]->Scalars.begin(), It)\n                   : Entries[Pair.first]->findLaneForValue(VL[Pair.second]));\n     IsIdentity &= Mask[Idx] == Pair.second;\n   }\n@@ -14738,7 +14741,8 @@ BoUpSLP::isGatherShuffledSingleRegisterEntry(\n            \"Expected at least single element.\");\n     unsigned NewVF = std::max<unsigned>(\n         VL.size(), getFullVectorNumberOfElements(*TTI, VL.front()->getType(),\n-                                                 (MaxElement % VF) -\n+// FIXME: Crash CWE-125: Out-of-bounds Read\n+                                                  (MaxElement % VF) -\n                                                      (MinElement % VF) + 1));\n     if (NewVF < VF) {\n       for_each(SubMask, [&](int &Idx) {\n", "result": true}