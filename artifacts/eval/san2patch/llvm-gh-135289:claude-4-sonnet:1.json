[{"patch": "diff --git a/mlir/lib/Dialect/Arith/IR/ArithOps.cpp b/mlir/lib/Dialect/Arith/IR/ArithOps.cpp\nindex e9545c3146b2..39c5ef84f7d2 100644\n--- a/mlir/lib/Dialect/Arith/IR/ArithOps.cpp\n+++ b/mlir/lib/Dialect/Arith/IR/ArithOps.cpp\n@@ -46,6 +46,25 @@ applyToIntegerAttrs(PatternRewriter &builder, Value res, Attribute lhs,\n   APInt lhsVal = llvm::cast<IntegerAttr>(lhs).getValue();\n   APInt rhsVal = llvm::cast<IntegerAttr>(rhs).getValue();\n   APInt value = binFn(lhsVal, rhsVal);\n+  \n+  // Extract expected bit width from result type to fix CWE-681\n+  auto intType = llvm::dyn_cast<IntegerType>(res.getType());\n+  if (!intType) {\n+    // Fallback to original behavior if type casting fails\n+    return IntegerAttr::get(res.getType(), value);\n+  }\n+  \n+  unsigned targetWidth = intType.getWidth();\n+  \n+  // Adjust bit width if there's a mismatch to prevent incorrect conversion\n+  if (value.getBitWidth() != targetWidth) {\n+    if (value.getBitWidth() > targetWidth) {\n+      value = value.trunc(targetWidth);\n+    } else {\n+      value = value.sext(targetWidth);\n+    }\n+  }\n+  \n   return IntegerAttr::get(res.getType(), value);\n }\n \n"}]