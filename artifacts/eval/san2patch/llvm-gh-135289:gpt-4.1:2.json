[{"patch": "diff --git a/mlir/lib/Dialect/Arith/IR/ArithOps.cpp b/mlir/lib/Dialect/Arith/IR/ArithOps.cpp\nindex e9545c3146b2..f37710b38631 100644\n--- a/mlir/lib/Dialect/Arith/IR/ArithOps.cpp\n+++ b/mlir/lib/Dialect/Arith/IR/ArithOps.cpp\n@@ -44,8 +44,16 @@ applyToIntegerAttrs(PatternRewriter &builder, Value res, Attribute lhs,\n                     Attribute rhs,\n                     function_ref<APInt(const APInt &, const APInt &)> binFn) {\n   APInt lhsVal = llvm::cast<IntegerAttr>(lhs).getValue();\n+// FIXME: Crash CWE-681: Incorrect Conversion between Numeric Types\n   APInt rhsVal = llvm::cast<IntegerAttr>(rhs).getValue();\n   APInt value = binFn(lhsVal, rhsVal);\n+  // Patch: Always truncate or extend to the target type's bitwidth\n+  auto intType = llvm::dyn_cast<IntegerType>(res.getType());\n+  unsigned targetWidth = intType ? intType.getWidth() : value.getBitWidth();\n+  if (value.getBitWidth() < targetWidth)\n+    value = value.zext(targetWidth);\n+  else if (value.getBitWidth() > targetWidth)\n+    value = value.trunc(targetWidth);\n   return IntegerAttr::get(res.getType(), value);\n }\n \n"}]