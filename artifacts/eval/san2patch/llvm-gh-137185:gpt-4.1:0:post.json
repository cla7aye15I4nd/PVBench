{"patch": "diff --git a/llvm/lib/Transforms/Vectorize/VPlanRecipes.cpp b/llvm/lib/Transforms/Vectorize/VPlanRecipes.cpp\nindex 6027572f1e84..56a7ca8e7d97 100644\n--- a/llvm/lib/Transforms/Vectorize/VPlanRecipes.cpp\n+++ b/llvm/lib/Transforms/Vectorize/VPlanRecipes.cpp\n@@ -2125,9 +2125,16 @@ void VPScalarIVStepsRecipe::execute(VPTransformState &State) {\n     if (getUnrollPart(*this) != 1) {\n       StartIdx0 =\n           Builder.CreateMul(StartIdx0, ConstantInt::get(StartIdx0->getType(),\n-                                                        getUnrollPart(*this)));\n+                                                         getUnrollPart(*this)));\n+    }\n+    // If source isn't integer or bitwidth too small, gracefully handle\n+    if (!StartIdx0->getType()->isIntegerTy() ||\n+        (cast<IntegerType>(StartIdx0->getType())->getBitWidth() < cast<IntegerType>(IntStepTy)->getBitWidth())) {\n+      // Handle error: fallback to zero\n+      StartIdx0 = ConstantInt::get(IntStepTy, 0);\n+    } else {\n+      StartIdx0 = Builder.CreateTrunc(StartIdx0, IntStepTy);\n     }\n-    StartIdx0 = Builder.CreateTrunc(StartIdx0, IntStepTy);\n   }\n \n   if (!FirstLaneOnly && State.VF.isScalable()) {\n", "result": true}