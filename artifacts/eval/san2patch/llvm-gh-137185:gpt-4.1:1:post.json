{"patch": "diff --git a/llvm/lib/Transforms/Vectorize/VPlanRecipes.cpp b/llvm/lib/Transforms/Vectorize/VPlanRecipes.cpp\nindex 6027572f1e84..4178e1ac2ecb 100644\n--- a/llvm/lib/Transforms/Vectorize/VPlanRecipes.cpp\n+++ b/llvm/lib/Transforms/Vectorize/VPlanRecipes.cpp\n@@ -2118,6 +2118,7 @@ void VPScalarIVStepsRecipe::execute(VPTransformState &State) {\n     EndLane = StartLane + 1;\n   }\n   Value *StartIdx0;\n+// FIXME: Crash CWE-681: Incorrect Conversion between Numeric Types\n   if (getUnrollPart(*this) == 0)\n     StartIdx0 = ConstantInt::get(IntStepTy, 0);\n   else {\n@@ -2127,7 +2128,13 @@ void VPScalarIVStepsRecipe::execute(VPTransformState &State) {\n           Builder.CreateMul(StartIdx0, ConstantInt::get(StartIdx0->getType(),\n                                                         getUnrollPart(*this)));\n     }\n-    StartIdx0 = Builder.CreateTrunc(StartIdx0, IntStepTy);\n+    // Only perform CreateTrunc if type sizes differ and source is integer.\n+    if (StartIdx0->getType() != IntStepTy && StartIdx0->getType()->isIntegerTy() && IntStepTy->isIntegerTy() && StartIdx0->getType()->getScalarSizeInBits() > IntStepTy->getScalarSizeInBits()) {\n+      StartIdx0 = Builder.CreateTrunc(StartIdx0, IntStepTy);\n+    } else if (StartIdx0->getType() != IntStepTy) {\n+      // fallback: emit diagnostic, use ConstantZero\n+      StartIdx0 = ConstantInt::get(IntStepTy, 0);\n+    }\n   }\n \n   if (!FirstLaneOnly && State.VF.isScalable()) {\n", "result": true}