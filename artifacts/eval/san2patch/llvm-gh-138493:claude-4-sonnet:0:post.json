{"patch": "diff --git a/clang/lib/Sema/SemaOpenMP.cpp b/clang/lib/Sema/SemaOpenMP.cpp\nindex 15d568fcb9cc..1add5f17ca6a 100644\n--- a/clang/lib/Sema/SemaOpenMP.cpp\n+++ b/clang/lib/Sema/SemaOpenMP.cpp\n@@ -6196,12 +6196,28 @@ StmtResult SemaOpenMP::ActOnOpenMPExecutableDirective(\n     Res = ActOnOpenMPParallelDirective(ClausesWithImplicit, AStmt, StartLoc,\n                                        EndLoc);\n     break;\n-  case OMPD_simd:\n-    Res = ActOnOpenMPSimdDirective(ClausesWithImplicit, AStmt, StartLoc, EndLoc,\n-                                   VarsWithInheritedDSA);\n+  case OMPD_simd: {\n+    bool HasInvalidCollapseClause = false;\n+    for (const auto &Clause : ClausesWithImplicit) {\n+      if (Clause->getClauseKind() == OMPC_collapse) {\n+        const auto *CC = cast<OMPCollapseClause>(Clause);\n+        if (CC->getNumForLoops() && CC->getNumForLoops()->containsErrors()) {\n+          HasInvalidCollapseClause = true;\n+          break;\n+        }\n+      }\n+    }\n+    if (HasInvalidCollapseClause) {\n+      Res = StmtError();\n+    } else {\n+      Res = ActOnOpenMPSimdDirective(ClausesWithImplicit, AStmt, StartLoc, EndLoc,\n+                                     VarsWithInheritedDSA);\n+    }\n     break;\n+  }\n   case OMPD_tile:\n-    Res =\n+// FIXME: Crash CWE-617: Reachable Assertion\n+     Res =\n         ActOnOpenMPTileDirective(ClausesWithImplicit, AStmt, StartLoc, EndLoc);\n     break;\n   case OMPD_stripe:\n@@ -6213,8 +6229,7 @@ StmtResult SemaOpenMP::ActOnOpenMPExecutableDirective(\n                                      EndLoc);\n     break;\n   case OMPD_reverse:\n-    assert(ClausesWithImplicit.empty() &&\n-           \"reverse directive does not support any clauses\");\n+    assert(ClausesWithImplicit.empty() &&           \"reverse directive does not support any clauses\");\n     Res = ActOnOpenMPReverseDirective(AStmt, StartLoc, EndLoc);\n     break;\n   case OMPD_interchange:\n", "result": true}