[{"patch": "diff --git a/llvm/lib/Target/X86/X86ISelLowering.cpp b/llvm/lib/Target/X86/X86ISelLowering.cpp\nindex f04603867a58..c82664a83639 100644\n--- a/llvm/lib/Target/X86/X86ISelLowering.cpp\n+++ b/llvm/lib/Target/X86/X86ISelLowering.cpp\n@@ -54729,9 +54729,20 @@ SDValue X86TargetLowering::getNegatedExpression(SDValue Op, SelectionDAG &DAG,\n     // This is always negatible for free but we might be able to remove some\n     // extra operand negations as well.\n     SmallVector<SDValue, 4> NewOps(Op.getNumOperands(), SDValue());\n-    for (int i = 0; i != 3; ++i)\n-      NewOps[i] = getCheaperNegatedExpression(\n+    for (int i = 0; i != 3; ++i) {\n+      SDValue Tmp = getCheaperNegatedExpression(\n           Op.getOperand(i), DAG, LegalOperations, ForCodeSize, Depth + 1);\n+      if (Tmp && Tmp.getNode() && Tmp.getNode()->getOpcode() == ISD::DELETED_NODE)\n+        break;\n+      NewOps[i] = Tmp;\n+    }\n+    bool anyDeleted = false;\n+    for (int i = 0; i != 3; ++i)\n+      if ((NewOps[i] && NewOps[i].getNode() && NewOps[i].getNode()->getOpcode() == ISD::DELETED_NODE) ||\n+          (Op.getOperand(i) && Op.getOperand(i).getNode() && Op.getOperand(i).getNode()->getOpcode() == ISD::DELETED_NODE))\n+        anyDeleted = true;\n+    if (anyDeleted)\n+      break;\n \n     bool NegA = !!NewOps[0];\n     bool NegB = !!NewOps[1];\n@@ -54741,7 +54752,6 @@ SDValue X86TargetLowering::getNegatedExpression(SDValue Op, SelectionDAG &DAG,\n     Cost = (NegA || NegB || NegC) ? NegatibleCost::Cheaper\n                                   : NegatibleCost::Neutral;\n \n-    // Fill in the non-negated ops with the original values.\n     for (int i = 0, e = Op.getNumOperands(); i != e; ++i)\n       if (!NewOps[i])\n         NewOps[i] = Op.getOperand(i);\n"}]