[{"patch": "diff --git a/ext/standard/scanf.c b/ext/standard/scanf.c\nindex 78ecc1642cf..18bbfab0de2 100644\n--- a/ext/standard/scanf.c\n+++ b/ext/standard/scanf.c\n@@ -481,6 +481,10 @@ PHPAPI int ValidateFormat(char *format, int numVars, int *totalSubs)\n \t\t}\n \n \t\tif (!(flags & SCAN_SUPPRESS)) {\n+\t\t\t/* Check objIndex bounds before any operations */\n+\t\t\tif (objIndex < 0) {\n+\t\t\t\treturn SCAN_ERROR_INVALID_FORMAT;\n+\t\t\t}\n \t\t\tif (objIndex >= nspace) {\n \t\t\t\t/*\n \t\t\t\t * Expand the nassign buffer.  If we are using XPG specifiers,\n@@ -493,6 +497,10 @@ PHPAPI int ValidateFormat(char *format, int numVars, int *totalSubs)\n \t\t\t\t} else {\n \t\t\t\t\tnspace += STATIC_LIST_SIZE;\n \t\t\t\t}\n+\t\t\t\t/* Ensure nspace doesn't overflow and is reasonable */\n+\t\t\t\tif (nspace <= objIndex || nspace <= 0) {\n+\t\t\t\t\treturn SCAN_ERROR_INVALID_FORMAT;\n+\t\t\t\t}\n \t\t\t\tif (nassign == staticAssign) {\n \t\t\t\t\tnassign = (void *)safe_emalloc(nspace, sizeof(int), 0);\n \t\t\t\t\tfor (i = 0; i < STATIC_LIST_SIZE; ++i) {\n@@ -505,8 +513,11 @@ PHPAPI int ValidateFormat(char *format, int numVars, int *totalSubs)\n \t\t\t\t\tnassign[i] = 0;\n \t\t\t\t}\n \t\t\t}\n-\t\t\tnassign[objIndex]++;\n-\t\t\tobjIndex++;\n+\t\t\t/* Final validation before array access */\n+\t\t\tif (objIndex < nspace && nassign) {\n+\t\t\t\tnassign[objIndex]++;\n+\t\t\t\tobjIndex++;\n+\t\t\t}\n \t\t}\n \t} /* while (*format != '\\0') */\n \n"}]