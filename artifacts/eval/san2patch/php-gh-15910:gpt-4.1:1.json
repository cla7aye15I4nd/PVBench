[{"patch": "diff --git a/ext/dom/element.c b/ext/dom/element.c\nindex b4495559830..e17c8bea34c 100644\n--- a/ext/dom/element.c\n+++ b/ext/dom/element.c\n@@ -693,7 +693,10 @@ static void dom_element_set_attribute_node_common(INTERNAL_FUNCTION_PARAMETERS,\n \t/* ZPP Guarantees that a DOMAttr class is given, as it is converted to a xmlAttr\n \t * to pass to libxml (see http://www.xmlsoft.org/html/libxml-tree.html#xmlAttr)\n \t * if it is not of type XML_ATTRIBUTE_NODE it indicates a bug somewhere */\n-\tZEND_ASSERT(attrp->type == XML_ATTRIBUTE_NODE);\n+\tif (!attrp || attrp->type != XML_ATTRIBUTE_NODE) {\n+\t\tphp_dom_throw_error(0, /* strict */ true);\n+\t\tRETURN_THROWS();\n+\t}\n \n \tif (modern) {\n \t\tif (attrp->parent != NULL && attrp->parent != nodep) {\n@@ -710,10 +713,14 @@ static void dom_element_set_attribute_node_common(INTERNAL_FUNCTION_PARAMETERS,\n \t\t}\n \t}\n \n-\tnsp = attrp->ns;\n+// FIXME: Crash CWE-824: Access of Uninitialized Pointer\n+\tnsp = NULL;\n+\tif (attrp) {\n+\t\tnsp = attrp->ns;\n+\t}\n \tif (use_ns && nsp != NULL) {\n \t\texistattrp = xmlHasNsProp(nodep, attrp->name, nsp->href);\n-\t} else {\n+\t} else if (attrp) {\n \t\texistattrp = xmlHasProp(nodep, attrp->name);\n \t}\n \n@@ -726,21 +733,23 @@ static void dom_element_set_attribute_node_common(INTERNAL_FUNCTION_PARAMETERS,\n \t\txmlUnlinkNode((xmlNodePtr) existattrp);\n \t}\n \n-\tif (attrp->parent != NULL) {\n+\tif (attrp && attrp->parent != NULL) {\n \t\txmlUnlinkNode((xmlNodePtr) attrp);\n \t}\n \n-\tif (attrp->doc == NULL && nodep->doc != NULL) {\n+\tif (attrp && attrp->doc == NULL && nodep->doc != NULL) {\n \t\tattrobj->document = intern->document;\n \t\tphp_libxml_increment_doc_ref((php_libxml_node_object *)attrobj, NULL);\n \t}\n \n-\txmlAddChild(nodep, (xmlNodePtr) attrp);\n-\tif (!modern) {\n-\t\tdom_mark_ids_modified(intern->document);\n-\t\tphp_dom_reconcile_attribute_namespace_after_insertion(attrp);\n-\t} else {\n-\t\tdom_check_register_attribute_id(attrp, intern->document);\n+\tif (attrp) {\n+\t\txmlAddChild(nodep, (xmlNodePtr) attrp);\n+\t\tif (!modern) {\n+\t\t\tdom_mark_ids_modified(intern->document);\n+\t\t\tphp_dom_reconcile_attribute_namespace_after_insertion(attrp);\n+\t\t} else {\n+\t\t\tdom_check_register_attribute_id(attrp, intern->document);\n+\t\t}\n \t}\n \n \t/* Returns old property if removed otherwise NULL */\n"}]