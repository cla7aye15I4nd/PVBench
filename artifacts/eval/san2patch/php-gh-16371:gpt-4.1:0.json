[{"patch": "diff --git a/Zend/zend_weakrefs.c b/Zend/zend_weakrefs.c\nindex 3f2e517f3fe..d511ec0b266 100644\n--- a/Zend/zend_weakrefs.c\n+++ b/Zend/zend_weakrefs.c\n@@ -527,16 +527,19 @@ static void zend_weakmap_iterator_get_current_key(zend_object_iterator *obj_iter\n \tzend_weakmap *wm = zend_weakmap_fetch(&iter->it.data);\n \tHashPosition *pos = zend_weakmap_iterator_get_pos_ptr(iter);\n \n-\tzend_string *string_key;\n-\tzend_ulong num_key;\n-\tint key_type = zend_hash_get_current_key_ex(&wm->ht, &string_key, &num_key, pos);\n-\tif (key_type != HASH_KEY_IS_LONG) {\n-\t\tZEND_ASSERT(0 && \"Must have integer key\");\n+\tif (wm != NULL) {\n+\t\tzend_string *string_key;\n+\t\tzend_ulong num_key;\n+\t\tint key_type = zend_hash_get_current_key_ex(&wm->ht, &string_key, &num_key, pos);\n+\t\tif (key_type == HASH_KEY_IS_LONG) {\n+\t\t\tZVAL_OBJ_COPY(key, zend_weakref_key_to_object(num_key));\n+\t\t} else {\n+\t\t\tZEND_ASSERT(0 && \"Must have integer key\");\n+\t\t}\n \t}\n-\n-\tZVAL_OBJ_COPY(key, zend_weakref_key_to_object(num_key));\n }\n \n+\n static void zend_weakmap_iterator_move_forward(zend_object_iterator *obj_iter)\n {\n \tzend_weakmap_iterator *iter = (zend_weakmap_iterator *) obj_iter;\n"}]