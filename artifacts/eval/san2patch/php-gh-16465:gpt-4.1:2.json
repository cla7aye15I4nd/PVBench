[{"patch": "diff --git a/ext/dom/php_dom.c b/ext/dom/php_dom.c\nindex 939c1794520..3540f0dbd8d 100644\n--- a/ext/dom/php_dom.c\n+++ b/ext/dom/php_dom.c\n@@ -1482,9 +1482,12 @@ void dom_namednode_iter(dom_object *basenode, int ntype, dom_object *intern, xml\n \t\t}\n \t\tmapptr->local_lower = BAD_CAST estrdup(local);\n \t\tif (len < 0) {\n-\t\t\tzend_str_tolower((char *) mapptr->local_lower, strlen((const char *) mapptr->local_lower));\n+// FIX: Always use strlen for len < 0 to avoid OOB read\n+ \t\t\tzend_str_tolower((char *) mapptr->local_lower, strlen((const char *) mapptr->local_lower));\n \t\t} else {\n-\t\t\tzend_str_tolower((char *) mapptr->local_lower, len);\n+\t\t\t// FIX: Ensure we never exceed string length. Use the minimum between len and strlen.\n+\t\t\tsize_t real_len = strlen((const char *) mapptr->local_lower);\n+\t\t\tzend_str_tolower((char *) mapptr->local_lower, (len > real_len ? real_len : len));\n \t\t}\n \t}\n \n@@ -1498,6 +1501,7 @@ void dom_namednode_iter(dom_object *basenode, int ntype, dom_object *intern, xml\n \t\t}\n \t}\n }\n+\n /* }}} */\n \n static void dom_objects_set_class_ex(zend_class_entry *class_type, dom_object *intern)\n"}]