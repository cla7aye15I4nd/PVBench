[{"patch": "diff --git a/ext/spl/spl_dllist.c b/ext/spl/spl_dllist.c\nindex 6592efc4e5e..31d3fe9ce47 100644\n--- a/ext/spl/spl_dllist.c\n+++ b/ext/spl/spl_dllist.c\n@@ -1022,11 +1022,13 @@ PHP_METHOD(SplDoublyLinkedList, serialize)\n \t/* elements */\n \twhile (current) {\n \t\tsmart_str_appendc(&buf, ':');\n-\t\tnext = current->next;\n-\n \t\tphp_var_serialize(&buf, &current->data, &var_hash);\n-\n-\t\tcurrent = next;\n+/* PATCH: After use, keep a temporary reference to current before assigning next */\n+\t\t{\n+\t\t\tvoid *tmp = current; /* ensure current is not freed till next assignment */\n+\t\t\tnext = current->next;\n+\t\t\tcurrent = next;\n+\t\t}\n \t}\n \n \t/* done */\n@@ -1034,7 +1036,6 @@ PHP_METHOD(SplDoublyLinkedList, serialize)\n \n \tRETURN_STR(smart_str_extract(&buf));\n } /* }}} */\n-\n /* {{{ Unserializes storage */\n PHP_METHOD(SplDoublyLinkedList, unserialize)\n {\n"}]