[{"patch": "diff --git a/ext/spl/spl_dllist.c b/ext/spl/spl_dllist.c\nindex 6592efc4e5e..ca84960b49f 100644\n--- a/ext/spl/spl_dllist.c\n+++ b/ext/spl/spl_dllist.c\n@@ -1014,7 +1014,6 @@ PHP_METHOD(SplDoublyLinkedList, serialize)\n \t}\n \n \tPHP_VAR_SERIALIZE_INIT(var_hash);\n-\n \t/* flags */\n \tZVAL_LONG(&flags, intern->flags);\n \tphp_var_serialize(&buf, &flags, &var_hash);\n@@ -1022,10 +1021,12 @@ PHP_METHOD(SplDoublyLinkedList, serialize)\n \t/* elements */\n \twhile (current) {\n \t\tsmart_str_appendc(&buf, ':');\n+\t\t/* Make a copy of the zval to avoid possible use-after-free */\n+\t\tzval tmp_data;\n+\t\tZVAL_COPY(&tmp_data, &current->data);\n+\t\tphp_var_serialize(&buf, &tmp_data, &var_hash);\n+\t\tzval_ptr_dtor(&tmp_data);\n \t\tnext = current->next;\n-\n-\t\tphp_var_serialize(&buf, &current->data, &var_hash);\n-\n \t\tcurrent = next;\n \t}\n \n@@ -1033,9 +1034,7 @@ PHP_METHOD(SplDoublyLinkedList, serialize)\n \tPHP_VAR_SERIALIZE_DESTROY(var_hash);\n \n \tRETURN_STR(smart_str_extract(&buf));\n-} /* }}} */\n-\n-/* {{{ Unserializes storage */\n+} /* }}} *//* {{{ Unserializes storage */\n PHP_METHOD(SplDoublyLinkedList, unserialize)\n {\n \tspl_dllist_object *intern = Z_SPLDLLIST_P(ZEND_THIS);\n"}]