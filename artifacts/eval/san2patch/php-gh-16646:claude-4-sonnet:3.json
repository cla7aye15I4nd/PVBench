[{"patch": "diff --git a/Zend/zend_types.h b/Zend/zend_types.h\nindex e6505d8b62a..441ae173b8a 100644\n--- a/Zend/zend_types.h\n+++ b/Zend/zend_types.h\n@@ -1223,9 +1223,13 @@ static zend_always_inline void zend_gc_try_delref(zend_refcounted_h *p) {\n \t\t--p->refcount;\n \t}\n }\n-\n+// FIXME: Crash CWE-416: Use After Free\n+ \n static zend_always_inline uint32_t zend_gc_delref(zend_refcounted_h *p) {\n \tZEND_ASSERT(p->refcount > 0);\n+\tif (UNEXPECTED(p->refcount == 0)) {\n+\t\treturn 0;\n+\t}\n \tZEND_RC_MOD_CHECK(p);\n \treturn --(p->refcount);\n }\n@@ -1234,9 +1238,7 @@ static zend_always_inline uint32_t zend_gc_addref_ex(zend_refcounted_h *p, uint3\n \tZEND_RC_MOD_CHECK(p);\n \tp->refcount += rc;\n \treturn p->refcount;\n-}\n-\n-static zend_always_inline uint32_t zend_gc_delref_ex(zend_refcounted_h *p, uint32_t rc) {\n+}static zend_always_inline uint32_t zend_gc_delref_ex(zend_refcounted_h *p, uint32_t rc) {\n \tZEND_RC_MOD_CHECK(p);\n \tp->refcount -= rc;\n \treturn p->refcount;\ndiff --git a/ext/spl/spl_array.c b/ext/spl/spl_array.c\nindex dbe110f7c40..07b2527f40a 100644\n--- a/ext/spl/spl_array.c\n+++ b/ext/spl/spl_array.c\n@@ -553,9 +553,12 @@ static void spl_array_unset_dimension_ex(int check_inherited, zend_object *objec\n \t\tzval *data = zend_hash_find(ht, key.key);\n \t\tif (data) {\n \t\t\tif (Z_TYPE_P(data) == IS_INDIRECT) {\n-\t\t\t\tdata = Z_INDIRECT_P(data);\n+// FIXME: Crash CWE-416: Use After Free\n+ \t\t\t\tdata = Z_INDIRECT_P(data);\n \t\t\t\tif (Z_TYPE_P(data) != IS_UNDEF) {\n-\t\t\t\t\tzval_ptr_dtor(data);\n+\t\t\t\t\tzval temp_zval;\n+\t\t\t\t\tZVAL_COPY(&temp_zval, data);\n+\t\t\t\t\tzval_ptr_dtor(&temp_zval);\n \t\t\t\t\tZVAL_UNDEF(data);\n \t\t\t\t\tHT_FLAGS(ht) |= HASH_FLAG_HAS_EMPTY_IND;\n \t\t\t\t\tzend_hash_move_forward_ex(ht, spl_array_get_pos_ptr(ht, intern));\n"}]