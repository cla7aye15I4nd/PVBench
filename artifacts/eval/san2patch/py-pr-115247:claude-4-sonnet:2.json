[{"patch": "diff --git a/Objects/object.c b/Objects/object.c\nindex 275aa6713c8..8601748a56f 100644\n--- a/Objects/object.c\n+++ b/Objects/object.c\n@@ -903,25 +903,39 @@ do_richcompare(PyThreadState *tstate, PyObject *v, PyObject *w, int op)\n     PyObject *res;\n     int checked_reverse_op = 0;\n \n+    // Protect v and w from being deallocated during comparison\n+    Py_INCREF(v);\n+    Py_INCREF(w);\n+\n     if (!Py_IS_TYPE(v, Py_TYPE(w)) &&\n         PyType_IsSubtype(Py_TYPE(w), Py_TYPE(v)) &&\n-        (f = Py_TYPE(w)->tp_richcompare) != NULL) {\n+// FIXME: Crash CWE-416: Use After Free\n+         (f = Py_TYPE(w)->tp_richcompare) != NULL) {\n         checked_reverse_op = 1;\n         res = (*f)(w, v, _Py_SwappedOp[op]);\n-        if (res != Py_NotImplemented)\n+        if (res != Py_NotImplemented) {\n+            Py_DECREF(v);\n+            Py_DECREF(w);\n             return res;\n+        }\n         Py_DECREF(res);\n     }\n     if ((f = Py_TYPE(v)->tp_richcompare) != NULL) {\n         res = (*f)(v, w, op);\n-        if (res != Py_NotImplemented)\n+        if (res != Py_NotImplemented) {\n+            Py_DECREF(v);\n+            Py_DECREF(w);\n             return res;\n+        }\n         Py_DECREF(res);\n     }\n     if (!checked_reverse_op && (f = Py_TYPE(w)->tp_richcompare) != NULL) {\n         res = (*f)(w, v, _Py_SwappedOp[op]);\n-        if (res != Py_NotImplemented)\n+        if (res != Py_NotImplemented) {\n+            Py_DECREF(v);\n+            Py_DECREF(w);\n             return res;\n+        }\n         Py_DECREF(res);\n     }\n     /* If neither object implements it, provide a sensible default\n@@ -939,8 +953,12 @@ do_richcompare(PyThreadState *tstate, PyObject *v, PyObject *w, int op)\n                       opstrings[op],\n                       Py_TYPE(v)->tp_name,\n                       Py_TYPE(w)->tp_name);\n+        Py_DECREF(v);\n+        Py_DECREF(w);\n         return NULL;\n     }\n+    Py_DECREF(v);\n+    Py_DECREF(w);\n     return Py_NewRef(res);\n }\n \n"}]