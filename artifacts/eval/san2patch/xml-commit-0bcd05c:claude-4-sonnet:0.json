[{"patch": "diff --git a/HTMLparser.c b/HTMLparser.c\nindex d1395fa5..7a49ae33 100644\n--- a/HTMLparser.c\n+++ b/HTMLparser.c\n@@ -435,7 +435,12 @@ htmlCurrentChar(xmlParserCtxtPtr ctxt, int *len) {\n \t */\n \tconst unsigned char *cur = ctxt->input->cur;\n \tunsigned char c;\n-\tunsigned int val;\n+ \tunsigned int val;\n+\n+\tif (ctxt->input->cur >= ctxt->input->end) {\n+\t\t*len = 0;\n+\t\treturn(0);\n+\t}\n \n \tc = *cur;\n \tif (c & 0x80) {\n@@ -443,7 +448,7 @@ htmlCurrentChar(xmlParserCtxtPtr ctxt, int *len) {\n \t\txmlParserInputGrow(ctxt->input, INPUT_CHUNK);\n                 cur = ctxt->input->cur;\n             }\n-\t    if ((cur[1] & 0xc0) != 0x80)\n+\t    if ((cur + 1 >= ctxt->input->end) || (cur[1] & 0xc0) != 0x80)\n \t\tgoto encoding_error;\n \t    if ((c & 0xe0) == 0xe0) {\n \n@@ -451,14 +456,14 @@ htmlCurrentChar(xmlParserCtxtPtr ctxt, int *len) {\n \t\t    xmlParserInputGrow(ctxt->input, INPUT_CHUNK);\n                     cur = ctxt->input->cur;\n                 }\n-\t\tif ((cur[2] & 0xc0) != 0x80)\n+\t\tif ((cur + 2 >= ctxt->input->end) || (cur[2] & 0xc0) != 0x80)\n \t\t    goto encoding_error;\n \t\tif ((c & 0xf0) == 0xf0) {\n \t\t    if (cur[3] == 0) {\n \t\t\txmlParserInputGrow(ctxt->input, INPUT_CHUNK);\n                         cur = ctxt->input->cur;\n                     }\n-\t\t    if (((c & 0xf8) != 0xf0) ||\n+\t\t    if ((cur + 3 >= ctxt->input->end) || ((c & 0xf8) != 0xf0) ||\n \t\t\t((cur[3] & 0xc0) != 0x80))\n \t\t\tgoto encoding_error;\n \t\t    /* 4-byte code */\n"}]