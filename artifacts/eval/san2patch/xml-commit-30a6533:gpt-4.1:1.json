[{"patch": "diff --git a/xpath.c b/xpath.c\nindex 5e3bb9ff..9a8e15a0 100644\n--- a/xpath.c\n+++ b/xpath.c\n@@ -9185,10 +9185,15 @@ xmlXPathSubstringFunction(xmlXPathParserContextPtr ctxt, int nargs) {\n \t * initial index calculations are done\n          *\n          * First we go to integer form, rounding up\n-\t * and checking for special cases\n+// FIXME: Crash CWE-681: Incorrect Conversion between Numeric Types\n+ \t * and checking for special cases\n          */\n-        i = (int) in;\n-        if (((double)i)+0.5 <= in) i++;\n+        if (in > (double)INT_MAX || in < (double)INT_MIN) {\n+            i = 0;\n+        } else {\n+            i = (int) in;\n+            if (((double)i)+0.5 <= in) i++;\n+        }\n \n \tif (xmlXPathIsInf(le) == 1) {\n \t    l = m;\n@@ -9198,8 +9203,12 @@ xmlXPathSubstringFunction(xmlXPathParserContextPtr ctxt, int nargs) {\n \telse if (xmlXPathIsInf(le) == -1 || le < 0.0)\n \t    l = 0;\n \telse {\n-\t    l = (int) le;\n-\t    if (((double)l)+0.5 <= le) l++;\n+\t    if (le > (double)INT_MAX || le < (double)INT_MIN) {\n+\t        l = 0;\n+\t    } else {\n+\t        l = (int) le;\n+\t        if (((double)l)+0.5 <= le) l++;\n+\t    }\n \t}\n \n \t/* Now we normalize inidices */\n"}]