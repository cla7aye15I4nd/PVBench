[{"patch": "diff --git a/xpath.c b/xpath.c\nindex 5e3bb9ff..66548d62 100644\n--- a/xpath.c\n+++ b/xpath.c\n@@ -9157,7 +9157,8 @@ xmlXPathSubstringFunction(xmlXPathParserContextPtr ctxt, int nargs) {\n \n     CAST_TO_NUMBER;\n     CHECK_TYPE(XPATH_NUMBER);\n-    start = valuePop(ctxt);\n+// FIXME: Crash CWE-681: Incorrect Conversion between Numeric Types\n+     start = valuePop(ctxt);\n     in = start->floatval;\n     xmlXPathReleaseObject(ctxt->context, start);\n     CAST_TO_STRING;\n@@ -9187,6 +9188,12 @@ xmlXPathSubstringFunction(xmlXPathParserContextPtr ctxt, int nargs) {\n          * First we go to integer form, rounding up\n \t * and checking for special cases\n          */\n+        /* Only convert 'in' if it's within INT_MIN ... INT_MAX, else treat as out of range */\n+        if (in > (double)INT_MAX || in < (double)INT_MIN) {\n+            valuePush(ctxt, xmlXPathCacheNewCString(ctxt->context, \"\"));\n+            xmlXPathReleaseObject(ctxt->context, str);\n+            return;\n+        }\n         i = (int) in;\n         if (((double)i)+0.5 <= in) i++;\n \n@@ -9198,6 +9205,11 @@ xmlXPathSubstringFunction(xmlXPathParserContextPtr ctxt, int nargs) {\n \telse if (xmlXPathIsInf(le) == -1 || le < 0.0)\n \t    l = 0;\n \telse {\n+            if (le > (double)INT_MAX || le < (double)INT_MIN) {\n+                valuePush(ctxt, xmlXPathCacheNewCString(ctxt->context, \"\"));\n+                xmlXPathReleaseObject(ctxt->context, str);\n+                return;\n+            }\n \t    l = (int) le;\n \t    if (((double)l)+0.5 <= le) l++;\n \t}\n"}]