[{"patch": "diff --git a/buf.c b/buf.c\nindex 07922ff6..64ddd00b 100644\n--- a/buf.c\n+++ b/buf.c\n@@ -508,13 +508,21 @@ xmlBufGrowInternal(xmlBufPtr buf, size_t len) {\n int\n xmlBufGrow(xmlBufPtr buf, int len) {\n     size_t ret;\n+    int buffer_relocated = 0;\n \n     if ((buf == NULL) || (len < 0)) return(-1);\n     if (len == 0)\n         return(0);\n+    /* Store original buffer address to detect reallocation */\n+    void *original_addr = buf->content;\n     ret = xmlBufGrowInternal(buf, len);\n     if (buf->error != 0)\n         return(-1);\n+    /* Detect buffer reallocation */\n+    if (buf->content != original_addr) {\n+        buffer_relocated = 1;\n+        /* Buffer was reallocated - any existing pointers are now invalid */\n+    }\n     return((int) ret);\n }\n \ndiff --git a/parser.c b/parser.c\nindex 4464e2e8..16987d57 100644\n--- a/parser.c\n+++ b/parser.c\n@@ -3522,18 +3522,21 @@ xmlParseNCNameComplex(xmlParserCtxtPtr ctxt) {\n \t    c = CUR_CHAR(l);\n \t}\n     }\n-    if ((len > XML_MAX_NAME_LENGTH) &&\n+        if ((len > XML_MAX_NAME_LENGTH) &&\n         ((ctxt->options & XML_PARSE_HUGE) == 0)) {\n         xmlFatalErr(ctxt, XML_ERR_NAME_TOO_LONG, \"NCName\");\n         return(NULL);\n     }\n+    /* Ensure the name data is within current buffer bounds */\n+    if (end - len < ctxt->input->base || end > ctxt->input->end) {\n+        return(NULL);\n+    }\n     return(xmlDictLookup(ctxt->dict, end - len, len));\n }\n \n /**\n  * xmlParseNCName:\n- * @ctxt:  an XML parser context\n- * @len:  length of the string parsed\n+ * @ctxt:  an XML parser context * @len:  length of the string parsed\n  *\n  * parse an XML name.\n  *\n"}]