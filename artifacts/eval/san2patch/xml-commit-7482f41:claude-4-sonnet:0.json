[{"patch": "diff --git a/xpath.c b/xpath.c\nindex a60a6237..ce38160d 100644\n--- a/xpath.c\n+++ b/xpath.c\n@@ -5711,11 +5711,19 @@ xmlXPathCastNumberToString (double val) {\n \t} else if (val == 0 && xmlXPathGetSign(val) != 0) {\n \t    ret = xmlStrdup((const xmlChar *) \"0\");\n \t} else {\n-\t    /* could be improved */\n+// FIXME: Crash CWE-681: Incorrect Conversion between Numeric Types\n+ \t    /* could be improved */\n \t    char buf[100];\n-\t    xmlXPathFormatNumber(val, buf, 99);\n-\t    buf[99] = 0;\n-\t    ret = xmlStrdup((const xmlChar *) buf);\n+\t    if (isfinite(val) && fabs(val) < 1e10) {\n+\t        xmlXPathFormatNumber(val, buf, 99);\n+\t        buf[99] = 0;\n+\t        ret = xmlStrdup((const xmlChar *) buf);\n+\t    } else {\n+\t        /* Use snprintf for large numbers to avoid conversion issues */\n+\t        snprintf(buf, 99, \"%.15g\", val);\n+\t        buf[99] = 0;\n+\t        ret = xmlStrdup((const xmlChar *) buf);\n+\t    }\n \t}\n     }\n     return(ret);\n"}]