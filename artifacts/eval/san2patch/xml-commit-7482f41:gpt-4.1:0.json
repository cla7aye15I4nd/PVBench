[{"patch": "diff --git a/xpath.c b/xpath.c\nindex a60a6237..65735281 100644\n--- a/xpath.c\n+++ b/xpath.c\n@@ -2671,9 +2671,20 @@ xmlXPathCacheConvertString(xmlXPathContextPtr ctxt, xmlXPathObjectPtr val) {\n     case XPATH_BOOLEAN:\n \tres = xmlXPathCastBooleanToString(val->boolval);\n \tbreak;\n-    case XPATH_NUMBER:\n-\tres = xmlXPathCastNumberToString(val->floatval);\n-\tbreak;\n+// FIXME: Crash CWE-681: Incorrect Conversion between Numeric Types\n+     case XPATH_NUMBER: {\n+        double num = val->floatval;\n+        if (!isfinite(num)) {\n+            res = xmlXPathCastNumberToString(0.0);\n+        } else if (num > (double)INT_MAX) {\n+            res = xmlXPathCastNumberToString((double)INT_MAX);\n+        } else if (num < (double)INT_MIN) {\n+            res = xmlXPathCastNumberToString((double)INT_MIN);\n+        } else {\n+            res = xmlXPathCastNumberToString(num);\n+        }\n+        break;\n+    }\n     case XPATH_USERS:\n     case XPATH_POINT:\n     case XPATH_RANGE:\n@@ -5832,9 +5843,20 @@ xmlXPathConvertString(xmlXPathObjectPtr val) {\n     case XPATH_BOOLEAN:\n \tres = xmlXPathCastBooleanToString(val->boolval);\n \tbreak;\n-    case XPATH_NUMBER:\n-\tres = xmlXPathCastNumberToString(val->floatval);\n-\tbreak;\n+// FIXME: Crash CWE-681: Incorrect Conversion between Numeric Types\n+     case XPATH_NUMBER: {\n+        double num = val->floatval;\n+        if (!isfinite(num)) {\n+            res = xmlXPathCastNumberToString(0.0);\n+        } else if (num > (double)INT_MAX) {\n+            res = xmlXPathCastNumberToString((double)INT_MAX);\n+        } else if (num < (double)INT_MIN) {\n+            res = xmlXPathCastNumberToString((double)INT_MIN);\n+        } else {\n+            res = xmlXPathCastNumberToString(num);\n+        }\n+        break;\n+    }\n     case XPATH_USERS:\n     case XPATH_POINT:\n     case XPATH_RANGE:\n"}]