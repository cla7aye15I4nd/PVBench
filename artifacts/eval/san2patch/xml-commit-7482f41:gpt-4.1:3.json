[{"patch": "diff --git a/xpath.c b/xpath.c\nindex a60a6237..b7178c07 100644\n--- a/xpath.c\n+++ b/xpath.c\n@@ -3102,18 +3102,18 @@ xmlXPathFormatNumber(double number, char buffer[], int buffersize)\n \tbreak;\n     default:\n \tif (xmlXPathIsNaN(number)) {\n-\t    if (buffersize > (int)sizeof(\"NaN\"))\n-\t\tsnprintf(buffer, buffersize, \"NaN\");\n-\t} else if (number == 0 && xmlXPathGetSign(number) != 0) {\n+    if (buffersize > (int)sizeof(\"NaN\"))\n+\tsnprintf(buffer, buffersize, \"NaN\");\n+    } else if (number == 0 && xmlXPathGetSign(number) != 0) {\n+// FIXME: Crash CWE-681: Incorrect Conversion between Numeric Types\n \t    snprintf(buffer, buffersize, \"0\");\n-\t} else if (number == ((int) number)) {\n-\t    char work[30];\n-\t    char *ptr, *cur;\n-\t    int value = (int) number;\n+    } else if (number >= (double)INT_MIN && number <= (double)INT_MAX && number == ((int) number)) {\n+        char work[30];\n+        char *ptr, *cur;\n+        int value = (int) number;\n \n             ptr = &buffer[0];\n-\t    if (value == 0) {\n-\t\t*ptr++ = '0';\n+        if (value == 0) {\t\t*ptr++ = '0';\n \t    } else {\n \t\tsnprintf(work, 29, \"%d\", value);\n \t\tcur = &work[0];\n"}]