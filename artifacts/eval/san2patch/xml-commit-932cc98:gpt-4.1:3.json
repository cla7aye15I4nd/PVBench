[{"patch": "diff --git a/valid.c b/valid.c\nindex 19f84b82..59e972f2 100644\n--- a/valid.c\n+++ b/valid.c\n@@ -1260,23 +1260,37 @@ xmlSnprintfElementContent(char *buf, int size, xmlElementContentPtr content, int\n     if (englob) strcat(buf, \"(\");\n     switch (content->type) {\n         case XML_ELEMENT_CONTENT_PCDATA:\n-            strcat(buf, \"#PCDATA\");\n-\t    break;\n+            if (size - strlen(buf) > 8)\n+                strcat(buf, \"#PCDATA\");\n+            else\n+                strncat(buf, \"#PCDATA\", size - strlen(buf) - 1);\n+    \t    break;\n \tcase XML_ELEMENT_CONTENT_ELEMENT:\n \t    if (content->prefix != NULL) {\n-\t\tif (size - len < xmlStrlen(content->prefix) + 10) {\n+\t\tif (size - strlen(buf) < xmlStrlen(content->prefix) + 10) {\n \t\t    strcat(buf, \" ...\");\n \t\t    return;\n \t\t}\n-\t\tstrcat(buf, (char *) content->prefix);\n-\t\tstrcat(buf, \":\");\n+\t\tif (size - strlen(buf) > xmlStrlen((char *)content->prefix))\n+\t\t    strcat(buf, (char *) content->prefix);\n+\t\telse\n+\t\t    strncat(buf, (char *)content->prefix, size - strlen(buf) - 1);\n+\t\tif (size - strlen(buf) > 1)\n+\t\t    strcat(buf, \":\");\n+\t\telse\n+\t\t    strncat(buf, \":\", size - strlen(buf) - 1);\n \t    }\n-\t    if (size - len < xmlStrlen(content->name) + 10) {\n+\t    if (size - strlen(buf) < xmlStrlen(content->name) + 10) {\n \t\tstrcat(buf, \" ...\");\n \t\treturn;\n+// FIXME: Crash CWE-787: Out-of-bounds Write\n \t    }\n-\t    if (content->name != NULL)\n-\t\tstrcat(buf, (char *) content->name);\n+\t    if (content->name != NULL) {\n+\t        if (size - strlen(buf) > xmlStrlen((char *)content->name))\n+\t            strcat(buf, (char *) content->name);\n+\t        else\n+\t            strncat(buf, (char *)content->name, size - strlen(buf) - 1);\n+        }\n \t    break;\n \tcase XML_ELEMENT_CONTENT_SEQ:\n \t    if ((content->c1->type == XML_ELEMENT_CONTENT_OR) ||\n@@ -1290,7 +1304,10 @@ xmlSnprintfElementContent(char *buf, int size, xmlElementContentPtr content, int\n \t\t    strcat(buf, \" ...\");\n \t\treturn;\n \t    }\n-            strcat(buf, \" , \");\n+            if (size - len > 3)\n+                strcat(buf, \" , \");\n+            else\n+                strncat(buf, \" , \", size - len - 1);\n \t    if (((content->c2->type == XML_ELEMENT_CONTENT_OR) ||\n \t\t (content->c2->ocur != XML_ELEMENT_CONTENT_ONCE)) &&\n \t\t(content->c2->type != XML_ELEMENT_CONTENT_ELEMENT))\n@@ -1310,7 +1327,10 @@ xmlSnprintfElementContent(char *buf, int size, xmlElementContentPtr content, int\n \t\t    strcat(buf, \" ...\");\n \t\treturn;\n \t    }\n-            strcat(buf, \" | \");\n+            if (size - len > 3)\n+                strcat(buf, \" | \");\n+            else\n+                strncat(buf, \" | \", size - len - 1);\n \t    if (((content->c2->type == XML_ELEMENT_CONTENT_SEQ) ||\n \t\t (content->c2->ocur != XML_ELEMENT_CONTENT_ONCE)) &&\n \t\t(content->c2->type != XML_ELEMENT_CONTENT_ELEMENT))\n"}]