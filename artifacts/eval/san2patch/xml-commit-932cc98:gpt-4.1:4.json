[{"patch": "diff --git a/valid.c b/valid.c\nindex 19f84b82..b770cda9 100644\n--- a/valid.c\n+++ b/valid.c\n@@ -1259,38 +1259,48 @@ xmlSnprintfElementContent(char *buf, int size, xmlElementContentPtr content, int\n     }\n     if (englob) strcat(buf, \"(\");\n     switch (content->type) {\n-        case XML_ELEMENT_CONTENT_PCDATA:\n-            strcat(buf, \"#PCDATA\");\n-\t    break;\n-\tcase XML_ELEMENT_CONTENT_ELEMENT:\n+        case XML_ELEMENT_CONTENT_PCDATA: {\n+            size_t len = strlen(buf);\n+            if ((int)(size - len) > (int)strlen(\"#PCDATA\")) {\n+                strncat(buf, \"#PCDATA\", size - len - 1);\n+            } else {\n+                // Do nothing or handle truncation\n+            }\n+            break;\n+        }\n+\tcase XML_ELEMENT_CONTENT_ELEMENT: {\n+\t    size_t len = strlen(buf);\n \t    if (content->prefix != NULL) {\n \t\tif (size - len < xmlStrlen(content->prefix) + 10) {\n-\t\t    strcat(buf, \" ...\");\n-\t\t    return;\n+\t            strncat(buf, \" ...\", size - len - 1);\n+\t            return;\n \t\t}\n-\t\tstrcat(buf, (char *) content->prefix);\n-\t\tstrcat(buf, \":\");\n+\t\tstrncat(buf, (char *) content->prefix, size - strlen(buf) - 1);\n+\t\tstrncat(buf, \":\", size - strlen(buf) - 1);\n \t    }\n+\t    len = strlen(buf);\n \t    if (size - len < xmlStrlen(content->name) + 10) {\n-\t\tstrcat(buf, \" ...\");\n-\t\treturn;\n+\t        strncat(buf, \" ...\", size - len - 1);\n+\t        return;\n+// FIXME: Crash CWE-787: Out-of-bounds Write\n \t    }\n \t    if (content->name != NULL)\n-\t\tstrcat(buf, (char *) content->name);\n+\t\tstrncat(buf, (char *) content->name, size - strlen(buf) - 1);\n \t    break;\n-\tcase XML_ELEMENT_CONTENT_SEQ:\n+\t}\n+\tcase XML_ELEMENT_CONTENT_SEQ: {\n \t    if ((content->c1->type == XML_ELEMENT_CONTENT_OR) ||\n \t        (content->c1->type == XML_ELEMENT_CONTENT_SEQ))\n \t\txmlSnprintfElementContent(buf, size, content->c1, 1);\n \t    else\n \t\txmlSnprintfElementContent(buf, size, content->c1, 0);\n-\t    len = strlen(buf);\n+\t    size_t len = strlen(buf);\n \t    if (size - len < 50) {\n \t\tif ((size - len > 4) && (buf[len - 1] != '.'))\n-\t\t    strcat(buf, \" ...\");\n+\t            strncat(buf, \" ...\", size - len - 1);\n \t\treturn;\n \t    }\n-            strcat(buf, \" , \");\n+            strncat(buf, \" , \", size - strlen(buf) - 1);\n \t    if (((content->c2->type == XML_ELEMENT_CONTENT_OR) ||\n \t\t (content->c2->ocur != XML_ELEMENT_CONTENT_ONCE)) &&\n \t\t(content->c2->type != XML_ELEMENT_CONTENT_ELEMENT))\n@@ -1298,19 +1308,20 @@ xmlSnprintfElementContent(char *buf, int size, xmlElementContentPtr content, int\n \t    else\n \t\txmlSnprintfElementContent(buf, size, content->c2, 0);\n \t    break;\n-\tcase XML_ELEMENT_CONTENT_OR:\n+\t}\n+\tcase XML_ELEMENT_CONTENT_OR: {\n \t    if ((content->c1->type == XML_ELEMENT_CONTENT_OR) ||\n \t        (content->c1->type == XML_ELEMENT_CONTENT_SEQ))\n \t\txmlSnprintfElementContent(buf, size, content->c1, 1);\n \t    else\n \t\txmlSnprintfElementContent(buf, size, content->c1, 0);\n-\t    len = strlen(buf);\n+\t    size_t len = strlen(buf);\n \t    if (size - len < 50) {\n \t\tif ((size - len > 4) && (buf[len - 1] != '.'))\n-\t\t    strcat(buf, \" ...\");\n+\t            strncat(buf, \" ...\", size - len - 1);\n \t\treturn;\n \t    }\n-            strcat(buf, \" | \");\n+            strncat(buf, \" | \", size - strlen(buf) - 1);\n \t    if (((content->c2->type == XML_ELEMENT_CONTENT_SEQ) ||\n \t\t (content->c2->ocur != XML_ELEMENT_CONTENT_ONCE)) &&\n \t\t(content->c2->type != XML_ELEMENT_CONTENT_ELEMENT))\n@@ -1318,6 +1329,7 @@ xmlSnprintfElementContent(char *buf, int size, xmlElementContentPtr content, int\n \t    else\n \t\txmlSnprintfElementContent(buf, size, content->c2, 0);\n \t    break;\n+\t}\n     }\n     if (englob)\n         strcat(buf, \")\");\n"}]