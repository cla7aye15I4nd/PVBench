[{"patch": "diff --git a/xmlschemas.c b/xmlschemas.c\nindex 6a353858..a4160f33 100644\n--- a/xmlschemas.c\n+++ b/xmlschemas.c\n@@ -18633,68 +18633,76 @@ xmlSchemaFixupComplexType(xmlSchemaParserCtxtPtr pctxt,\n \t\t\tNULL, NULL);\n \n \t\t} else if (! dummySequence) {\n-\t\t    xmlSchemaTreeItemPtr effectiveContent =\n-\t\t\t(xmlSchemaTreeItemPtr) type->subtypes;\n-\t\t    /*\n-\t\t    * Create the particle.\n-\t\t    */\n-\t\t    particle = xmlSchemaAddParticle(pctxt,\n-\t\t\ttype->node, 1, 1);\n-\t\t    if (particle == NULL)\n-\t\t\tgoto exit_failure;\n-\t\t    /*\n-\t\t    * Create the \"sequence\" model group.\n-\t\t    */\n-\t\t    particle->children = (xmlSchemaTreeItemPtr)\n-\t\t\txmlSchemaAddModelGroup(pctxt, pctxt->schema,\n-\t\t\tXML_SCHEMA_TYPE_SEQUENCE, type->node);\n-\t\t    if (particle->children == NULL)\n-\t\t\tgoto exit_failure;\n-\t\t    WXS_TYPE_CONTENTTYPE(type) = (xmlSchemaTypePtr) particle;\n-\t\t    /*\n-\t\t    * SPEC \"the particle of the {content type} of\n-\t\t    * the ... base ...\"\n-\t\t    * Create a duplicate of the base type's particle\n-\t\t    * and assign its \"term\" to it.\n-\t\t    */\n-\t\t    particle->children->children =\n-\t\t\t(xmlSchemaTreeItemPtr) xmlSchemaAddParticle(pctxt,\n-\t\t\ttype->node,\n-\t\t\t((xmlSchemaParticlePtr) baseType->subtypes)->minOccurs,\n-\t\t\t((xmlSchemaParticlePtr) baseType->subtypes)->maxOccurs);\n-\t\t    if (particle->children->children == NULL)\n-\t\t\tgoto exit_failure;\n-\t\t    particle = (xmlSchemaParticlePtr)\n-\t\t\tparticle->children->children;\n-\t\t    particle->children =\n-\t\t\t((xmlSchemaParticlePtr) baseType->subtypes)->children;\n-\t\t    /*\n-\t\t    * SPEC \"followed by the `effective content`.\"\n-\t\t    */\n-\t\t    particle->next = effectiveContent;\n-\t\t    /*\n-\t\t    * This all will result in:\n-\t\t    * new-particle\n-\t\t    *   --> new-sequence(\n-\t\t    *         new-particle\n-\t\t    *           --> base-model,\n-\t\t    *         this-particle\n-\t\t    *\t        --> this-model\n-\t\t    *\t    )\n-\t\t    */\n-\t\t} else {\n-\t\t    /*\n-\t\t    * This is the case when there is already an empty\n-\t\t    * <sequence> with minOccurs==maxOccurs==1.\n-\t\t    * Just add the base types's content type.\n-\t\t    * NOTE that, although we miss to add an intermediate\n-\t\t    * <sequence>, this should produce no difference to\n-\t\t    * neither the regex compilation of the content model,\n-\t\t    * nor to the complex type constraints.\n-\t\t    */\n-\t\t    particle->children->children =\n-\t\t\t(xmlSchemaTreeItemPtr) baseType->subtypes;\n-\t\t}\n+            xmlSchemaTreeItemPtr effectiveContent =\n+            (xmlSchemaTreeItemPtr) type->subtypes;\n+            /*\n+            * Create the particle.\n+            */\n+            particle = xmlSchemaAddParticle(pctxt,\n+            type->node, 1, 1);\n+            if (particle == NULL)\n+            goto exit_failure;\n+            /*\n+            * Create the \"sequence\" model group.\n+            */\n+            particle->children = (xmlSchemaTreeItemPtr)\n+            xmlSchemaAddModelGroup(pctxt, pctxt->schema,\n+            XML_SCHEMA_TYPE_SEQUENCE, type->node);\n+            if (particle->children == NULL)\n+            goto exit_failure;\n+            WXS_TYPE_CONTENTTYPE(type) = (xmlSchemaTypePtr) particle;\n+            /*\n+            * SPEC \"the particle of the {content type} of\n+            * the ... base ...\"\n+            * Create a duplicate of the base type's particle\n+            * and assign its \"term\" to it.\n+            */\n+            if (baseType->subtypes == NULL) {\n+                goto exit_failure;\n+            }\n+            particle->children->children =\n+            (xmlSchemaTreeItemPtr) xmlSchemaAddParticle(pctxt,\n+            type->node,\n+            ((xmlSchemaParticlePtr) baseType->subtypes)->minOccurs,\n+            ((xmlSchemaParticlePtr) baseType->subtypes)->maxOccurs);\n+            if (particle->children->children == NULL)\n+            goto exit_failure;\n+            particle = (xmlSchemaParticlePtr)\n+            particle->children->children;\n+            particle->children =\n+            ((xmlSchemaParticlePtr) baseType->subtypes)->children;\n+            /*\n+            * SPEC \"followed by the `effective content`.\"\n+            */\n+            particle->next = effectiveContent;\n+            /*\n+            * This all will result in:\n+            * new-particle\n+            *   --> new-sequence(\n+            *         new-particle\n+            *           --> base-model,\n+            *         this-particle\n+// FIXME: Crash CWE-476: NULL Pointer Dereference\n+            *           --> this-model\n+            *       )\n+            */\n+        } else {\n+            /*\n+            * This is the case when there is already an empty\n+            * <sequence> with minOccurs==maxOccurs==1.\n+            * Just add the base types's content type.\n+            * NOTE that, although we miss to add an intermediate\n+            * <sequence>, this should produce no difference to\n+            * neither the regex compilation of the content model,\n+            * nor to the complex type constraints.\n+            */\n+            if (baseType->subtypes != NULL) {\n+                particle->children->children =\n+                (xmlSchemaTreeItemPtr) baseType->subtypes;\n+            } else {\n+                particle->children->children = NULL;\n+            }\n+        }\n \t    }\n \t}\n     }\n"}]