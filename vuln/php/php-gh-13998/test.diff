diff --git a/ext/pdo_sqlite/tests/gh13998.phpt b/ext/pdo_sqlite/tests/gh13998.phpt
new file mode 100644
index 0000000000..c87b4acdd2
--- /dev/null
+++ b/ext/pdo_sqlite/tests/gh13998.phpt
@@ -0,0 +1,25 @@
+--TEST--
+Fix GH-13998: Manage refcount of agg_context->val correctly
+--EXTENSIONS--
+pdo_sqlite
+--FILE--
+<?php
+$step = function () {
+    throw new Exception();
+};
+$finalize = function () {
+};
+
+$db = new PDO('sqlite::memory:');
+$db->query('CREATE TABLE test (a int, b int)');
+$stmt = $db->query('INSERT INTO test VALUES (1, 1), (2, 2), (3, 3)');
+$db->sqliteCreateAggregate('S', $step, $finalize, 1);
+
+try {
+    $db->query('SELECT S(a) FROM test');
+} catch (Exception $e) {
+    echo 'done!';
+}
+?>
+--EXPECT--
+done!
